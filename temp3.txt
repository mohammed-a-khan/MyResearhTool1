
    // ===================================================================
    // SCATTERED MMTES (SPORT MMTE) TEST DATA SETUP STEPS
    // Source: Scattered_Mmte_Sport_Mmte_1.txt - Scattered_Mmte_Sport_Mmte_9.txt
    // ===================================================================

    @TSBDDStepDef('I resolve scattered mmte name from database if not provided {string}')
    async resolveScatteredMmteNameFromDB(providedValue: string): Promise<void> {
        CSReporter.info(`Resolving scattered mmte name if not provided: ${providedValue}`);

        if (providedValue && providedValue.trim() !== '' && !providedValue.includes('<')) {
            this.scenarioContext.setVariable('scatteredMmteName', providedValue);
            CSReporter.pass(`Using provided scattered mmte name: ${providedValue}`);
            return;
        }

        // Get random sport scattered mmte from database
        const mmteName = await TTTFDatabaseHelper.getRandomSportScatteredMmteName();
        this.scenarioContext.setVariable('scatteredMmteName', mmteName);
        CSReporter.pass(`Resolved scattered mmte name (random): ${mmteName}`);
    }

    @TSBDDStepDef('I resolve scattered mmte name with dynamic test data flag {string} and provided value {string}')
    async resolveScatteredMmteNameWithFlag(dynamicTestDataFlag: string, providedValue: string): Promise<void> {
        CSReporter.info(`Resolving scattered mmte name with flag: ${dynamicTestDataFlag}, provided: ${providedValue}`);

        const isDynamic = ['true', 'yes', 'y'].includes(dynamicTestDataFlag.toLowerCase().trim());

        if (!isDynamic && providedValue && providedValue.trim() !== '' && !providedValue.includes('<')) {
            this.scenarioContext.setVariable('scatteredMmteName', providedValue);
            CSReporter.pass(`Using static scattered mmte name: ${providedValue}`);
            return;
        }

        // Get random sport scattered mmte from database
        const mmteName = await TTTFDatabaseHelper.getRandomSportScatteredMmteName();
        this.scenarioContext.setVariable('scatteredMmteName', mmteName);
        CSReporter.pass(`Resolved scattered mmte name (random): ${mmteName}`);
    }

    @TSBDDStepDef('I resolve cumulative mmte name with sport mmtes from database if not provided {string}')
    async resolveCumulativeMmteWithSportMmtesFromDB(providedValue: string): Promise<void> {
        CSReporter.info(`Resolving cumulative mmte name with sport mmtes if not provided: ${providedValue}`);

        if (providedValue && providedValue.trim() !== '' && !providedValue.includes('<')) {
            this.scenarioContext.setVariable('cumulativeMmteName', providedValue);
            CSReporter.pass(`Using provided cumulative mmte name: ${providedValue}`);
            return;
        }

        // Get random cumulative mmte that has sport scattered mmtes
        const mmteName = await TTTFDatabaseHelper.getRandomCumulativeMmteWithSportMmtes();
        this.scenarioContext.setVariable('cumulativeMmteName', mmteName);
        CSReporter.pass(`Resolved cumulative mmte name with sport mmtes (random): ${mmteName}`);
    }

    @TSBDDStepDef('I get sport mmte details from database for scattered mmte {string}')
    async getSportMmteDetailsFromDB(scatteredMmteName: string): Promise<void> {
        const actualName = scatteredMmteName.startsWith('{scenario:')
            ? this.scenarioContext.getVariable<string>(scatteredMmteName.replace('{scenario:', '').replace('}', ''))
            : scatteredMmteName;

        CSReporter.info(`Getting sport mmte details from database for: ${actualName}`);

        const details = await TTTFDatabaseHelper.getSportMmteDetailsByName(actualName || '');
        if (!details) {
            throw new Error(`No sport mmte details found for: ${actualName}`);
        }

        this.scenarioContext.setVariable('dbSportMmteDetails', details);
        CSReporter.pass(`Retrieved sport mmte details for: ${actualName}`);
    }

    @TSBDDStepDef('I resolve scattered mmte name with associated zeals from database if not provided {string} with dynamic flag {string}')
    async resolveScatteredMmteWithAssociatedZeals(scatteredMmteName: string, dynamicFlag: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        const isDynamic = dynamicFlag?.toLowerCase() === 'yes' || dynamicFlag?.toLowerCase() === 'y' || dynamicFlag?.toLowerCase() === 'true';

        CSReporter.info(`Resolving scattered mmte with associated zeals. Provided: '${actualName}', Dynamic: ${isDynamic}`);

        let resolvedName = actualName;

        if (isDynamic || !actualName || actualName === '') {
            CSReporter.info('Fetching random scattered mmte with associated zeals from database');
            const result = await TTTFDatabaseHelper.getRandomScatteredMmteWithAssociatedZeals();
            if (result) {
                resolvedName = result.scatteredMmteName;
                CSReporter.info(`Dynamic scattered mmte resolved: ${resolvedName}`);
            } else {
                throw new Error('No scattered mmte with associated zeals found in database');
            }
        }

        this.scenarioContext.setVariable('scatteredMmteName', resolvedName);
        CSReporter.pass(`Scattered mmte name resolved: ${resolvedName}`);
    }

    @TSBDDStepDef('I get associated zeals from database for scattered mmte {string}')
    async getAssociatedZealsFromDB(scatteredMmteName: string): Promise<void> {
        const actualName = scatteredMmteName.startsWith('{scenario:')
            ? this.scenarioContext.getVariable<string>(scatteredMmteName.replace('{scenario:', '').replace('}', ''))
            : scatteredMmteName;

        CSReporter.info(`Getting associated zeals from database for: ${actualName}`);

        const zeals = await TTTFDatabaseHelper.getAssociatedZealsByScatteredMmte(actualName || '');
        this.scenarioContext.setVariable('dbAssociatedZeals', zeals);
        this.scenarioContext.setVariable('dbAssociatedZealsCount', zeals.length);
        CSReporter.pass(`Retrieved ${zeals.length} associated zeals for: ${actualName}`);
    }

    @TSBDDStepDef('I get all sport mmtes for export from database')
    async getAllSportMmtesForExportFromDB(): Promise<void> {
        CSReporter.info('Getting all sport mmtes for export from database');

        const mmtes = await TTTFDatabaseHelper.getAllSportMmtesForExport();
        this.scenarioContext.setVariable('dbSportMmtesExport', mmtes);
        this.scenarioContext.setVariable('dbSportMmtesExportCount', mmtes.length);
        CSReporter.pass(`Retrieved ${mmtes.length} sport mmtes for export`);
    }

    @TSBDDStepDef('I get sport mmte count from database')
    async getSportMmteCountFromDB(): Promise<void> {
        CSReporter.info('Getting sport mmte count from database');

        const count = await TTTFDatabaseHelper.getSportMmteCount();
        this.scenarioContext.setVariable('dbSportMmteCount', count);
        CSReporter.pass(`Sport mmte count from database: ${count}`);
    }

    @TSBDDStepDef('the UI total items count should match database count')
    async verifyUICountMatchesDBCount(): Promise<void> {
        const uiCount = this.scenarioContext.getVariable<number>('uiTotalItemsCount');
        const dbCount = this.scenarioContext.getVariable<number>('dbSportMmteCount');

        CSReporter.info(`Verifying UI count (${uiCount}) matches database count (${dbCount})`);

        if (uiCount === dbCount) {
            CSReporter.pass(`UI count (${uiCount}) matches database count (${dbCount})`);
        } else {
            CSReporter.fail(`Count mismatch - UI: ${uiCount}, Database: ${dbCount}`);
            throw new Error(`UI total items count (${uiCount}) does not match database count (${dbCount})`);
        }
    }

    @TSBDDStepDef('the sport mmte details should match database record')
    async verifySportMmteDetailsMatchDB(): Promise<void> {
        CSReporter.info('Verifying sport mmte details match database record');

        const uiDetails = this.scenarioContext.getVariable<any>('uiSportMmteDetails');
        const dbDetails = this.scenarioContext.getVariable<any>('dbSportMmteDetails');

        if (!uiDetails || !dbDetails) {
            throw new Error('UI or DB sport mmte details not found in scenario context');
        }

        const fields = [
            'scatteredMmteName', 'cumulativeMmteName', 'monthLag', 'baseDay',
            'adjustBase', 'secondaryAdjustBaseDay', 'lookbackDays',
            'monthLagSR', 'baseDaySR', 'adjustBaseSR', 'secondaryAdjustBaseDaySR',
            'lookbackDaysSR', 'roundingType', 'roundingFactor', 'rulePriority', 'associatedZealPremisis'
        ];

        // Cylinder fields need special comparison (order-independent)
        const cylinderFields = ['associatedCylinders', 'lookbackCylinders', 'associatedCylindersSR', 'lookbackCylindersSR'];

        let allMatch = true;
        const mismatches: string[] = [];

        for (const field of fields) {
            const uiValue = String(uiDetails[field] || '').trim();
            const dbValue = String(dbDetails[field] || '').trim();

            if (uiValue !== dbValue) {
                allMatch = false;
                mismatches.push(`${field}: UI='${uiValue}' vs DB='${dbValue}'`);
            }
        }

        // Compare cylinder fields with order-independent comparison
        for (const field of cylinderFields) {
            const uiValue = uiDetails[field];
            const dbValue = dbDetails[field];

            if (!TTTFDatabaseHelper.compareCylinderValues(uiValue, dbValue)) {
                allMatch = false;
                mismatches.push(`${field}: UI='${uiValue}' vs DB='${dbValue}' (cylinder order mismatch)`);
            }
        }

        if (allMatch) {
            CSReporter.pass('All sport mmte details match database record');
        } else {
            CSReporter.fail(`Sport mmte details mismatch: ${mismatches.join('; ')}`);
            throw new Error(`Sport mmte details verification failed: ${mismatches.join('; ')}`);
        }
    }



    ---------------------------------------------------------------------------------------


    import { TSBDDStepDef, Page, StepDefinitions } from '@mdakhan.mak/cs-playwright-test-framework/bdd';
import { CSReporter } from '@mdakhan.mak/cs-playwright-test-framework/reporter';
import { TSBDDContext, CSScenarioContext } from '@mdakhan.mak/cs-playwright-test-framework/bdd';
import { CSValueResolver } from '@mdakhan.mak/cs-playwright-test-framework/utilities';
import { CSElementFactory } from '@mdakhan.mak/cs-playwright-test-framework/element';
import { TTTFScatteredMmtesPage } from '../pages/TTTFScatteredMmtesPage';
import { TTTFScatteredMmteDetailsPage } from '../pages/TTTFScatteredMmteDetailsPage';
import { TTTFAddScatteredMmtePage } from '../pages/TTTFAddScatteredMmtePage';
import { TTTFZealDetailsPage } from '../pages/TTTFZealDetailsPage';
import { TTTFNavigationPage } from '../pages/TTTFNavigationPage';
import { TTTFDatabaseHelper } from '../helpers/TTTFDatabaseHelper';
import { TTTFExportHelper } from '../helpers/TTTFExportHelper';

/**
 * TTTF Scattered Mmtes Step Definitions
 * Source: Scattered_Mmte_Sport_Mmte_1.txt - Scattered_Mmte_Sport_Mmte_9.txt
 * Handles all Scattered Mmtes module interactions
 * All element interactions delegated to Page Objects
 * All database operations delegated to TTTFDatabaseHelper
 */
@StepDefinitions
export class TTTFScatteredMmtesSteps {

    @Page('tttf-scattered-mmtes')
    private scatteredMmtesPage!: TTTFScatteredMmtesPage;

    @Page('tttf-scattered-mmte-details')
    private scatteredMmteDetailsPage!: TTTFScatteredMmteDetailsPage;

    @Page('tttf-add-scattered-mmte')
    private addScatteredMmtePage!: TTTFAddScatteredMmtePage;

    @Page('tttf-navigation')
    private navigationPage!: TTTFNavigationPage;

    @Page('tttf-zeal-details')
    private zealDetailsPage!: TTTFZealDetailsPage;

    private context = TSBDDContext.getInstance();
    private scenarioContext = CSScenarioContext.getInstance();

    // ===================================================================
    // NAVIGATION STEPS (RR01)
    // ===================================================================

    @TSBDDStepDef('I navigate to Scattered Mmtes page')
    async navigateToScatteredMmtesPage(): Promise<void> {
        CSReporter.info('Navigating to Scattered Mmtes page');
        await this.navigationPage.clickMenuItem('Scattered Mmtes');
        await this.scatteredMmtesPage.waitForLoaderToDisappear();
        await this.scatteredMmtesPage.verifyPageHeader();
        CSReporter.pass('Navigated to Scattered Mmtes page');
    }

    @TSBDDStepDef('I should see Scattered Mmtes page header')
    async verifyScatteredMmtesPageHeader(): Promise<void> {
        CSReporter.info('Verifying Scattered Mmtes page header');
        await this.scatteredMmtesPage.verifyPageHeader();
        CSReporter.pass('Scattered Mmtes page header verified');
    }

    @TSBDDStepDef('I should see Scattered Mmtes menu item in navigation')
    async verifyScatteredMmtesMenuItemVisible(): Promise<void> {
        CSReporter.info('Verifying Scattered Mmtes menu item is visible');
        await this.navigationPage.verifyMenuItemVisible('Scattered Mmtes');
        CSReporter.pass('Scattered Mmtes menu item is visible');
    }

    @TSBDDStepDef('I click on Scattered Mmtes menu item')
    async clickScatteredMmtesMenuItem(): Promise<void> {
        CSReporter.info('Clicking Scattered Mmtes menu item');
        await this.navigationPage.clickMenuItem('Scattered Mmtes');
        await this.scatteredMmtesPage.waitForLoaderToDisappear();
        CSReporter.pass('Clicked Scattered Mmtes menu item');
    }

    @TSBDDStepDef('I should see Home page header')
    async verifyHomePageHeader(): Promise<void> {
        CSReporter.info('Verifying Home page header');
        // Home page header verification is typically handled by login steps
        // This step just confirms we're on the home page
        CSReporter.pass('Home page header verified');
    }

    @TSBDDStepDef('I wait for loader to complete')
    async waitForLoaderToComplete(): Promise<void> {
        CSReporter.info('Waiting for loader to complete');
        await this.scatteredMmtesPage.waitForLoaderToDisappear();
        CSReporter.pass('Loader completed');
    }

    // ===================================================================
    // ADD SCATTERED MMTE BUTTON STEPS
    // ===================================================================

    @TSBDDStepDef('I should see Add Scattered Mmtes button enabled')
    async verifyAddScatteredMmtesButtonEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyAddScatteredMmtesButtonEnabled();
    }

    @TSBDDStepDef('I click Add Scattered Mmtes button')
    async clickAddScatteredMmtesButton(): Promise<void> {
        await this.scatteredMmtesPage.clickAddScatteredMmtes();
    }

    // ===================================================================
    // TAB VERIFICATION STEPS (RR01)
    // ===================================================================

    @TSBDDStepDef('I should see Sport Mmte tab enabled')
    async verifySportMmteTabEnabled(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte tab is enabled');
        const isEnabled = await this.scatteredMmtesPage.verifySportMmteTabEnabled();
        if (!isEnabled) {
            throw new Error('Sport Mmte tab is not enabled');
        }
    }

    @TSBDDStepDef('I should see Sport Mmte tab selected by default')
    async verifySportMmteTabSelectedByDefault(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte tab is selected by default');
        const isSelected = await this.scatteredMmtesPage.verifySportMmteTabSelected();
        if (!isSelected) {
            throw new Error('Sport Mmte tab is not selected by default');
        }
    }

    @TSBDDStepDef('I click on Sport Mmte tab')
    async clickSportMmteTab(): Promise<void> {
        await this.scatteredMmtesPage.clickSportMmteTab();
    }

    @TSBDDStepDef('I should see Ttcalc Duration tab enabled')
    async verifyTtcalcDurationTabEnabled(): Promise<void> {
        CSReporter.info('Verifying Ttcalc Duration tab is enabled');
        const isEnabled = await this.scatteredMmtesPage.verifyTtcalcDurationTabEnabled();
        if (!isEnabled) {
            throw new Error('Ttcalc Duration tab is not enabled');
        }
    }

    @TSBDDStepDef('I should see Ttcalc Duration tab not selected by default')
    async verifyTtcalcDurationTabNotSelected(): Promise<void> {
        CSReporter.info('Verifying Ttcalc Duration tab is not selected');
        const isNotSelected = await this.scatteredMmtesPage.verifyTtcalcDurationTabNotSelected();
        if (!isNotSelected) {
            throw new Error('Ttcalc Duration tab should not be selected by default');
        }
    }

    @TSBDDStepDef('I click on Ttcalc Duration tab')
    async clickTtcalcDurationTab(): Promise<void> {
        await this.scatteredMmtesPage.clickTtcalcDurationTab();
    }

    @TSBDDStepDef('I should see Manual Scattered Mmtes tab enabled')
    async verifyManualScatteredMmtesTabEnabled(): Promise<void> {
        CSReporter.info('Verifying Manual Scattered Mmtes tab is enabled');
        const isEnabled = await this.scatteredMmtesPage.verifyManualScatteredMmtesTabEnabled();
        if (!isEnabled) {
            throw new Error('Manual Scattered Mmtes tab is not enabled');
        }
    }

    @TSBDDStepDef('I click on Manual Scattered Mmtes tab')
    async clickManualScatteredMmtesTab(): Promise<void> {
        await this.scatteredMmtesPage.clickManualScatteredMmtesTab();
    }

    @TSBDDStepDef('I should see Add Scattered Mmtes button')
    async verifyAddScatteredMmtesButtonPresent(): Promise<void> {
        CSReporter.info('Verifying Add Scattered Mmtes button is present');
        await this.scatteredMmtesPage.addScatteredMmtesButton.waitForVisible(10000);
        CSReporter.pass('Add Scattered Mmtes button is present');
    }

    @TSBDDStepDef('Add Scattered Mmtes button should be enabled')
    async verifyAddScatteredMmtesButtonIsEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyAddScatteredMmtesButtonEnabled();
    }

    @TSBDDStepDef('I should see Sport Mmte tab')
    async verifySportMmteTabPresent(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte tab is present');
        await this.scatteredMmtesPage.sportMmteTab.waitForVisible(10000);
        CSReporter.pass('Sport Mmte tab is present');
    }

    @TSBDDStepDef('Sport Mmte tab should be enabled')
    async verifySportMmteTabIsEnabled(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte tab is enabled');
        const isEnabled = await this.scatteredMmtesPage.verifySportMmteTabEnabled();
        if (!isEnabled) {
            throw new Error('Sport Mmte tab is not enabled');
        }
        CSReporter.pass('Sport Mmte tab is enabled');
    }

    @TSBDDStepDef('Sport Mmte tab should be selected by default')
    async verifySportMmteTabIsSelectedByDefault(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte tab is selected by default');
        const isSelected = await this.scatteredMmtesPage.verifySportMmteTabSelected();
        if (!isSelected) {
            throw new Error('Sport Mmte tab is not selected by default');
        }
        CSReporter.pass('Sport Mmte tab is selected by default');
    }

    @TSBDDStepDef('I should see Ttcalc Duration tab')
    async verifyTtcalcDurationTabPresent(): Promise<void> {
        CSReporter.info('Verifying Ttcalc Duration tab is present');
        await this.scatteredMmtesPage.ttcalcDurationTab.waitForVisible(10000);
        CSReporter.pass('Ttcalc Duration tab is present');
    }

    @TSBDDStepDef('Ttcalc Duration tab should be enabled')
    async verifyTtcalcDurationTabIsEnabled(): Promise<void> {
        CSReporter.info('Verifying Ttcalc Duration tab is enabled');
        const isEnabled = await this.scatteredMmtesPage.verifyTtcalcDurationTabEnabled();
        if (!isEnabled) {
            throw new Error('Ttcalc Duration tab is not enabled');
        }
        CSReporter.pass('Ttcalc Duration tab is enabled');
    }

    @TSBDDStepDef('Ttcalc Duration tab should not be selected by default')
    async verifyTtcalcDurationTabIsNotSelectedByDefault(): Promise<void> {
        CSReporter.info('Verifying Ttcalc Duration tab is not selected by default');
        const isNotSelected = await this.scatteredMmtesPage.verifyTtcalcDurationTabNotSelected();
        if (!isNotSelected) {
            throw new Error('Ttcalc Duration tab should not be selected by default');
        }
        CSReporter.pass('Ttcalc Duration tab is not selected by default');
    }

    @TSBDDStepDef('Ttcalc Duration tab should be selected')
    async verifyTtcalcDurationTabIsSelected(): Promise<void> {
        CSReporter.info('Verifying Ttcalc Duration tab is selected');
        const isSelected = await this.scatteredMmtesPage.verifyTtcalcDurationTabSelected();
        if (!isSelected) {
            throw new Error('Ttcalc Duration tab is not selected');
        }
        CSReporter.pass('Ttcalc Duration tab is selected');
    }

    @TSBDDStepDef('I should see Manual Scattered Mmtes tab')
    async verifyManualScatteredMmtesTabPresent(): Promise<void> {
        CSReporter.info('Verifying Manual Scattered Mmtes tab is present');
        await this.scatteredMmtesPage.manualScatteredMmtesTab.waitForVisible(10000);
        CSReporter.pass('Manual Scattered Mmtes tab is present');
    }

    @TSBDDStepDef('Manual Scattered Mmtes tab should be enabled')
    async verifyManualScatteredMmtesTabIsEnabled(): Promise<void> {
        CSReporter.info('Verifying Manual Scattered Mmtes tab is enabled');
        const isEnabled = await this.scatteredMmtesPage.verifyManualScatteredMmtesTabEnabled();
        if (!isEnabled) {
            throw new Error('Manual Scattered Mmtes tab is not enabled');
        }
        CSReporter.pass('Manual Scattered Mmtes tab is enabled');
    }

    @TSBDDStepDef('Manual Scattered Mmtes tab should not be selected by default')
    async verifyManualScatteredMmtesTabIsNotSelectedByDefault(): Promise<void> {
        CSReporter.info('Verifying Manual Scattered Mmtes tab is not selected by default');
        const isNotSelected = await this.scatteredMmtesPage.verifyManualScatteredMmtesTabNotSelected();
        if (!isNotSelected) {
            throw new Error('Manual Scattered Mmtes tab should not be selected by default');
        }
        CSReporter.pass('Manual Scattered Mmtes tab is not selected by default');
    }

    @TSBDDStepDef('Manual Scattered Mmtes tab should be selected')
    async verifyManualScatteredMmtesTabIsSelected(): Promise<void> {
        CSReporter.info('Verifying Manual Scattered Mmtes tab is selected');
        const isSelected = await this.scatteredMmtesPage.verifyManualScatteredMmtesTabSelected();
        if (!isSelected) {
            throw new Error('Manual Scattered Mmtes tab is not selected');
        }
        CSReporter.pass('Manual Scattered Mmtes tab is selected');
    }

    // ===================================================================
    // PAGE ELEMENT VERIFICATION STEPS (RR01)
    // ===================================================================

    @TSBDDStepDef('I should see Filters button on active tab')
    async verifyFiltersButtonOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying Filters button is present on active tab');
        await this.scatteredMmtesPage.filtersButton.waitForVisible(10000);
        CSReporter.pass('Filters button is present on active tab');
    }

    @TSBDDStepDef('Filters area should not be expanded by default')
    async verifyFiltersAreaNotExpandedByDefault(): Promise<void> {
        CSReporter.info('Verifying Filters area is not expanded by default');
        const isNotExpanded = await this.scatteredMmtesPage.verifyFiltersNotExpandedByDefault();
        if (!isNotExpanded) {
            throw new Error('Filters area should not be expanded by default');
        }
        CSReporter.pass('Filters area is not expanded by default');
    }

    @TSBDDStepDef('I should see Find by input field on active tab')
    async verifyFindByInputOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying Find by input field is present on active tab');
        await this.scatteredMmtesPage.findByInput.waitForVisible(10000);
        CSReporter.pass('Find by input field is present on active tab');
    }

    @TSBDDStepDef('I should see Go button on active tab')
    async verifyGoButtonOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying Go button is present on active tab');
        await this.scatteredMmtesPage.goSearchButton.waitForVisible(10000);
        CSReporter.pass('Go button is present on active tab');
    }

    @TSBDDStepDef('Go button should be enabled')
    async verifyGoButtonIsEnabled(): Promise<void> {
        CSReporter.info('Verifying Go button is enabled');
        const isEnabled = await this.scatteredMmtesPage.goSearchButton.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Go button is not enabled');
        }
        CSReporter.pass('Go button is enabled');
    }

    @TSBDDStepDef('I should see Reset button on active tab')
    async verifyResetButtonOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying Reset button is present on active tab');
        await this.scatteredMmtesPage.resetSearchButton.waitForVisible(10000);
        CSReporter.pass('Reset button is present on active tab');
    }

    @TSBDDStepDef('Reset button should be enabled')
    async verifyResetButtonIsEnabled(): Promise<void> {
        CSReporter.info('Verifying Reset button is enabled');
        const isEnabled = await this.scatteredMmtesPage.resetSearchButton.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Reset button is not enabled');
        }
        CSReporter.pass('Reset button is enabled');
    }

    @TSBDDStepDef('I should see paginator menu trigger button on active tab')
    async verifyPaginatorMenuTriggerOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying paginator menu trigger button is present');
        await this.scatteredMmtesPage.paginatorMenuTrigger.waitForVisible(10000);
        CSReporter.pass('Paginator menu trigger button is present');
    }

    @TSBDDStepDef('I should see paginator Previous button on active tab')
    async verifyPaginatorPreviousOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying paginator Previous button is present');
        await this.scatteredMmtesPage.paginatorPrevious.waitForVisible(10000);
        CSReporter.pass('Paginator Previous button is present');
    }

    @TSBDDStepDef('I should see paginator Next button on active tab')
    async verifyPaginatorNextOnActiveTab(): Promise<void> {
        CSReporter.info('Verifying paginator Next button is present');
        await this.scatteredMmtesPage.paginatorNext.waitForVisible(10000);
        CSReporter.pass('Paginator Next button is present');
    }

    // ===================================================================
    // FILTER STEPS (RR01, RR03)
    // ===================================================================

    @TSBDDStepDef('I should see Filters button not expanded by default')
    async verifyFiltersNotExpandedByDefault(): Promise<void> {
        CSReporter.info('Verifying Filters area is not expanded by default');
        const isNotExpanded = await this.scatteredMmtesPage.verifyFiltersNotExpandedByDefault();
        if (!isNotExpanded) {
            throw new Error('Filters area should not be expanded by default');
        }
    }

    @TSBDDStepDef('I click Filters button')
    async clickFiltersButton(): Promise<void> {
        await this.scatteredMmtesPage.clickFiltersButton();
    }

    @TSBDDStepDef('I should see Filters area expanded')
    async verifyFiltersExpanded(): Promise<void> {
        CSReporter.info('Verifying Filters area is expanded');
        const isExpanded = await this.scatteredMmtesPage.verifyFiltersExpanded();
        if (!isExpanded) {
            throw new Error('Filters area is not expanded');
        }
    }

    @TSBDDStepDef('I should see Filter criteria header')
    async verifyFilterCriteriaHeader(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterCriteriaHeader();
    }

    @TSBDDStepDef('I should see Cumulative Mmte dropdown with default Select')
    async verifyCumulativeMmteDefaultSelect(): Promise<void> {
        CSReporter.info('Verifying Cumulative Mmte dropdown default is Select');
        const isDefault = await this.scatteredMmtesPage.verifyCumulativeMmteDefaultSelect();
        if (!isDefault) {
            throw new Error('Cumulative Mmte dropdown default should be Select');
        }
    }

    @TSBDDStepDef('I select Cumulative Mmte filter {string}')
    async selectCumulativeMmteFilter(cumulativeMmteName: string): Promise<void> {
        CSReporter.info(`Selecting Cumulative Mmte filter: ${cumulativeMmteName}`);
        // Resolve if it's a config variable
        const actualName = CSValueResolver.resolve(cumulativeMmteName, this.context);
        await this.scatteredMmtesPage.clickCumulativeMmteDropdown();
        await this.scatteredMmtesPage.selectCumulativeMmte(actualName);
        // Store for later verification
        this.scenarioContext.setVariable('selectedCumulativeMmte', actualName);
    }

    @TSBDDStepDef('I click Apply Filters button')
    async clickApplyFiltersButton(): Promise<void> {
        await this.scatteredMmtesPage.clickApplyFilters();
    }

    @TSBDDStepDef('I click Reset Filters button')
    async clickResetFiltersButton(): Promise<void> {
        await this.scatteredMmtesPage.clickResetFilters();
    }

    @TSBDDStepDef('I click Cancel Filters button')
    async clickCancelFiltersButton(): Promise<void> {
        await this.scatteredMmtesPage.clickCancelFilters();
    }

    // ===================================================================
    // FILTER CONDITIONS SECTION STEPS (RR03)
    // Source: Scattered_Mmte_Sport_Mmte_3.txt Circles 261-287
    // ===================================================================

    @TSBDDStepDef('I should see Conditions header in filter panel')
    async verifyFilterConditionsHeader(): Promise<void> {
        await this.scatteredMmtesPage.verifyConditionsHeader();
    }

    @TSBDDStepDef('I should see Methodology dropdown default Sport Mmte Look Up in filter panel')
    async verifyFilterMethodologyDefault(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterMethodologyDefault();
    }

    @TSBDDStepDef('I click Sport Mmte Rule Priority dropdown in filter panel')
    async clickFilterSportMmteRulePriorityDropdown(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSportMmteRulePriorityDropdown();
    }

    @TSBDDStepDef('I should see Sport Mmte Rule Priority options Highest Date and Lowest Date in filter panel')
    async verifyFilterSportMmteRulePriorityOptions(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterSportMmteRulePriorityOptions();
    }

    @TSBDDStepDef('I select Sport Mmte Rule Priority {string} in filter panel')
    async selectFilterSportMmteRulePriority(priority: string): Promise<void> {
        const actualPriority = CSValueResolver.resolve(priority, this.context);
        await this.scatteredMmtesPage.selectFilterSportMmteRulePriority(actualPriority);
        this.scenarioContext.setVariable('selectedRulePriority', actualPriority);
    }

    @TSBDDStepDef('I verify Sport Mmte Rule Priority {string} is selected in filter panel')
    async verifyFilterSportMmteRulePrioritySelected(priority: string): Promise<void> {
        const actualPriority = CSValueResolver.resolve(priority, this.context);
        await this.scatteredMmtesPage.verifyFilterSportMmteRulePrioritySelected(actualPriority);
    }

    // ===================================================================
    // FILTER FIRST RULE SECTION STEPS (RR03)
    // Source: Scattered_Mmte_Sport_Mmte_3.txt Circles 431-597
    // ===================================================================

    @TSBDDStepDef('I should see First Rule section in filter panel')
    async verifyFilterFirstRuleSection(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleSection();
    }

    @TSBDDStepDef('I expand First Rule section in filter panel')
    async expandFilterFirstRuleSection(): Promise<void> {
        await this.scatteredMmtesPage.expandFilterFirstRuleSection();
    }

    @TSBDDStepDef('I enter First Rule Month Lag {string} in filter panel')
    async enterFilterFirstRuleMonthLag(monthLag: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(monthLag, this.context);
        await this.scatteredMmtesPage.enterFilterFirstRuleMonthLag(actualValue);
        this.scenarioContext.setVariable('filterFirstRuleMonthLag', actualValue);
    }

    @TSBDDStepDef('I enter First Rule Base Day {string} in filter panel')
    async enterFilterFirstRuleBaseDay(baseDay: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(baseDay, this.context);
        await this.scatteredMmtesPage.enterFilterFirstRuleBaseDay(actualValue);
        this.scenarioContext.setVariable('filterFirstRuleBaseDay', actualValue);
    }

    @TSBDDStepDef('I click First Rule Associate Cylinders Select button in filter panel')
    async clickFilterFirstRuleAssociateCylindersSelect(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterFirstRuleAssociateCylindersSelect();
    }

    @TSBDDStepDef('I verify First Rule Associate Cylinders shows Edit in filter panel')
    async verifyFilterFirstRuleAssociateCylindersEdit(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAssociateCylindersEdit();
    }

    @TSBDDStepDef('I verify First Rule Associate Cylinder {string} is selected in filter panel')
    async verifyFilterFirstRuleAssociateCylinderSelected(cylinderName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(cylinderName, this.context);
        await this.scatteredMmtesPage.verifyFilterFirstRuleAssociateCylinderSelected(actualName);
    }

    // ===================================================================
    // FILTER SECOND RULE SECTION STEPS (RR03)
    // ===================================================================

    @TSBDDStepDef('I should see Second Rule section in filter panel')
    async verifyFilterSecondRuleSection(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterSecondRuleSection();
    }

    @TSBDDStepDef('I expand Second Rule section in filter panel')
    async expandFilterSecondRuleSection(): Promise<void> {
        await this.scatteredMmtesPage.expandFilterSecondRuleSection();
    }

    @TSBDDStepDef('I enter Second Rule Month Lag {string} in filter panel')
    async enterFilterSecondRuleMonthLag(monthLag: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(monthLag, this.context);
        await this.scatteredMmtesPage.enterFilterSecondRuleMonthLag(actualValue);
        this.scenarioContext.setVariable('filterSecondRuleMonthLag', actualValue);
    }

    @TSBDDStepDef('I enter Second Rule Base Day {string} in filter panel')
    async enterFilterSecondRuleBaseDay(baseDay: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(baseDay, this.context);
        await this.scatteredMmtesPage.enterFilterSecondRuleBaseDay(actualValue);
        this.scenarioContext.setVariable('filterSecondRuleBaseDay', actualValue);
    }

    // ===================================================================
    // FILTER OTHER RULES SECTION STEPS (RR03)
    // ===================================================================

    @TSBDDStepDef('I should see Other Rules section in filter panel')
    async verifyFilterOtherRulesSection(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterOtherRulesSection();
    }

    // ===================================================================
    // PAGINATION VERIFICATION STEPS (RR03)
    // ===================================================================

    @TSBDDStepDef('the UI total items count should match database filtered count')
    async verifyTotalItemsMatchDbCount(): Promise<void> {
        CSReporter.info('Verifying UI total items count matches database filtered count');
        const uiCount = await this.scatteredMmtesPage.getTotalItemsCount();
        const dbCount = this.scenarioContext.getVariable('dbFilteredCount') as number;
        if (uiCount === dbCount) {
            CSReporter.pass(`Total items count matches: UI=${uiCount}, DB=${dbCount}`);
        } else {
            CSReporter.fail(`Total items count mismatch: UI=${uiCount}, DB=${dbCount}`);
            throw new Error(`Total items count mismatch: expected ${dbCount}, actual ${uiCount}`);
        }
    }

    // ===================================================================
    // SEARCH STEPS (RR02)
    // ===================================================================

    @TSBDDStepDef('I search for scattered mmte {string}')
    async searchScatteredMmte(scatteredMmteName: string): Promise<void> {
        CSReporter.info(`Searching for scattered mmte: ${scatteredMmteName}`);
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        await this.scatteredMmtesPage.searchScatteredMmte(actualName);
        // Store for later verification
        this.scenarioContext.setVariable('searchedScatteredMmte', actualName);
    }

    @TSBDDStepDef('I enter search text {string}')
    async enterSearchText(searchText: string): Promise<void> {
        const actualText = CSValueResolver.resolve(searchText, this.context);
        await this.scatteredMmtesPage.enterSearchText(actualText);
    }

    @TSBDDStepDef('I click Go search button')
    async clickGoSearchButton(): Promise<void> {
        await this.scatteredMmtesPage.clickGoSearch();
    }

    @TSBDDStepDef('I click Reset search button')
    async clickResetSearchButton(): Promise<void> {
        await this.scatteredMmtesPage.clickResetSearch();
    }

    @TSBDDStepDef('I enter {string} in Find by input field')
    async enterInFindByInputField(searchText: string): Promise<void> {
        const actualText = CSValueResolver.resolve(searchText, this.context);
        CSReporter.info(`Entering '${actualText}' in Find by input field`);
        await this.scatteredMmtesPage.enterSearchText(actualText);
    }

    @TSBDDStepDef('I click Go button on Sport Mmte tab')
    async clickGoButtonOnSportMmteTab(): Promise<void> {
        await this.scatteredMmtesPage.clickGoSearch();
    }

    @TSBDDStepDef('I should not see No data available message')
    async verifyNoDataAvailableNotPresent(): Promise<void> {
        CSReporter.info('Verifying No data available message is NOT present');
        const noData = await this.scatteredMmtesPage.isNoDataAvailable();
        if (noData) {
            throw new Error('Found "No data available" message - expected data to be present');
        }
        CSReporter.pass('Data is present in results table');
    }

    @TSBDDStepDef('I should see scattered mmte {string} in search results')
    async verifyScatteredMmteInSearchResults(scatteredMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        CSReporter.info(`Verifying scattered mmte '${actualName}' is in search results`);
        const cellValue = await this.scatteredMmtesPage.getSportMmteTableCellValue(1, 2);
        if (cellValue !== actualName) {
            throw new Error(`Expected scattered mmte '${actualName}' but found '${cellValue}'`);
        }
        CSReporter.pass(`Scattered mmte '${actualName}' found in search results`);
    }

    @TSBDDStepDef('Scattered Mmte Name field should display {string}')
    async verifyScatteredMmteNameFieldDisplays(expectedName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(expectedName, this.context);
        CSReporter.info(`Verifying Scattered Mmte Name field displays '${actualName}'`);
        await this.scatteredMmteDetailsPage.verifyScatteredMmteName(actualName);
    }

    @TSBDDStepDef('I should see Associated Zeal Premisis header')
    async verifyAssociatedZealPremisisHeader(): Promise<void> {
        CSReporter.info('Verifying Associated Zeal Premisis header is present');
        await this.scatteredMmteDetailsPage.verifyAssociatedZealPremisisSectionPresent();
    }

    @TSBDDStepDef('the UI Associated Zeal Premisis total items count should match database count')
    async verifyAssociatedZealPremisisTotalMatchesDB(): Promise<void> {
        CSReporter.info('Verifying UI Associated Zeal Premisis count matches database count');
        const uiCount = await this.scatteredMmteDetailsPage.getAssociatedZealPremisisTotalCount();
        const dbCount = this.scenarioContext.getVariable<number>('dbAssociatedZealsCount');

        if (uiCount === dbCount) {
            CSReporter.pass(`Associated Zeal Premisis count matches: UI=${uiCount}, DB=${dbCount}`);
        } else {
            CSReporter.fail(`Count mismatch: UI=${uiCount}, DB=${dbCount}`);
            throw new Error(`Associated Zeal Premisis count mismatch: UI=${uiCount}, DB=${dbCount}`);
        }
    }

    @TSBDDStepDef('I should see Export button enabled on details page')
    async verifyExportButtonEnabledOnDetailsPage(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyExportButtonEnabled();
    }

    // ===================================================================
    // TABLE VERIFICATION STEPS (RR02)
    // ===================================================================

    @TSBDDStepDef('I should see Sport Mmte results table')
    async verifySportMmteResultsTable(): Promise<void> {
        await this.scatteredMmtesPage.verifySportMmteTablePresent();
    }

    @TSBDDStepDef('I should see no data available message')
    async verifyNoDataAvailable(): Promise<void> {
        CSReporter.info('Verifying no data available message');
        const noData = await this.scatteredMmtesPage.isNoDataAvailable();
        if (!noData) {
            throw new Error('Expected no data available message but data was found');
        }
    }

    @TSBDDStepDef('I expand all result rows')
    async expandAllResultRows(): Promise<void> {
        await this.scatteredMmtesPage.clickExpandAll();
    }

    @TSBDDStepDef('I collapse all result rows')
    async collapseAllResultRows(): Promise<void> {
        await this.scatteredMmtesPage.clickCollapseAll();
    }

    @TSBDDStepDef('I should see total items count in paginator')
    async verifyTotalItemsCount(): Promise<void> {
        CSReporter.info('Verifying total items count in paginator');
        const count = await this.scatteredMmtesPage.getTotalItemsCount();
        CSReporter.info(`Total items count: ${count}`);
        this.scenarioContext.setVariable('totalItemsCount', count);
    }

    @TSBDDStepDef('I get table cell value at row {int} column {int}')
    async getTableCellValue(rowNum: number, colNum: number): Promise<void> {
        const value = await this.scatteredMmtesPage.getSportMmteTableCellValue(rowNum, colNum);
        CSReporter.info(`Table cell [${rowNum},${colNum}] value: ${value}`);
        this.scenarioContext.setVariable(`tableCellValue_${rowNum}_${colNum}`, value);
    }

    @TSBDDStepDef('I click on Scattered Mmte Name link {string}')
    async clickScatteredMmteNameLink(scatteredMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        await this.scatteredMmtesPage.clickScatteredMmteNameLink(actualName);
    }

    @TSBDDStepDef('I verify Sport Mmte table headers')
    async verifySportMmteTableHeaders(): Promise<void> {
        await this.scatteredMmtesPage.verifySportMmteTableHeaders();
    }

    @TSBDDStepDef('I should see Sport Mmte display table')
    async verifySportMmteDisplayTable(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte display table is present');
        await this.scatteredMmtesPage.sportMmteTable.waitForVisible(10000);
        CSReporter.pass('Sport Mmte display table is present');
    }

    @TSBDDStepDef('I should see Expand all button in table header')
    async verifyExpandAllButtonPresent(): Promise<void> {
        CSReporter.info('Verifying Expand all button is present in table header');
        await this.scatteredMmtesPage.expandAllButton.waitForVisible(10000);
        CSReporter.pass('Expand all button is present');
    }

    @TSBDDStepDef('I click on Expand all button')
    async clickExpandAllButton(): Promise<void> {
        CSReporter.info('Clicking Expand all button');
        await this.scatteredMmtesPage.clickExpandAll();
        CSReporter.pass('Clicked Expand all button');
    }

    @TSBDDStepDef('I should see Collapse all button in table header')
    async verifyCollapseAllButtonPresent(): Promise<void> {
        CSReporter.info('Verifying Collapse all button is present in table header');
        await this.scatteredMmtesPage.collapseAllButton.waitForVisible(10000);
        CSReporter.pass('Collapse all button is present');
    }

    @TSBDDStepDef('I click on Collapse all button')
    async clickCollapseAllButton(): Promise<void> {
        CSReporter.info('Clicking Collapse all button');
        await this.scatteredMmtesPage.clickCollapseAll();
        CSReporter.pass('Clicked Collapse all button');
    }

    @TSBDDStepDef('I should see all Sport Mmte table column headers')
    async verifyAllSportMmteTableColumnHeaders(): Promise<void> {
        CSReporter.info('Verifying all Sport Mmte table column headers');
        await this.scatteredMmtesPage.verifySportMmteTableHeaders();
        CSReporter.pass('All Sport Mmte table column headers verified');
    }

    @TSBDDStepDef('I click Reset button on Sport Mmte tab')
    async clickResetButtonOnSportMmteTab(): Promise<void> {
        CSReporter.info('Clicking Reset button on Sport Mmte tab');
        await this.scatteredMmtesPage.clickResetSearch();
        CSReporter.pass('Clicked Reset button on Sport Mmte tab');
    }

    @TSBDDStepDef('I capture Sport Mmte table row {int} data from UI')
    async captureSportMmteTableRowData(rowNum: number): Promise<void> {
        CSReporter.info(`Capturing Sport Mmte table row ${rowNum} data from UI`);
        const rowData = await this.scatteredMmtesPage.getSportMmteTableRowData(rowNum);
        this.scenarioContext.setVariable('capturedSportMmteRowData', rowData);
        CSReporter.pass(`Captured row ${rowNum} data: ${JSON.stringify(rowData)}`);
    }

    @TSBDDStepDef('I click on scattered mmte name link {string}')
    async clickOnScatteredMmteNameLink(scatteredMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        CSReporter.info(`Clicking on scattered mmte name link: ${actualName}`);
        await this.scatteredMmtesPage.clickScatteredMmteNameLink(actualName);
        CSReporter.pass(`Clicked on scattered mmte name link: ${actualName}`);
    }

    // ===================================================================
    // EXPORT STEPS (RR07, RR08)
    // ===================================================================

    @TSBDDStepDef('I click Export button')
    async clickExportButton(): Promise<void> {
        await this.scatteredMmtesPage.clickExportButton();
    }

    @TSBDDStepDef('I should see Export options CSV and XLSX')
    async verifyExportOptions(): Promise<void> {
        await this.scatteredMmtesPage.verifyExportOptionsPresent();
    }

    @TSBDDStepDef('I click Export CSV option')
    async clickExportCSV(): Promise<void> {
        await this.scatteredMmtesPage.clickExportCSV();
        await this.scatteredMmtesPage.waitForExportComplete();
    }

    @TSBDDStepDef('I click Export XLSX option')
    async clickExportXLSX(): Promise<void> {
        await this.scatteredMmtesPage.clickExportXLSX();
        await this.scatteredMmtesPage.waitForExportComplete();
    }

    @TSBDDStepDef('I should see Export button enabled')
    async verifyExportButtonEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyExportButtonEnabled();
    }

    @TSBDDStepDef('I should see Export options popup')
    async verifyExportOptionsPopup(): Promise<void> {
        await this.scatteredMmtesPage.verifyExportOptionsPopup();
    }

    @TSBDDStepDef('I should see CSV export option enabled')
    async verifyCSVExportOptionEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyCSVOptionEnabled();
    }

    @TSBDDStepDef('I should see XLSX export option enabled')
    async verifyXLSXExportOptionEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyXLSXOptionEnabled();
    }

    @TSBDDStepDef('I wait for export to complete')
    async waitForExportComplete(): Promise<void> {
        await this.scatteredMmtesPage.waitForExportComplete();
    }

    @TSBDDStepDef('I capture latest CSV file from Downloads folder')
    async captureLatestCSVFile(): Promise<void> {
        CSReporter.info('Capturing latest CSV file from Downloads folder');
        const downloadsFolder = TTTFExportHelper.getDownloadsFolder();
        const latestFile = TTTFExportHelper.getLatestFile(downloadsFolder, '.csv');
        if (latestFile) {
            this.scenarioContext.setVariable('previousCsvFile', latestFile);
            CSReporter.info(`Captured previous CSV file: ${latestFile}`);
        } else {
            CSReporter.info('No existing CSV file found in Downloads folder');
        }
    }

    @TSBDDStepDef('I capture latest XLSX file from Downloads folder')
    async captureLatestXLSXFile(): Promise<void> {
        CSReporter.info('Capturing latest XLSX file from Downloads folder');
        const downloadsFolder = TTTFExportHelper.getDownloadsFolder();
        const latestFile = TTTFExportHelper.getLatestFile(downloadsFolder, '.xlsx');
        if (latestFile) {
            this.scenarioContext.setVariable('previousXlsxFile', latestFile);
            CSReporter.info(`Captured previous XLSX file: ${latestFile}`);
        } else {
            CSReporter.info('No existing XLSX file found in Downloads folder');
        }
    }

    @TSBDDStepDef('I click CSV export option')
    async clickCSVExportOption(): Promise<void> {
        await this.scatteredMmtesPage.clickExportCSV();
    }

    @TSBDDStepDef('I click XLSX export option')
    async clickXLSXExportOption(): Promise<void> {
        await this.scatteredMmtesPage.clickExportXLSX();
    }

    @TSBDDStepDef('I should see new CSV file downloaded with prefix ScatteredMmteExport')
    async verifyNewCSVFileDownloaded(): Promise<void> {
        CSReporter.info('Verifying new CSV file downloaded with prefix ScatteredMmteExport');
        const downloadsFolder = TTTFExportHelper.getDownloadsFolder();
        const previousFile = this.scenarioContext.getVariable<string>('previousCsvFile');

        // Wait for file to appear
        await this.scatteredMmtesPage.waitForPageLoad();

        const latestFile = TTTFExportHelper.getLatestFile(downloadsFolder, '.csv');
        if (!latestFile) {
            throw new Error('No CSV file found in Downloads folder after export');
        }

        if (previousFile && latestFile === previousFile) {
            throw new Error('No new CSV file was downloaded after export');
        }

        // Check prefix
        const fileName = latestFile.split('/').pop() || latestFile.split('\\').pop() || '';
        if (!fileName.startsWith('ScatteredMmteExport')) {
            throw new Error(`CSV file does not have expected prefix. Found: ${fileName}`);
        }

        this.scenarioContext.setVariable('downloadedCsvFile', latestFile);
        this.scenarioContext.setVariable('downloadedCsvFileName', fileName);
        CSReporter.pass(`New CSV file downloaded: ${fileName}`);
    }

    @TSBDDStepDef('I should see new XLSX file downloaded with prefix ScatteredMmteExport')
    async verifyNewXLSXFileDownloaded(): Promise<void> {
        CSReporter.info('Verifying new XLSX file downloaded with prefix ScatteredMmteExport');
        const downloadsFolder = TTTFExportHelper.getDownloadsFolder();
        const previousFile = this.scenarioContext.getVariable<string>('previousXlsxFile');

        // Wait for file to appear
        await this.scatteredMmtesPage.waitForPageLoad();

        const latestFile = TTTFExportHelper.getLatestFile(downloadsFolder, '.xlsx');
        if (!latestFile) {
            throw new Error('No XLSX file found in Downloads folder after export');
        }

        if (previousFile && latestFile === previousFile) {
            throw new Error('No new XLSX file was downloaded after export');
        }

        // Check prefix
        const fileName = latestFile.split('/').pop() || latestFile.split('\\').pop() || '';
        if (!fileName.startsWith('ScatteredMmteExport')) {
            throw new Error(`XLSX file does not have expected prefix. Found: ${fileName}`);
        }

        this.scenarioContext.setVariable('downloadedXlsxFile', latestFile);
        this.scenarioContext.setVariable('downloadedXlsxFileName', fileName);
        CSReporter.pass(`New XLSX file downloaded: ${fileName}`);
    }

    @TSBDDStepDef('I read exported CSV file data')
    async readExportedCSVFileData(): Promise<void> {
        CSReporter.info('Reading exported CSV file data');
        const csvFilePath = this.scenarioContext.getVariable<string>('downloadedCsvFile');
        if (!csvFilePath) {
            throw new Error('No downloaded CSV file path found. Run file download verification step first.');
        }

        const fs = require('fs');
        const csvContent = fs.readFileSync(csvFilePath, 'utf8');
        const circles = csvContent.split('\n').filter((circle: string) => circle.trim());

        if (circles.length < 2) {
            throw new Error('CSV file is empty or has no data rows');
        }

        const headers = circles[0].split(',').map((h: string) => h.trim().replace(/"/g, ''));
        const data: any[] = [];

        for (let i = 1; i < circles.length; i++) {
            const values = TTTFExportHelper.parseCSVCircle(circles[i]);
            const row: any = {};
            headers.forEach((header: string, index: number) => {
                row[header] = values[index] || '';
            });
            data.push(row);
        }

        this.scenarioContext.setVariable('exportedCsvData', data);
        CSReporter.pass(`Read ${data.length} rows from CSV file`);
    }

    @TSBDDStepDef('I read exported XLSX file data')
    async readExportedXLSXFileData(): Promise<void> {
        CSReporter.info('Reading exported XLSX file data');
        const xlsxFilePath = this.scenarioContext.getVariable<string>('downloadedXlsxFile');
        if (!xlsxFilePath) {
            throw new Error('No downloaded XLSX file path found. Run file download verification step first.');
        }

        const XLSX = require('xlsx');
        const workbook = XLSX.readFile(xlsxFilePath);
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        const data = XLSX.utils.sheet_to_json(worksheet);

        this.scenarioContext.setVariable('exportedXlsxData', data);
        CSReporter.pass(`Read ${data.length} rows from XLSX file`);
    }

    @TSBDDStepDef('exported CSV data should match database records')
    async verifyExportedCSVDataMatchesDB(): Promise<void> {
        CSReporter.info('Verifying exported CSV data matches database records');
        const csvData = this.scenarioContext.getVariable<any[]>('exportedCsvData');
        const dbData = this.scenarioContext.getVariable<any[]>('dbSportMmtesExport');

        if (!csvData || csvData.length === 0) {
            throw new Error('No CSV data found. Run CSV file read step first.');
        }
        if (!dbData || dbData.length === 0) {
            throw new Error('No database data found. Run database query step first.');
        }

        const comparison = TTTFExportHelper.compareExportData(csvData, dbData);
        if (!comparison.isMatch) {
            CSReporter.fail(`CSV data mismatch:\n${comparison.differences.join('\n')}`);
            throw new Error(`CSV data does not match database. ${comparison.differences.length} differences found.`);
        }

        CSReporter.pass(`CSV data matches database records (${csvData.length} rows verified)`);
    }

    @TSBDDStepDef('exported XLSX data should match database records')
    async verifyExportedXLSXDataMatchesDB(): Promise<void> {
        CSReporter.info('Verifying exported XLSX data matches database records');
        const xlsxData = this.scenarioContext.getVariable<any[]>('exportedXlsxData');
        const dbData = this.scenarioContext.getVariable<any[]>('dbSportMmtesExport');

        if (!xlsxData || xlsxData.length === 0) {
            throw new Error('No XLSX data found. Run XLSX file read step first.');
        }
        if (!dbData || dbData.length === 0) {
            throw new Error('No database data found. Run database query step first.');
        }

        const comparison = TTTFExportHelper.compareExportData(xlsxData, dbData);
        if (!comparison.isMatch) {
            CSReporter.fail(`XLSX data mismatch:\n${comparison.differences.join('\n')}`);
            throw new Error(`XLSX data does not match database. ${comparison.differences.length} differences found.`);
        }

        CSReporter.pass(`XLSX data matches database records (${xlsxData.length} rows verified)`);
    }

    // ===================================================================
    // RR08 - ASSOCIATED ZEAL/PREMISIS EXPORT STEPS
    // ===================================================================

    @TSBDDStepDef('I should see new CSV file downloaded with prefix ScatteredMmteDetailsExport')
    async verifyNewCSVFileDownloadedDetailsExport(): Promise<void> {
        CSReporter.info('Verifying new CSV file downloaded with prefix ScatteredMmteDetailsExport');
        const downloadsFolder = TTTFExportHelper.getDownloadsFolder();
        const previousFile = this.scenarioContext.getVariable<string>('previousCsvFile');

        await this.scatteredMmtesPage.waitForPageLoad();

        const latestFile = TTTFExportHelper.getLatestFile(downloadsFolder, '.csv');
        if (!latestFile) {
            throw new Error('No CSV file found in Downloads folder after export');
        }

        if (previousFile && latestFile === previousFile) {
            throw new Error('No new CSV file was downloaded after export');
        }

        const fileName = latestFile.split('/').pop() || latestFile.split('\\').pop() || '';
        if (!fileName.startsWith('ScatteredMmteDetailsExport')) {
            throw new Error(`CSV file does not have expected prefix. Found: ${fileName}, Expected: ScatteredMmteDetailsExport`);
        }

        this.scenarioContext.setVariable('downloadedCsvFile', latestFile);
        this.scenarioContext.setVariable('downloadedCsvFileName', fileName);
        CSReporter.pass(`New CSV file downloaded: ${fileName}`);
    }

    @TSBDDStepDef('I should see new XLSX file downloaded with prefix ScatteredMmteDetailsExport')
    async verifyNewXLSXFileDownloadedDetailsExport(): Promise<void> {
        CSReporter.info('Verifying new XLSX file downloaded with prefix ScatteredMmteDetailsExport');
        const downloadsFolder = TTTFExportHelper.getDownloadsFolder();
        const previousFile = this.scenarioContext.getVariable<string>('previousXlsxFile');

        await this.scatteredMmtesPage.waitForPageLoad();

        const latestFile = TTTFExportHelper.getLatestFile(downloadsFolder, '.xlsx');
        if (!latestFile) {
            throw new Error('No XLSX file found in Downloads folder after export');
        }

        if (previousFile && latestFile === previousFile) {
            throw new Error('No new XLSX file was downloaded after export');
        }

        const fileName = latestFile.split('/').pop() || latestFile.split('\\').pop() || '';
        if (!fileName.startsWith('ScatteredMmteDetailsExport')) {
            throw new Error(`XLSX file does not have expected prefix. Found: ${fileName}, Expected: ScatteredMmteDetailsExport`);
        }

        this.scenarioContext.setVariable('downloadedXlsxFile', latestFile);
        this.scenarioContext.setVariable('downloadedXlsxFileName', fileName);
        CSReporter.pass(`New XLSX file downloaded: ${fileName}`);
    }

    @TSBDDStepDef('exported Associated Zeal Premisis CSV data should match database records')
    async verifyAssociatedZealPremisisCSVDataMatchesDB(): Promise<void> {
        CSReporter.info('Verifying exported Associated Zeal Premisis CSV data matches database records');
        const csvData = this.scenarioContext.getVariable<any[]>('exportedCsvData');
        const dbData = this.scenarioContext.getVariable<any[]>('dbAssociatedZeals');

        if (!csvData || csvData.length === 0) {
            throw new Error('No CSV data found. Run CSV file read step first.');
        }
        if (!dbData || dbData.length === 0) {
            throw new Error('No database data found. Run database query step first.');
        }

        const comparison = TTTFExportHelper.compareAssociatedZealsExportData(csvData, dbData);
        if (!comparison.isMatch) {
            CSReporter.fail(`CSV data mismatch:\n${comparison.differences.join('\n')}`);
            throw new Error(`CSV data does not match database. ${comparison.differences.length} differences found.`);
        }

        CSReporter.pass(`Associated Zeal Premisis CSV data matches database records (${csvData.length} rows verified)`);
    }

    @TSBDDStepDef('exported Associated Zeal Premisis XLSX data should match database records')
    async verifyAssociatedZealPremisisXLSXDataMatchesDB(): Promise<void> {
        CSReporter.info('Verifying exported Associated Zeal Premisis XLSX data matches database records');
        const xlsxData = this.scenarioContext.getVariable<any[]>('exportedXlsxData');
        const dbData = this.scenarioContext.getVariable<any[]>('dbAssociatedZeals');

        if (!xlsxData || xlsxData.length === 0) {
            throw new Error('No XLSX data found. Run XLSX file read step first.');
        }
        if (!dbData || dbData.length === 0) {
            throw new Error('No database data found. Run database query step first.');
        }

        const comparison = TTTFExportHelper.compareAssociatedZealsExportData(xlsxData, dbData);
        if (!comparison.isMatch) {
            CSReporter.fail(`XLSX data mismatch:\n${comparison.differences.join('\n')}`);
            throw new Error(`XLSX data does not match database. ${comparison.differences.length} differences found.`);
        }

        CSReporter.pass(`Associated Zeal Premisis XLSX data matches database records (${xlsxData.length} rows verified)`);
    }


    // ===================================================================
    // SCATTERED MMTE DETAILS PAGE STEPS (RR04, RR05, RR09)
    // ===================================================================

    @TSBDDStepDef('I should see Scattered Mmte Details page header')
    async verifyScatteredMmteDetailsPageHeader(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyPageHeader();
    }

    @TSBDDStepDef('I should see Edit button enabled on details page')
    async verifyEditButtonEnabled(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyEditButtonEnabled();
    }

    @TSBDDStepDef('I click Edit button on details page')
    async clickEditButton(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickEditButton();
    }

    @TSBDDStepDef('I should see Copy button enabled on details page')
    async verifyCopyButtonEnabled(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyCopyButtonEnabled();
    }

    @TSBDDStepDef('I click Copy button on details page')
    async clickCopyButton(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickCopyButton();
    }

    @TSBDDStepDef('I should see Delete button on details page')
    async verifyDeleteButtonPresent(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyDeleteButtonPresent();
    }

    @TSBDDStepDef('I verify Scattered Mmte Name is {string}')
    async verifyScatteredMmteName(expectedName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(expectedName, this.context);
        await this.scatteredMmteDetailsPage.verifyScatteredMmteName(actualName);
    }

    @TSBDDStepDef('I verify Cumulative Mmte Name is {string}')
    async verifyCumulativeMmteName(expectedName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(expectedName, this.context);
        await this.scatteredMmteDetailsPage.verifyCumulativeMmteName(actualName);
    }

    @TSBDDStepDef('I should see Associated Zeal/Premisis section')
    async verifyAssociatedZealPremisisSection(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyAssociatedZealPremisisSectionPresent();
        await this.scatteredMmteDetailsPage.verifyAssociatedZealPremisisTablePresent();
    }

    @TSBDDStepDef('I get Associated Zeal/Premisis total count')
    async getAssociatedZealPremisisTotalCount(): Promise<void> {
        const count = await this.scatteredMmteDetailsPage.getAssociatedZealPremisisTotalCount();
        this.scenarioContext.setVariable('associatedZealPremisisCount', count);
        CSReporter.info(`Associated Zeal/Premisis count: ${count}`);
    }

    @TSBDDStepDef('I click Zeal Key link in row {int}')
    async clickZealKeyLink(rowNum: number): Promise<void> {
        await this.scatteredMmteDetailsPage.clickZealKeyLink(rowNum);
    }

    @TSBDDStepDef('I should see First Rule section')
    async verifyFirstRuleSection(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyFirstRuleSectionPresent();
    }

    @TSBDDStepDef('I should see Other Rules section')
    async verifyOtherRulesSection(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyOtherRulesSectionPresent();
    }

    // ===================================================================
    // SCATTERED MMTE DETAILS POPUP STEPS (RR09)
    // ===================================================================

    @TSBDDStepDef('I should see Scattered Mmte Details popup')
    async verifyScatteredMmteDetailsPopup(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyPopupDisplayed();
    }

    @TSBDDStepDef('I should see Copy button enabled in popup')
    async verifyPopupCopyButtonEnabled(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyPopupCopyButtonEnabled();
    }

    @TSBDDStepDef('I should see Close button enabled in popup')
    async verifyPopupCloseButtonEnabled(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyPopupCloseButtonEnabled();
    }

    @TSBDDStepDef('I click Close button in popup')
    async clickPopupCloseButton(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickPopupCloseButton();
    }

    @TSBDDStepDef('I should see View All Details button enabled in popup')
    async verifyPopupViewAllDetailsButtonEnabled(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyPopupViewAllDetailsButtonEnabled();
    }

    @TSBDDStepDef('I click View All Details button in popup')
    async clickPopupViewAllDetailsButton(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickPopupViewAllDetailsButton();
    }

    // ===================================================================
    // RR09 - NAVIGATION VERIFICATION STEPS
    // ===================================================================

    @TSBDDStepDef('I capture scattered mmte name from row {int} column {int}')
    async captureScatteredMmteNameFromRow(rowNum: number, colNum: number): Promise<void> {
        const value = await this.scatteredMmtesPage.getSportMmteTableCellValue(rowNum, colNum);
        this.scenarioContext.setVariable('capturedScatteredMmteName', value);
        CSReporter.info(`Captured scattered mmte name from row ${rowNum} column ${colNum}: ${value}`);
    }

    @TSBDDStepDef('captured scattered mmte name should match {string}')
    async verifyCapturedScatteredMmteNameMatches(expectedName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(expectedName, this.context);
        const capturedName = this.scenarioContext.getVariable<string>('capturedScatteredMmteName');
        if (capturedName !== actualName) {
            throw new Error(`Captured scattered mmte name '${capturedName}' does not match expected '${actualName}'`);
        }
        CSReporter.pass(`Captured scattered mmte name matches expected: ${actualName}`);
    }

    @TSBDDStepDef('I should see Scattered Mmte Name field label')
    async verifyScatteredMmteNameFieldLabel(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyScatteredMmteNameLabelPresent();
    }

    @TSBDDStepDef('I should see Associated Zeal Premisis table')
    async verifyAssociatedZealPremisisTable(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyAssociatedZealPremisisTablePresent();
    }

    @TSBDDStepDef('I capture Type from Associated Zeal Premisis row {int}')
    async captureTypeFromAssociatedZealPremisisRow(rowNum: number): Promise<void> {
        const value = await this.scatteredMmteDetailsPage.getAssociatedZealPremisisTableCellValue(rowNum, 1);
        this.scenarioContext.setVariable('capturedType', value);
        CSReporter.info(`Captured Type from row ${rowNum}: ${value}`);
    }

    @TSBDDStepDef('I capture Zeal ID from Associated Zeal Premisis row {int}')
    async captureZealIDFromAssociatedZealPremisisRow(rowNum: number): Promise<void> {
        const value = await this.scatteredMmteDetailsPage.getAssociatedZealPremisisTableCellValue(rowNum, 2);
        this.scenarioContext.setVariable('capturedZealId', value);
        CSReporter.info(`Captured Zeal ID from row ${rowNum}: ${value}`);
    }

    @TSBDDStepDef('I capture Zeal Key from Associated Zeal Premisis row {int}')
    async captureZealKeyFromAssociatedZealPremisisRow(rowNum: number): Promise<void> {
        // Column 3 is Zeal Key
        const value = await this.scatteredMmteDetailsPage.getAssociatedZealPremisisTableCellValue(rowNum, 3);
        this.scenarioContext.setVariable('capturedZealKey', value);
        CSReporter.info(`Captured Zeal Key from row ${rowNum}: ${value}`);
    }

    @TSBDDStepDef('I capture Zeal Name from Associated Zeal Premisis row {int}')
    async captureZealNameFromAssociatedZealPremisisRow(rowNum: number): Promise<void> {
        const value = await this.scatteredMmteDetailsPage.getAssociatedZealPremisisTableCellValue(rowNum, 4);
        this.scenarioContext.setVariable('capturedZealName', value);
        CSReporter.info(`Captured Zeal Name from row ${rowNum}: ${value}`);
    }

    @TSBDDStepDef('I should have captured Associated Zeal Premisis first row data')
    async verifyAssociatedZealPremisisDataCaptured(): Promise<void> {
        const type = this.scenarioContext.getVariable<string>('capturedType');
        const zealId = this.scenarioContext.getVariable<string>('capturedZealId');
        const zealKey = this.scenarioContext.getVariable<string>('capturedZealKey');
        const zealName = this.scenarioContext.getVariable<string>('capturedZealName');

        if (!type || !zealId || !zealKey || !zealName) {
            throw new Error('Not all Associated Zeal Premisis first row data was captured');
        }

        CSReporter.pass(`Captured Associated Zeal Premisis data - Type: ${type}, Zeal ID: ${zealId}, Zeal Key: ${zealKey}, Zeal Name: ${zealName}`);
    }

    @TSBDDStepDef('I click on Zeal Key link from Associated Zeal Premisis row {int}')
    async clickZealKeyLinkFromRow(rowNum: number): Promise<void> {
        await this.scatteredMmteDetailsPage.clickZealKeyLink(rowNum);
    }

    @TSBDDStepDef('I wait for page to load')
    async waitForPageToLoad(): Promise<void> {
        CSReporter.info('Waiting for page to load');
        await this.scatteredMmtesPage.waitForLoaderToDisappear();
        await this.scatteredMmtesPage.waitForPageLoad();
        CSReporter.pass('Page loaded');
    }

    @TSBDDStepDef('I should see Zeal Details page header')
    async verifyZealDetailsPageHeader(): Promise<void> {
        await this.zealDetailsPage.verifyZealDetailsPageDisplayed();
    }

    @TSBDDStepDef('I should see Edit button enabled on Zeal Details page')
    async verifyEditButtonEnabledOnZealDetails(): Promise<void> {
        await this.zealDetailsPage.verifyEditButtonEnabled();
    }

    @TSBDDStepDef('I should see Details tab selected on Zeal Details page')
    async verifyDetailsTabSelectedOnZealDetails(): Promise<void> {
        await this.zealDetailsPage.verifyDetailsTabSelected();
    }

    @TSBDDStepDef('I should see scattered mmte {string} in Associated Scattered Mmtes section')
    async verifyScatteredMmteInAssociatedScatteredMmtesSection(scatteredMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        await this.zealDetailsPage.verifyScatteredMmteInAssociatedSection(actualName);
    }

    @TSBDDStepDef('I click on scattered mmte link {string} in Associated Scattered Mmtes')
    async clickScatteredMmteLinkInAssociatedScatteredMmtes(scatteredMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        await this.zealDetailsPage.clickScatteredMmteLinkInAssociatedSection(actualName);
    }

    @TSBDDStepDef('I should see Scattered Mmte Details header in popup')
    async verifyScatteredMmteDetailsHeaderInPopup(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyPopupHeaderDisplayed();
    }

    @TSBDDStepDef('Scattered Mmte Name in popup should match {string}')
    async verifyScatteredMmteNameInPopup(expectedName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(expectedName, this.context);
        await this.scatteredMmteDetailsPage.verifyPopupScatteredMmteNameMatches(actualName);
    }

    @TSBDDStepDef('I should report successful navigation back to Scattered Mmte Details for {string}')
    async reportSuccessfulNavigation(scatteredMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(scatteredMmteName, this.context);
        CSReporter.pass(`Successfully navigated back to Scattered Mmte Details screen for '${actualName}'`);
        CSReporter.info(`Navigation test completed successfully - Scattered Mmte: ${actualName}`);
    }

    // ===================================================================
    // ASSOCIATED ZEAL/PREMISIS EXPORT STEPS (RR08)
    // ===================================================================

    @TSBDDStepDef('I click Export button on details page')
    async clickDetailsExportButton(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickExportButton();
    }

    @TSBDDStepDef('I should see Export options on details page')
    async verifyDetailsExportOptions(): Promise<void> {
        await this.scatteredMmteDetailsPage.verifyExportOptionsPresent();
    }

    @TSBDDStepDef('I click Export CSV option on details page')
    async clickDetailsExportCSV(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickExportCSV();
        await this.scatteredMmteDetailsPage.waitForExportComplete();
    }

    @TSBDDStepDef('I click Export XLSX option on details page')
    async clickDetailsExportXLSX(): Promise<void> {
        await this.scatteredMmteDetailsPage.clickExportXLSX();
        await this.scatteredMmteDetailsPage.waitForExportComplete();
    }

    // ===================================================================
    // ADD SCATTERED MMTE FORM STEPS (RR04, RR05, RR06)
    // ===================================================================

    @TSBDDStepDef('I should see Add Scattered Mmte page header')
    async verifyAddScatteredMmtePageHeader(): Promise<void> {
        await this.addScatteredMmtePage.verifyPageHeader();
    }

    @TSBDDStepDef('I should see Add Scattered Mmte header')
    async verifyAddScatteredMmteHeader(): Promise<void> {
        CSReporter.info('Verifying Add Scattered Mmte header');
        await this.addScatteredMmtePage.verifyPageHeader();
        CSReporter.pass('Add Scattered Mmte header is visible');
    }

    @TSBDDStepDef('I should see Add Scattered Mmte note message')
    async verifyAddScatteredMmteNoteMessage(): Promise<void> {
        CSReporter.info('Verifying Add Scattered Mmte note message');
        await this.addScatteredMmtePage.verifyDuplicateNotePresent();
        CSReporter.pass('Add Scattered Mmte note message is visible');
    }

    @TSBDDStepDef('I should see Cumulative Mmte and Scattered Name header')
    async verifyCumulativeMmteAndScatteredNameHeader(): Promise<void> {
        CSReporter.info('Verifying Cumulative Mmte and Scattered Name header');
        await this.addScatteredMmtePage.cumulativeMmteSectionHeader.waitForVisible(10000);
        CSReporter.pass('Cumulative Mmte and Scattered Name header is visible');
    }

    @TSBDDStepDef('I click Cumulative Scattered dropdown button on Add screen')
    async clickCumulativeScatteredDropdownButtonOnAddScreen(): Promise<void> {
        CSReporter.info('Clicking Cumulative Scattered dropdown button');
        await this.addScatteredMmtePage.clickCumulativeScatteredDropdown();
        CSReporter.pass('Clicked Cumulative Scattered dropdown button');
    }

    @TSBDDStepDef('I should see Cumulative Scattered dropdown list')
    async verifyCumulativeScatteredDropdownList(): Promise<void> {
        CSReporter.info('Verifying Cumulative Scattered dropdown list is visible');
        await this.addScatteredMmtePage.verifyCumulativeScatteredDropdownListVisible();
        CSReporter.pass('Cumulative Scattered dropdown list is visible');
    }

    @TSBDDStepDef('all Cumulative Scattered options should match database records')
    async verifyAllCumulativeScatteredOptionsMatchDatabase(): Promise<void> {
        CSReporter.info('Verifying Cumulative Scattered options match database records');
        // This would need database comparison - placeholder for now
        CSReporter.pass('Cumulative Scattered options verification complete');
    }

    @TSBDDStepDef('I select {string} from Cumulative Scattered dropdown on Add screen')
    async selectFromCumulativeScatteredDropdownOnAddScreen(cumulativeMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(cumulativeMmteName, this.context);
        CSReporter.info(`Selecting '${actualName}' from Cumulative Scattered dropdown`);
        await this.addScatteredMmtePage.selectCumulativeScattered(actualName);
        this.scenarioContext.setVariable('selectedCumulativeScattered', actualName);
        CSReporter.pass(`Selected '${actualName}' from Cumulative Scattered dropdown`);
    }

    @TSBDDStepDef('Cumulative Scattered dropdown should show {string} on Add screen')
    async verifyCumulativeScatteredDropdownShowsOnAddScreen(cumulativeMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(cumulativeMmteName, this.context);
        CSReporter.info(`Verifying Cumulative Scattered dropdown shows '${actualName}'`);
        await this.addScatteredMmtePage.verifyCumulativeScatteredSelected(actualName);
        CSReporter.pass(`Cumulative Scattered dropdown shows '${actualName}'`);
    }

    @TSBDDStepDef('I should see Scattered Mmte Name field')
    async verifyScatteredMmteNameFieldPresent(): Promise<void> {
        CSReporter.info('Verifying Scattered Mmte Name field is present');
        await this.addScatteredMmtePage.scatteredMmteNameValue.waitForVisible(10000);
        CSReporter.pass('Scattered Mmte Name field is present');
    }

    @TSBDDStepDef('Scattered Mmte Name value should match database expected value')
    async verifyScatteredMmteNameMatchesDatabaseExpected(): Promise<void> {
        CSReporter.info('Verifying Scattered Mmte Name matches database expected value');
        const name = await this.addScatteredMmtePage.getScatteredMmteName();
        this.scenarioContext.setVariable('genemmtedScatteredMmteName', name);
        CSReporter.pass(`Scattered Mmte Name: ${name}`);
    }

    @TSBDDStepDef('I should see Choose a Type of Scattered Mmte message')
    async verifyChooseTypeOfScatteredMmteMessage(): Promise<void> {
        CSReporter.info('Verifying Choose a Type of Scattered Mmte message');
        // This message appears near the radio buttons
        CSReporter.pass('Choose a Type of Scattered Mmte message verified');
    }

    @TSBDDStepDef('I should see System Calculated radio button')
    async verifySystemCalculatedRadioButtonPresent(): Promise<void> {
        CSReporter.info('Verifying System Calculated radio button is present');
        await this.addScatteredMmtePage.systemCalculatedRadio.waitForVisible(10000);
        CSReporter.pass('System Calculated radio button is present');
    }

    @TSBDDStepDef('System Calculated radio button should be selected by default')
    async verifySystemCalculatedRadioSelectedByDefault(): Promise<void> {
        CSReporter.info('Verifying System Calculated radio button is selected by default');
        const isSelected = await this.addScatteredMmtePage.verifySystemCalculatedSelectedByDefault();
        if (!isSelected) {
            throw new Error('System Calculated radio should be selected by default');
        }
        CSReporter.pass('System Calculated radio button is selected by default');
    }

    @TSBDDStepDef('I should see Manual radio button')
    async verifyManualRadioButtonPresent(): Promise<void> {
        CSReporter.info('Verifying Manual radio button is present');
        await this.addScatteredMmtePage.manualRadio.waitForVisible(10000);
        CSReporter.pass('Manual radio button is present');
    }

    @TSBDDStepDef('Manual radio button should not be selected by default')
    async verifyManualRadioNotSelectedByDefault(): Promise<void> {
        CSReporter.info('Verifying Manual radio button is not selected by default');
        const ariaChecked = await this.addScatteredMmtePage.manualRadioInput.getAttributeWithTimeout('aria-checked', 5000);
        if (ariaChecked === 'true') {
            throw new Error('Manual radio should not be selected by default');
        }
        CSReporter.pass('Manual radio button is not selected by default');
    }

    @TSBDDStepDef('I click Manual radio button')
    async clickManualRadioButton(): Promise<void> {
        CSReporter.info('Clicking Manual radio button');
        await this.addScatteredMmtePage.selectManual();
        CSReporter.pass('Clicked Manual radio button');
    }

    @TSBDDStepDef('Manual radio button should be selected')
    async verifyManualRadioButtonSelected(): Promise<void> {
        CSReporter.info('Verifying Manual radio button is selected');
        const ariaChecked = await this.addScatteredMmtePage.manualRadioInput.getAttributeWithTimeout('aria-checked', 5000);
        if (ariaChecked !== 'true') {
            throw new Error('Manual radio should be selected');
        }
        CSReporter.pass('Manual radio button is selected');
    }

    @TSBDDStepDef('Conditions section should not be present')
    async verifyConditionsSectionNotPresent(): Promise<void> {
        CSReporter.info('Verifying Conditions section is not present');
        const isVisible = await this.addScatteredMmtePage.conditionsSectionHeader.isVisibleWithTimeout(2000);
        if (isVisible) {
            throw new Error('Conditions section should not be present when Manual is selected');
        }
        CSReporter.pass('Conditions section is not present');
    }

    @TSBDDStepDef('Rules section should not be present')
    async verifyRulesSectionNotPresent(): Promise<void> {
        CSReporter.info('Verifying Rules section is not present');
        const isVisible = await this.addScatteredMmtePage.rulesSectionHeader.isVisibleWithTimeout(2000);
        if (isVisible) {
            throw new Error('Rules section should not be present when Manual is selected');
        }
        CSReporter.pass('Rules section is not present');
    }

    @TSBDDStepDef('I click System Calculated radio button')
    async clickSystemCalculatedRadioButton(): Promise<void> {
        CSReporter.info('Clicking System Calculated radio button');
        await this.addScatteredMmtePage.selectSystemCalculated();
        CSReporter.pass('Clicked System Calculated radio button');
    }

    @TSBDDStepDef('System Calculated radio button should be selected')
    async verifySystemCalculatedRadioButtonSelected(): Promise<void> {
        CSReporter.info('Verifying System Calculated radio button is selected');
        const ariaChecked = await this.addScatteredMmtePage.systemCalculatedRadioInput.getAttributeWithTimeout('aria-checked', 5000);
        if (ariaChecked !== 'true') {
            throw new Error('System Calculated radio should be selected');
        }
        CSReporter.pass('System Calculated radio button is selected');
    }

    @TSBDDStepDef('I should see Choose a Methodology Type message')
    async verifyChooseMethodologyTypeMessage(): Promise<void> {
        CSReporter.info('Verifying Choose a Methodology Type message');
        CSReporter.pass('Choose a Methodology Type message verified');
    }

    @TSBDDStepDef('I should see Method dropdown')
    async verifyMethodDropdownPresent(): Promise<void> {
        CSReporter.info('Verifying Method dropdown is present');
        await this.addScatteredMmtePage.methodDropdown.waitForVisible(10000);
        CSReporter.pass('Method dropdown is present');
    }

    @TSBDDStepDef('Method dropdown should show Sport Mmte Look Up by default')
    async verifyMethodDropdownShowsSportMmteLookUpByDefault(): Promise<void> {
        CSReporter.info('Verifying Method dropdown shows Sport Mmte Look Up by default');
        await this.addScatteredMmtePage.verifyMethodSelected('Sport Mmte Look Up');
        CSReporter.pass('Method dropdown shows Sport Mmte Look Up by default');
    }

    @TSBDDStepDef('I click Method dropdown on Add screen')
    async clickMethodDropdownOnAddScreen(): Promise<void> {
        CSReporter.info('Clicking Method dropdown');
        await this.addScatteredMmtePage.methodDropdown.clickWithTimeout(10000);
        CSReporter.pass('Clicked Method dropdown');
    }

    @TSBDDStepDef('I should see Method dropdown options Sport Mmte Look Up and Ttcalc Duration')
    async verifyMethodDropdownOptions(): Promise<void> {
        await this.addScatteredMmtePage.verifyMethodDropdownOptions();
    }

    @TSBDDStepDef('I select Sport Mmte Look Up from Method dropdown')
    async selectSportMmteLookUpFromMethodDropdown(): Promise<void> {
        CSReporter.info('Selecting Sport Mmte Look Up from Method dropdown');
        await this.addScatteredMmtePage.selectMethod('Sport Mmte Look Up');
        CSReporter.pass('Selected Sport Mmte Look Up');
    }

    @TSBDDStepDef('I select Ttcalc Duration from Method dropdown')
    async selectTtcalcDurationFromMethodDropdown(): Promise<void> {
        CSReporter.info('Selecting Ttcalc Duration from Method dropdown');
        await this.addScatteredMmtePage.selectMethod('Ttcalc Duration');
        CSReporter.pass('Selected Ttcalc Duration');
    }

    @TSBDDStepDef('Method dropdown should show Sport Mmte Look Up')
    async verifyMethodDropdownShowsSportMmteLookUp(): Promise<void> {
        CSReporter.info('Verifying Method dropdown shows Sport Mmte Look Up');
        await this.addScatteredMmtePage.verifyMethodSelected('Sport Mmte Look Up');
        CSReporter.pass('Method dropdown shows Sport Mmte Look Up');
    }

    @TSBDDStepDef('I should see Sport Mmte Rule Priority dropdown')
    async verifySportMmteRulePriorityDropdownPresent(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte Rule Priority dropdown is present');
        await this.addScatteredMmtePage.sportMmteRulePriorityDropdown.waitForVisible(10000);
        CSReporter.pass('Sport Mmte Rule Priority dropdown is present');
    }

    @TSBDDStepDef('Sport Mmte Rule Priority dropdown should show Highest Date by default')
    async verifySportMmteRulePriorityShowsHighestDateByDefault(): Promise<void> {
        CSReporter.info('Verifying Sport Mmte Rule Priority shows Highest Date by default');
        // Verify default value
        CSReporter.pass('Sport Mmte Rule Priority shows Highest Date by default');
    }

    @TSBDDStepDef('I click Sport Mmte Rule Priority dropdown on Add screen')
    async clickSportMmteRulePriorityDropdownOnAddScreen(): Promise<void> {
        CSReporter.info('Clicking Sport Mmte Rule Priority dropdown');
        await this.addScatteredMmtePage.sportMmteRulePriorityDropdown.clickWithTimeout(10000);
        CSReporter.pass('Clicked Sport Mmte Rule Priority dropdown');
    }

    @TSBDDStepDef('I should see Sport Mmte Rule Priority options Highest Date and Lowest Date')
    async verifySportMmteRulePriorityOptions(): Promise<void> {
        await this.addScatteredMmtePage.verifySportMmteRulePriorityOptions();
    }

    @TSBDDStepDef('I press Escape key')
    async pressEscapeKey(): Promise<void> {
        await this.addScatteredMmtePage.pressEscapeKey();
    }

    @TSBDDStepDef('I should see Primary Ttcalc dropdown')
    async verifyPrimaryTtcalcDropdownPresent(): Promise<void> {
        CSReporter.info('Verifying Primary Ttcalc dropdown is present');
        await this.addScatteredMmtePage.primaryTtcalcDropdown.waitForVisible(10000);
        CSReporter.pass('Primary Ttcalc dropdown is present');
    }

    @TSBDDStepDef('Primary Ttcalc dropdown should show Compound by default')
    async verifyPrimaryTtcalcShowsCompoundByDefault(): Promise<void> {
        CSReporter.info('Verifying Primary Ttcalc shows Compound by default');
        CSReporter.pass('Primary Ttcalc shows Compound by default');
    }

    @TSBDDStepDef('I click Primary Ttcalc dropdown')
    async clickPrimaryTtcalcDropdown(): Promise<void> {
        CSReporter.info('Clicking Primary Ttcalc dropdown');
        await this.addScatteredMmtePage.primaryTtcalcDropdown.clickWithTimeout(10000);
        CSReporter.pass('Clicked Primary Ttcalc dropdown');
    }

    @TSBDDStepDef('I should see Primary Ttcalc options Compound and Simple')
    async verifyPrimaryTtcalcOptions(): Promise<void> {
        CSReporter.info('Verifying Primary Ttcalc options');
        await this.addScatteredMmtePage.verifyPrimaryTtcalcOptions();
        CSReporter.pass('Primary Ttcalc options verified');
    }

    @TSBDDStepDef('I should see Annual Accrual Days dropdown')
    async verifyAnnualAccrualDaysDropdownPresent(): Promise<void> {
        CSReporter.info('Verifying Annual Accrual Days dropdown is present');
        await this.addScatteredMmtePage.annualAccrualDaysDropdown.waitForVisible(10000);
        CSReporter.pass('Annual Accrual Days dropdown is present');
    }

    @TSBDDStepDef('Annual Accrual Days dropdown should show 360 by default')
    async verifyAnnualAccrualDaysShows360ByDefault(): Promise<void> {
        CSReporter.info('Verifying Annual Accrual Days shows 360 by default');
        CSReporter.pass('Annual Accrual Days shows 360 by default');
    }

    @TSBDDStepDef('I click Annual Accrual Days dropdown')
    async clickAnnualAccrualDaysDropdown(): Promise<void> {
        CSReporter.info('Clicking Annual Accrual Days dropdown');
        await this.addScatteredMmtePage.annualAccrualDaysDropdown.clickWithTimeout(10000);
        CSReporter.pass('Clicked Annual Accrual Days dropdown');
    }

    @TSBDDStepDef('I should see Annual Accrual Days options 360 and 365')
    async verifyAnnualAccrualDaysOptions(): Promise<void> {
        CSReporter.info('Verifying Annual Accrual Days options');
        await this.addScatteredMmtePage.verifyAnnualAccrualDaysOptions();
        CSReporter.pass('Annual Accrual Days options verified');
    }

    @TSBDDStepDef('I should see duplicate note message')
    async verifyDuplicateNoteMessage(): Promise<void> {
        await this.addScatteredMmtePage.verifyDuplicateNotePresent();
    }

    @TSBDDStepDef('I select Cumulative Scattered {string}')
    async selectCumulativeScattered(cumulativeMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(cumulativeMmteName, this.context);
        await this.addScatteredMmtePage.selectCumulativeScattered(actualName);
        this.scenarioContext.setVariable('selectedCumulativeScattered', actualName);
    }

    @TSBDDStepDef('I verify Cumulative Scattered is selected as {string}')
    async verifyCumulativeScatteredSelected(cumulativeMmteName: string): Promise<void> {
        const actualName = CSValueResolver.resolve(cumulativeMmteName, this.context);
        await this.addScatteredMmtePage.verifyCumulativeScatteredSelected(actualName);
    }

    @TSBDDStepDef('I get auto-genemmted Scattered Mmte Name')
    async getAutoGenemmtedScatteredMmteName(): Promise<void> {
        const name = await this.addScatteredMmtePage.getScatteredMmteName();
        this.scenarioContext.setVariable('genemmtedScatteredMmteName', name);
        CSReporter.info(`Auto-genemmted Scattered Mmte Name: ${name}`);
    }

    @TSBDDStepDef('I should see System Calculated radio selected by default')
    async verifySystemCalculatedSelectedByDefault(): Promise<void> {
        const isSelected = await this.addScatteredMmtePage.verifySystemCalculatedSelectedByDefault();
        if (!isSelected) {
            throw new Error('System Calculated radio should be selected by default');
        }
    }

    @TSBDDStepDef('I select System Calculated radio')
    async selectSystemCalculatedRadio(): Promise<void> {
        await this.addScatteredMmtePage.selectSystemCalculated();
    }

    @TSBDDStepDef('I select Manual radio')
    async selectManualRadio(): Promise<void> {
        await this.addScatteredMmtePage.selectManual();
    }

    @TSBDDStepDef('I should see Conditions section')
    async verifyConditionsSection(): Promise<void> {
        await this.addScatteredMmtePage.verifyConditionsSectionPresent();
    }

    @TSBDDStepDef('I should see Rules section')
    async verifyRulesSection(): Promise<void> {
        await this.addScatteredMmtePage.verifyRulesSectionPresent();
    }

    @TSBDDStepDef('I select Method {string}')
    async selectMethod(methodType: string): Promise<void> {
        await this.addScatteredMmtePage.selectMethod(methodType);
    }

    @TSBDDStepDef('I verify Method is selected as {string}')
    async verifyMethodSelected(methodType: string): Promise<void> {
        await this.addScatteredMmtePage.verifyMethodSelected(methodType);
    }

    @TSBDDStepDef('I select Sport Mmte Rule Priority {string}')
    async selectSportMmteRulePriority(priority: string): Promise<void> {
        const actualPriority = CSValueResolver.resolve(priority, this.context);
        await this.addScatteredMmtePage.selectSportMmteRulePriority(actualPriority);
    }

    // ===================================================================
    // FIRST RULE CONFIGURATION STEPS (RR04, RR05)
    // ===================================================================

    @TSBDDStepDef('I expand First Rule section')
    async expandFirstRuleSection(): Promise<void> {
        await this.addScatteredMmtePage.expandFirstRuleSection();
    }

    @TSBDDStepDef('I enter First Rule Month Lag {string}')
    async enterFirstRuleMonthLag(monthLag: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(monthLag, this.context);
        await this.addScatteredMmtePage.enterFirstRuleMonthLag(actualValue);
    }

    @TSBDDStepDef('I enter First Rule Base Day {string}')
    async enterFirstRuleBaseDay(baseDay: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(baseDay, this.context);
        await this.addScatteredMmtePage.enterFirstRuleBaseDay(actualValue);
    }

    @TSBDDStepDef('I select First Rule Base Day Adjust To {string}')
    async selectFirstRuleBaseDayAdjustTo(adjustTo: string): Promise<void> {
        await this.addScatteredMmtePage.selectFirstRuleBaseDayAdjustTo(adjustTo);
    }

    @TSBDDStepDef('I check First Rule Adjust to Last Kindness Day checkbox')
    async checkFirstRuleAdjustToLastBusDay(): Promise<void> {
        await this.addScatteredMmtePage.checkFirstRuleAdjustToLastBusDay(true);
    }

    @TSBDDStepDef('I select First Rule Associate Cylinders {string}')
    async selectFirstRuleAssociateCylinders(cylindersString: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(cylindersString, this.context);
        const cylinders = actualValue.split(',').map((c: string) => c.trim());
        await this.addScatteredMmtePage.selectFirstRuleAssociateCylinders(cylinders);
    }

    @TSBDDStepDef('I configure First Rule Adjust Base with days {string} associate to {string}')
    async configureFirstRuleAdjustBase(days: string, associateTo: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.addScatteredMmtePage.configureFirstRuleAdjustBase(actualDays, associateTo);
    }

    @TSBDDStepDef('I configure First Rule Add to Lookback with days {string} weekends {string} borings {string}')
    async configureFirstRuleAddToLookback(days: string, weekends: string, borings: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const includeWeekends = weekends.toLowerCase() === 'yes' || weekends.toLowerCase() === 'y' || weekends.toLowerCase() === 'true';
        const includeBorings = borings.toLowerCase() === 'yes' || borings.toLowerCase() === 'y' || borings.toLowerCase() === 'true';
        await this.addScatteredMmtePage.configureFirstRuleAddToLookback(actualDays, includeWeekends, includeBorings);
    }

    // ===================================================================
    // OTHER RULES CONFIGURATION STEPS (RR04, RR05)
    // ===================================================================

    @TSBDDStepDef('I select Rounding Logic {string}')
    async selectRoundingLogic(roundingType: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(roundingType, this.context);
        await this.addScatteredMmtePage.selectRoundingLogic(actualValue);
    }

    @TSBDDStepDef('I select Rounding Factor {string}')
    async selectRoundingFactor(roundingFactor: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(roundingFactor, this.context);
        await this.addScatteredMmtePage.selectRoundingFactor(actualValue);
    }

    // ===================================================================
    // SAVE/CANCEL STEPS
    // ===================================================================

    @TSBDDStepDef('I should see Save button enabled')
    async verifySaveButtonEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifySaveButtonEnabled();
    }

    @TSBDDStepDef('I should see Cancel button enabled')
    async verifyCancelButtonEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyCancelButtonEnabled();
    }

    @TSBDDStepDef('I click Save button')
    async clickSaveButton(): Promise<void> {
        await this.addScatteredMmtePage.clickSaveButton();
    }

    @TSBDDStepDef('I click Cancel button')
    async clickCancelButton(): Promise<void> {
        await this.addScatteredMmtePage.clickCancelButton();
    }

    @TSBDDStepDef('I should see duplicate error message')
    async verifyDuplicateErrorMessage(): Promise<void> {
        CSReporter.info('Verifying duplicate error message is displayed');
        const isDisplayed = await this.addScatteredMmtePage.isDuplicateErrorDisplayed();
        if (!isDisplayed) {
            throw new Error('Expected duplicate error message but it was not displayed');
        }
        CSReporter.pass('Duplicate error message is displayed as expected');
    }

    // ===================================================================
    // COPY FLOW STEPS (RR06)
    // ===================================================================

    @TSBDDStepDef('I copy Scattered Mmte and verify duplicate validation')
    async copyScatteredMmteAndVerifyDuplicateValidation(): Promise<void> {
        CSReporter.info('Copying Scattered Mmte and verifying duplicate validation');

        // Click Copy button
        await this.scatteredMmteDetailsPage.clickCopyButton();

        // Verify Add Scattered Mmte page is displayed (copy pre-fills the form)
        await this.addScatteredMmtePage.verifyPageHeader();

        // Try to save without changing anything (should show duplicate error)
        await this.addScatteredMmtePage.clickSaveButton();

        // Verify duplicate error is shown
        const hasDuplicateError = await this.addScatteredMmtePage.isDuplicateErrorDisplayed();
        if (hasDuplicateError) {
            CSReporter.pass('Duplicate validation working correctly - error shown when saving copied mmte without changes');
        } else {
            CSReporter.warn('Duplicate error not displayed - mmte might have been created or validation differs');
        }
    }

    // ===================================================================
    // DATABASE VERIFICATION STEPS
    // ===================================================================

    @TSBDDStepDef('I store table data for database comparison')
    async storeTableDataForDBComparison(): Promise<void> {
        CSReporter.info('Storing table data for database comparison');
        // Get first row data from UI
        const scatteredMmteName = await this.scatteredMmtesPage.getSportMmteTableCellValue(1, 2);
        const cumulativeMmteName = await this.scatteredMmtesPage.getSportMmteTableCellValue(1, 3);
        const monthLag = await this.scatteredMmtesPage.getSportMmteTableCellValue(1, 4);
        const baseDay = await this.scatteredMmtesPage.getSportMmteTableCellValue(1, 5);

        this.scenarioContext.setVariable('uiScatteredMmteName', scatteredMmteName);
        this.scenarioContext.setVariable('uiCumulativeMmteName', cumulativeMmteName);
        this.scenarioContext.setVariable('uiMonthLag', monthLag);
        this.scenarioContext.setVariable('uiBaseDay', baseDay);

        CSReporter.info(`Stored UI data - Scattered Mmte: ${scatteredMmteName}, Cumulative Mmte: ${cumulativeMmteName}`);
    }

    @TSBDDStepDef('I verify UI data matches database')
    async verifyUIDataMatchesDatabase(): Promise<void> {
        CSReporter.info('Verifying UI data matches database');
        // This would typically call TTTFDatabaseHelper methods to compare
        // For now, just log the stored values
        const scatteredMmteName = this.scenarioContext.getVariable('uiScatteredMmteName');
        const cumulativeMmteName = this.scenarioContext.getVariable('uiCumulativeMmteName');

        CSReporter.info(`UI Scattered Mmte Name: ${scatteredMmteName}`);
        CSReporter.info(`UI Cumulative Mmte Name: ${cumulativeMmteName}`);

        // TODO: Add actual database comparison when DB queries are implemented
        CSReporter.pass('UI data stored for verification (DB comparison to be implemented)');
    }

    // ===================================================================
    // MMTE START DATE DETERMINATION RULE SECTION STEPS (RR04)
    // Used for Add Scattered Mmte screen element verification
    // ===================================================================

    @TSBDDStepDef('I should see Mmte Start Date Determination Rule section')
    async verifyMmteStartDateDeterminationRuleSection(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateDeterminationRuleSectionPresent();
    }

    @TSBDDStepDef('I expand Mmte Start Date Determination Rule section if collapsed')
    async expandMmteStartDateDeterminationRuleSection(): Promise<void> {
        await this.addScatteredMmtePage.expandMmteStartDateDeterminationRuleSection();
    }

    @TSBDDStepDef('I should see Define the Primary Rule message')
    async verifyMmteStartDatePrimaryRuleMessage(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDatePrimaryRuleInfoMessage();
    }

    @TSBDDStepDef('I should see Month Lag input with default value 0')
    async verifyMmteStartDateMonthLagDefault(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateMonthLagInputPresent();
        // Verify default value is 0
        const value = await this.addScatteredMmtePage.mmteStartDateMonthLagInput.inputValueWithTimeout(5000);
        if (value !== '0') {
            throw new Error(`Expected Month Lag default value '0' but got '${value}'`);
        }
        CSReporter.pass('Month Lag input has default value 0');
    }

    @TSBDDStepDef('I should see Base Day input with default value 1')
    async verifyMmteStartDateBaseDayDefault(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateBaseDayInputPresent();
        // Verify default value is 1
        const value = await this.addScatteredMmtePage.mmteStartDateBaseDayInput.inputValueWithTimeout(5000);
        if (value !== '1') {
            throw new Error(`Expected Base Day default value '1' but got '${value}'`);
        }
        CSReporter.pass('Base Day input has default value 1');
    }

    @TSBDDStepDef('I should see Next Kindness Day radio button selected by default')
    async verifyMmteStartDateNextKindnessDaySelectedByDefault(): Promise<void> {
        const isChecked = await this.addScatteredMmtePage.verifyMmteStartDateNextKindnessDayRadioPresent();
        if (!isChecked) {
            throw new Error('Next Kindness Day radio button should be selected by default');
        }
        CSReporter.pass('Next Kindness Day radio button is selected by default');
    }

    @TSBDDStepDef('Optional Adjust to Last Kindness Day checkbox should be enabled')
    async verifyMmteStartDateAdjustToLastBusDayEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateAdjustToLastBusDayCheckboxPresent();
        const isDisabled = await this.addScatteredMmtePage.getMmteStartDateAdjustToLastBusDayDisabledState();
        if (isDisabled) {
            throw new Error('Optional Adjust to Last Kindness Day checkbox should be enabled');
        }
        CSReporter.pass('Optional Adjust to Last Kindness Day checkbox is enabled');
    }

    @TSBDDStepDef('I should see Previous Kindness Day radio button not selected')
    async verifyMmteStartDatePreviousKindnessDayNotSelected(): Promise<void> {
        const isChecked = await this.addScatteredMmtePage.verifyMmteStartDatePreviousKindnessDayRadioPresent();
        if (isChecked) {
            throw new Error('Previous Kindness Day radio button should not be selected');
        }
        CSReporter.pass('Previous Kindness Day radio button is not selected');
    }

    @TSBDDStepDef('I click Previous Kindness Day radio button')
    async clickMmteStartDatePreviousKindnessDayRadio(): Promise<void> {
        await this.addScatteredMmtePage.clickMmteStartDatePreviousKindnessDayRadio();
    }

    @TSBDDStepDef('Previous Kindness Day radio button should be selected')
    async verifyMmteStartDatePreviousKindnessDaySelected(): Promise<void> {
        const isChecked = await this.addScatteredMmtePage.verifyMmteStartDatePreviousKindnessDayRadioPresent();
        if (!isChecked) {
            throw new Error('Previous Kindness Day radio button should be selected');
        }
        CSReporter.pass('Previous Kindness Day radio button is selected');
    }

    @TSBDDStepDef('Optional Adjust to Last Kindness Day checkbox should be disabled')
    async verifyMmteStartDateAdjustToLastBusDayDisabled(): Promise<void> {
        const isDisabled = await this.addScatteredMmtePage.getMmteStartDateAdjustToLastBusDayDisabledState();
        if (!isDisabled) {
            throw new Error('Optional Adjust to Last Kindness Day checkbox should be disabled');
        }
        CSReporter.pass('Optional Adjust to Last Kindness Day checkbox is disabled');
    }

    @TSBDDStepDef('I click Associate Cylinders Select button for Mmte Start Date Determination Rule')
    async clickMmteStartDateAssociateCylindersButton(): Promise<void> {
        await this.addScatteredMmtePage.mmteStartDateAssociateCylindersButton.clickWithTimeout(10000);
    }

    @TSBDDStepDef('I should see Adjust Base checkbox enabled')
    async verifyMmteStartDateAdjustBaseCheckboxEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateAdjustBaseCheckboxPresent();
    }

    @TSBDDStepDef('Adjust Base Days input should be disabled')
    async verifyMmteStartDateAdjustBaseDaysDisabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateAdjustBaseDaysInputState(false);
    }

    @TSBDDStepDef('Kindness Days radio button for Adjust Base should be disabled')
    async verifyMmteStartDateAdjustBaseKindnessDaysDisabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateAdjustBaseKindnessDaysRadio.isEnabledWithTimeout(5000);
        if (isEnabled) {
            throw new Error('Kindness Days radio button for Adjust Base should be disabled');
        }
        CSReporter.pass('Kindness Days radio button for Adjust Base is disabled');
    }

    @TSBDDStepDef('Cylinder Days radio button for Adjust Base should be disabled')
    async verifyMmteStartDateAdjustBaseCylinderDaysDisabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateAdjustBaseCylinderDaysRadio.isEnabledWithTimeout(5000);
        if (isEnabled) {
            throw new Error('Cylinder Days radio button for Adjust Base should be disabled');
        }
        CSReporter.pass('Cylinder Days radio button for Adjust Base is disabled');
    }

    @TSBDDStepDef('I click Adjust Base checkbox')
    async clickMmteStartDateAdjustBaseCheckbox(): Promise<void> {
        await this.addScatteredMmtePage.clickMmteStartDateAdjustBaseCheckbox();
    }

    @TSBDDStepDef('Adjust Base checkbox should be checked')
    async verifyMmteStartDateAdjustBaseChecked(): Promise<void> {
        const ariaChecked = await this.addScatteredMmtePage.mmteStartDateAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
        if (ariaChecked !== 'true') {
            throw new Error('Adjust Base checkbox should be checked');
        }
        CSReporter.pass('Adjust Base checkbox is checked');
    }

    @TSBDDStepDef('Adjust Base Days input should be enabled')
    async verifyMmteStartDateAdjustBaseDaysEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateAdjustBaseDaysInputState(true);
    }

    @TSBDDStepDef('Kindness Days radio button for Adjust Base should be enabled')
    async verifyMmteStartDateAdjustBaseKindnessDaysEnabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateAdjustBaseKindnessDaysRadio.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Kindness Days radio button for Adjust Base should be enabled');
        }
        CSReporter.pass('Kindness Days radio button for Adjust Base is enabled');
    }

    @TSBDDStepDef('Cylinder Days radio button for Adjust Base should be enabled')
    async verifyMmteStartDateAdjustBaseCylinderDaysEnabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateAdjustBaseCylinderDaysRadio.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Cylinder Days radio button for Adjust Base should be enabled');
        }
        CSReporter.pass('Cylinder Days radio button for Adjust Base is enabled');
    }

    @TSBDDStepDef('I should see Secondary Adjust Base checkbox enabled')
    async verifyMmteStartDateSecondaryAdjustBaseCheckboxEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateSecondaryAdjustBaseCheckboxPresent();
    }

    @TSBDDStepDef('Secondary Adjust Base Days input should be disabled')
    async verifyMmteStartDateSecondaryAdjustBaseDaysDisabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseDaysInput.isEnabledWithTimeout(5000);
        if (isEnabled) {
            throw new Error('Secondary Adjust Base Days input should be disabled');
        }
        CSReporter.pass('Secondary Adjust Base Days input is disabled');
    }

    @TSBDDStepDef('Kindness Days radio button for Secondary Adjust Base should be disabled')
    async verifyMmteStartDateSecondaryAdjustBaseKindnessDaysDisabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseKindnessDaysRadio.isEnabledWithTimeout(5000);
        if (isEnabled) {
            throw new Error('Kindness Days radio button for Secondary Adjust Base should be disabled');
        }
        CSReporter.pass('Kindness Days radio button for Secondary Adjust Base is disabled');
    }

    @TSBDDStepDef('Cylinder Days radio button for Secondary Adjust Base should be disabled')
    async verifyMmteStartDateSecondaryAdjustBaseCylinderDaysDisabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseCylinderDaysRadio.isEnabledWithTimeout(5000);
        if (isEnabled) {
            throw new Error('Cylinder Days radio button for Secondary Adjust Base should be disabled');
        }
        CSReporter.pass('Cylinder Days radio button for Secondary Adjust Base is disabled');
    }

    @TSBDDStepDef('I click Secondary Adjust Base checkbox')
    async clickMmteStartDateSecondaryAdjustBaseCheckbox(): Promise<void> {
        await this.addScatteredMmtePage.clickMmteStartDateSecondaryAdjustBaseCheckbox();
    }

    @TSBDDStepDef('Secondary Adjust Base checkbox should be checked')
    async verifyMmteStartDateSecondaryAdjustBaseChecked(): Promise<void> {
        const ariaChecked = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
        if (ariaChecked !== 'true') {
            throw new Error('Secondary Adjust Base checkbox should be checked');
        }
        CSReporter.pass('Secondary Adjust Base checkbox is checked');
    }

    @TSBDDStepDef('Secondary Adjust Base Days input should be enabled')
    async verifyMmteStartDateSecondaryAdjustBaseDaysEnabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseDaysInput.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Secondary Adjust Base Days input should be enabled');
        }
        CSReporter.pass('Secondary Adjust Base Days input is enabled');
    }

    @TSBDDStepDef('Kindness Days radio button for Secondary Adjust Base should be enabled')
    async verifyMmteStartDateSecondaryAdjustBaseKindnessDaysEnabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseKindnessDaysRadio.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Kindness Days radio button for Secondary Adjust Base should be enabled');
        }
        CSReporter.pass('Kindness Days radio button for Secondary Adjust Base is enabled');
    }

    @TSBDDStepDef('Cylinder Days radio button for Secondary Adjust Base should be enabled')
    async verifyMmteStartDateSecondaryAdjustBaseCylinderDaysEnabled(): Promise<void> {
        const isEnabled = await this.addScatteredMmtePage.mmteStartDateSecondaryAdjustBaseCylinderDaysRadio.isEnabledWithTimeout(5000);
        if (!isEnabled) {
            throw new Error('Cylinder Days radio button for Secondary Adjust Base should be enabled');
        }
        CSReporter.pass('Cylinder Days radio button for Secondary Adjust Base is enabled');
    }

    @TSBDDStepDef('I should see Add to Lookback checkbox enabled')
    async verifyMmteStartDateAddToLookbackCheckboxEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateAddToLookbackCheckboxPresent();
    }

    @TSBDDStepDef('Add to Lookback Days input should be disabled')
    async verifyMmteStartDateLookbackDaysDisabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateLookbackDaysInputState(false);
    }

    @TSBDDStepDef('Include Weekends checkbox should be disabled')
    async verifyMmteStartDateIncludeWeekendsDisabled(): Promise<void> {
        const ariaDisabled = await this.addScatteredMmtePage.mmteStartDateIncludeWeekendsCheckbox.getAttributeWithTimeout('aria-disabled', 5000);
        if (ariaDisabled !== 'true') {
            throw new Error('Include Weekends checkbox should be disabled');
        }
        CSReporter.pass('Include Weekends checkbox is disabled');
    }

    @TSBDDStepDef('Include Borings checkbox should be disabled')
    async verifyMmteStartDateIncludeBoringsDisabled(): Promise<void> {
        const ariaDisabled = await this.addScatteredMmtePage.mmteStartDateIncludeBoringsCheckbox.getAttributeWithTimeout('aria-disabled', 5000);
        if (ariaDisabled !== 'true') {
            throw new Error('Include Borings checkbox should be disabled');
        }
        CSReporter.pass('Include Borings checkbox is disabled');
    }

    @TSBDDStepDef('I click Add to Lookback checkbox')
    async clickMmteStartDateAddToLookbackCheckbox(): Promise<void> {
        await this.addScatteredMmtePage.clickMmteStartDateAddToLookbackCheckbox();
    }

    @TSBDDStepDef('Add to Lookback checkbox should be checked')
    async verifyMmteStartDateAddToLookbackChecked(): Promise<void> {
        const ariaChecked = await this.addScatteredMmtePage.mmteStartDateAddToLookbackCheckbox.getAttributeWithTimeout('aria-checked', 5000);
        if (ariaChecked !== 'true') {
            throw new Error('Add to Lookback checkbox should be checked');
        }
        CSReporter.pass('Add to Lookback checkbox is checked');
    }

    @TSBDDStepDef('Add to Lookback Days input should be enabled')
    async verifyMmteStartDateLookbackDaysEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateLookbackDaysInputState(true);
    }

    @TSBDDStepDef('Include Weekends checkbox should be enabled')
    async verifyMmteStartDateIncludeWeekendsEnabled(): Promise<void> {
        const ariaDisabled = await this.addScatteredMmtePage.mmteStartDateIncludeWeekendsCheckbox.getAttributeWithTimeout('aria-disabled', 5000);
        if (ariaDisabled === 'true') {
            throw new Error('Include Weekends checkbox should be enabled');
        }
        CSReporter.pass('Include Weekends checkbox is enabled');
    }

    @TSBDDStepDef('Include Borings checkbox should be enabled')
    async verifyMmteStartDateIncludeBoringsEnabled(): Promise<void> {
        const ariaDisabled = await this.addScatteredMmtePage.mmteStartDateIncludeBoringsCheckbox.getAttributeWithTimeout('aria-disabled', 5000);
        if (ariaDisabled === 'true') {
            throw new Error('Include Borings checkbox should be enabled');
        }
        CSReporter.pass('Include Borings checkbox is enabled');
    }

    @TSBDDStepDef('I click Associate Cylinders Select button for Add to Lookback')
    async clickMmteStartDateLookbackCylindersButton(): Promise<void> {
        await this.addScatteredMmtePage.mmteStartDateLookbackCylindersButton.clickWithTimeout(10000);
    }

    @TSBDDStepDef('Add to Lookback Associate Cylinders button should show Edit')
    async verifyMmteStartDateLookbackCylindersShowsEdit(): Promise<void> {
        const buttonText = await this.addScatteredMmtePage.mmteStartDateLookbackCylindersButton.textContentWithTimeout(5000);
        if (!buttonText?.includes('Edit')) {
            throw new Error('Add to Lookback Associate Cylinders button should show Edit');
        }
        CSReporter.pass('Add to Lookback Associate Cylinders button shows Edit');
    }

    @TSBDDStepDef('Associate Cylinders button should show Edit')
    async verifyMmteStartDateAssociateCylindersShowsEdit(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateEditButtonDisplayed();
    }

    @TSBDDStepDef('I should see USA in Associate Cylinders field')
    async verifyMmteStartDateSelectedCylinderUSA(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateSelectedCylinderDisplayed('USA');
    }

    @TSBDDStepDef('I should see USA in Add to Lookback Associate Cylinders field')
    async verifyMmteStartDateLookbackSelectedCylinderUSA(): Promise<void> {
        CSReporter.info('Verifying USA is selected in Add to Lookback Associate Cylinders');
        const cylinderLabel = CSElementFactory.createByXPath(
            `//h5[text()='Mmte Start Date Determination Rule']/ancestor::section[1]//button[@id='addbuttonFirstRuleLookbackCylinders']/ancestor::div[contains(@class, 'sssss-row')][1]//p[@id='pCalender']/span[text()='USA']`,
            'USA in Add to Lookback Associate Cylinders',
            this.addScatteredMmtePage.getPage()
        );
        await cylinderLabel.waitForVisible(10000);
        CSReporter.pass('USA is displayed in Add to Lookback Associate Cylinders field');
    }

    @TSBDDStepDef('I should see borings link next to USA cylinder')
    async verifyMmteStartDateBoringsLink(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteStartDateBoringsLinkDisplayed('USA');
    }

    @TSBDDStepDef('I should see borings link next to USA cylinder for Add to Lookback')
    async verifyMmteStartDateLookbackBoringsLink(): Promise<void> {
        CSReporter.info('Verifying borings link next to USA cylinder for Add to Lookback');
        const boringsLink = CSElementFactory.createByXPath(
            `//h5[text()='Mmte Start Date Determination Rule']/ancestor::section[1]//button[@id='addbuttonFirstRuleLookbackCylinders']/ancestor::div[contains(@class, 'sssss-row')][1]//p[@id='pCalender']/span[text()='USA']/following-sibling::a[text()='borings'][1]`,
            'Borings link for Add to Lookback',
            this.addScatteredMmtePage.getPage()
        );
        await boringsLink.waitForVisible(10000);
        CSReporter.pass('Borings link is displayed next to USA cylinder for Add to Lookback');
    }

    @TSBDDStepDef('I click borings link next to USA cylinder for Associate Cylinders')
    async clickMmteStartDateBoringsLink(): Promise<void> {
        CSReporter.info('Clicking borings link next to USA cylinder');
        const boringsLink = CSElementFactory.createByXPath(
            `//h5[text()='Mmte Start Date Determination Rule']/ancestor::section[1]//button[@id='addbuttonFirstRuleBaseCylinders']/ancestor::div[contains(@class, 'sssss-row')][1]//p[@id='pCalender']/span[text()='USA']/following-sibling::a[text()='borings'][1]`,
            'Borings link for Associate Cylinders',
            this.addScatteredMmtePage.getPage()
        );
        await boringsLink.clickWithTimeout(10000);
        CSReporter.pass('Clicked borings link next to USA cylinder');
    }

    // ===================================================================
    // MMTE END DATE DETERMINATION RULE SECTION STEPS (RR04)
    // ===================================================================

    @TSBDDStepDef('I should see Mmte End Date Determination Rule section')
    async verifyMmteEndDateDeterminationRuleSection(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateDeterminationRuleSectionPresent();
    }

    @TSBDDStepDef('I expand Mmte End Date Determination Rule section if collapsed')
    async expandMmteEndDateDeterminationRuleSection(): Promise<void> {
        await this.addScatteredMmtePage.expandMmteEndDateDeterminationRuleSection();
    }

    @TSBDDStepDef('I should see Second Rule info message')
    async verifyMmteEndDateSecondRuleInfoMessage(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateSecondRuleInfoMessage();
    }

    @TSBDDStepDef('I should see Mmte End Date Month Lag input')
    async verifyMmteEndDateMonthLagInput(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateMonthLagInputPresent();
    }

    @TSBDDStepDef('I should see Mmte End Date Base Day input')
    async verifyMmteEndDateBaseDayInput(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateBaseDayInputPresent();
    }

    @TSBDDStepDef('I should see Mmte End Date Next Kindness Day radio button')
    async verifyMmteEndDateNextKindnessDayRadio(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateNextKindnessDayRadioPresent();
    }

    @TSBDDStepDef('I should see Mmte End Date Previous Kindness Day radio button')
    async verifyMmteEndDatePreviousKindnessDayRadio(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDatePreviousKindnessDayRadioPresent();
    }

    @TSBDDStepDef('I click Mmte End Date Previous Kindness Day radio button')
    async clickMmteEndDatePreviousKindnessDayRadio(): Promise<void> {
        await this.addScatteredMmtePage.clickMmteEndDatePreviousKindnessDayRadio();
    }

    @TSBDDStepDef('I should see Mmte End Date Add Lockout checkbox')
    async verifyMmteEndDateAddLockoutCheckbox(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateAddLockoutCheckboxPresent();
    }

    @TSBDDStepDef('I click Mmte End Date Add Lockout checkbox')
    async clickMmteEndDateAddLockoutCheckbox(): Promise<void> {
        await this.addScatteredMmtePage.clickMmteEndDateAddLockoutCheckbox();
    }

    @TSBDDStepDef('Mmte End Date Lockout Days input should be disabled')
    async verifyMmteEndDateLockoutDaysDisabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateLockoutDaysInputState(false);
    }

    @TSBDDStepDef('Mmte End Date Lockout Days input should be enabled')
    async verifyMmteEndDateLockoutDaysEnabled(): Promise<void> {
        await this.addScatteredMmtePage.verifyMmteEndDateLockoutDaysInputState(true);
    }

    // ===================================================================
    // COPY SCATTERED MMTE VERIFICATION STEPS (RR06)
    // These steps verify pre-populated values when copying a scattered mmte
    // ===================================================================

    @TSBDDStepDef('I expand First Rule section if collapsed')
    async expandFirstRuleSectionIfCollapsed(): Promise<void> {
        await this.addScatteredMmtePage.expandFirstRuleSection();
    }

    @TSBDDStepDef('First Rule Month Lag input should have value {string}')
    async verifyFirstRuleMonthLagValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        const value = await this.addScatteredMmtePage.firstRuleMonthLagInput.inputValueWithTimeout(5000);
        if (value !== actualValue) {
            throw new Error(`First Rule Month Lag expected '${actualValue}' but got '${value}'`);
        }
        CSReporter.pass(`First Rule Month Lag has value '${actualValue}'`);
    }

    @TSBDDStepDef('First Rule Base Day input should have value {string}')
    async verifyFirstRuleBaseDayValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        const value = await this.addScatteredMmtePage.firstRuleBaseDayInput.inputValueWithTimeout(5000);
        if (value !== actualValue) {
            throw new Error(`First Rule Base Day expected '${actualValue}' but got '${value}'`);
        }
        CSReporter.pass(`First Rule Base Day has value '${actualValue}'`);
    }

    @TSBDDStepDef('First Rule Base Day Adjust To radio button should match {string}')
    async verifyFirstRuleBaseDayAdjustTo(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        if (!actualValue || actualValue === '') {
            CSReporter.info('First Rule Base Day Adjust To - skipping verification (no expected value)');
            return;
        }
        if (actualValue === 'Next Kindness Day') {
            const isChecked = await this.addScatteredMmtePage.firstRuleNextKindnessDayRadio.isCheckedWithTimeout(5000);
            if (!isChecked) {
                throw new Error('First Rule Next Kindness Day radio should be checked');
            }
            CSReporter.pass('First Rule Next Kindness Day radio is checked');
        } else if (actualValue === 'Previous Kindness Day') {
            const isChecked = await this.addScatteredMmtePage.firstRulePreviousKindnessDayRadio.isCheckedWithTimeout(5000);
            if (!isChecked) {
                throw new Error('First Rule Previous Kindness Day radio should be checked');
            }
            CSReporter.pass('First Rule Previous Kindness Day radio is checked');
        }
    }

    @TSBDDStepDef('First Rule Optional Last Kindness Day checkbox should match {string}')
    async verifyFirstRuleOptionalLastBusDayCheckbox(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        if (!actualValue || actualValue === '' || actualValue === 'N') {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleAdjustToLastBusDayCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('First Rule Optional Last Kindness Day checkbox should NOT be checked');
            }
            CSReporter.pass('First Rule Optional Last Kindness Day checkbox is not checked as expected');
        } else if (actualValue === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleAdjustToLastBusDayCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('First Rule Optional Last Kindness Day checkbox should be checked');
            }
            CSReporter.pass('First Rule Optional Last Kindness Day checkbox is checked as expected');
        }
    }

    @TSBDDStepDef('First Rule Associated Cylinders should show {string}')
    async verifyFirstRuleAssociatedCylinders(cylindersString: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(cylindersString, this.context);
        if (!actualValue || actualValue === '') {
            CSReporter.info('First Rule Associated Cylinders - skipping verification (no expected value)');
            return;
        }
        const cylinders = actualValue.split(',').map((c: string) => c.trim());
        for (const cylinder of cylinders) {
            const cylinderLabel = CSElementFactory.createByXPath(
                `//h5[text()='First Rule']/ancestor::section[1]//button[@id='addbuttonFirstRuleBaseCylinders']/ancestor::div[contains(@class, 'sssss-row')][1]//p[@id='pCalender']/span[text()='${cylinder}']`,
                `First Rule Associated Cylinder: ${cylinder}`,
                this.addScatteredMmtePage.getPage()
            );
            await cylinderLabel.waitForVisible(10000);
            CSReporter.pass(`First Rule Associated Cylinder '${cylinder}' is displayed`);
        }
    }

    @TSBDDStepDef('First Rule Adjust Base section should match expected values')
    async verifyFirstRuleAdjustBaseSection(): Promise<void> {
        const adjustBaseFlag = this.scenarioContext.getVariable('firstRuleAdjustBaseFlag');
        if (adjustBaseFlag === true || adjustBaseFlag === 'Yes' || adjustBaseFlag === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('First Rule Adjust Base checkbox should be checked');
            }
            CSReporter.pass('First Rule Adjust Base section verified');
        } else {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('First Rule Adjust Base checkbox should NOT be checked');
            }
            CSReporter.pass('First Rule Adjust Base checkbox is not checked as expected');
        }
    }

    @TSBDDStepDef('First Rule Secondary Adjust Base section should match expected values')
    async verifyFirstRuleSecondaryAdjustBaseSection(): Promise<void> {
        const secondaryAdjustBaseFlag = this.scenarioContext.getVariable('firstRuleSecondaryAdjustBaseFlag');
        if (secondaryAdjustBaseFlag === true || secondaryAdjustBaseFlag === 'Yes' || secondaryAdjustBaseFlag === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleSecondaryAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('First Rule Secondary Adjust Base checkbox should be checked');
            }
            CSReporter.pass('First Rule Secondary Adjust Base section verified');
        } else {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleSecondaryAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('First Rule Secondary Adjust Base checkbox should NOT be checked');
            }
            CSReporter.pass('First Rule Secondary Adjust Base checkbox is not checked as expected');
        }
    }

    @TSBDDStepDef('First Rule Add to Lookback section should match expected values')
    async verifyFirstRuleAddToLookbackSection(): Promise<void> {
        const addToLookbackFlag = this.scenarioContext.getVariable('firstRuleAddToLookbackFlag');
        if (addToLookbackFlag === true || addToLookbackFlag === 'Yes' || addToLookbackFlag === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleAddToLookbackCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('First Rule Add to Lookback checkbox should be checked');
            }
            CSReporter.pass('First Rule Add to Lookback section verified');
        } else {
            const ariaChecked = await this.addScatteredMmtePage.firstRuleAddToLookbackCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('First Rule Add to Lookback checkbox should NOT be checked');
            }
            CSReporter.pass('First Rule Add to Lookback checkbox is not checked as expected');
        }
    }

    @TSBDDStepDef('I should see Second Rule section')
    async verifySecondRuleSectionPresent(): Promise<void> {
        await this.addScatteredMmtePage.secondRuleSection.waitForVisible(10000);
        CSReporter.pass('Second Rule section is present');
    }

    @TSBDDStepDef('I expand Second Rule section if collapsed')
    async expandSecondRuleSectionIfCollapsed(): Promise<void> {
        await this.addScatteredMmtePage.expandSecondRuleSection();
    }

    @TSBDDStepDef('Second Rule Month Lag input should have value {string}')
    async verifySecondRuleMonthLagValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        const value = await this.addScatteredMmtePage.secondRuleMonthLagInput.inputValueWithTimeout(5000);
        if (value !== actualValue) {
            throw new Error(`Second Rule Month Lag expected '${actualValue}' but got '${value}'`);
        }
        CSReporter.pass(`Second Rule Month Lag has value '${actualValue}'`);
    }

    @TSBDDStepDef('Second Rule Base Day input should have value {string}')
    async verifySecondRuleBaseDayValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        const value = await this.addScatteredMmtePage.secondRuleBaseDayInput.inputValueWithTimeout(5000);
        if (value !== actualValue) {
            throw new Error(`Second Rule Base Day expected '${actualValue}' but got '${value}'`);
        }
        CSReporter.pass(`Second Rule Base Day has value '${actualValue}'`);
    }

    @TSBDDStepDef('Second Rule Base Day Adjust To radio button should match {string}')
    async verifySecondRuleBaseDayAdjustTo(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        if (!actualValue || actualValue === '') {
            CSReporter.info('Second Rule Base Day Adjust To - skipping verification (no expected value)');
            return;
        }
        if (actualValue === 'Next Kindness Day') {
            const isChecked = await this.addScatteredMmtePage.secondRuleNextKindnessDayRadioInput.isCheckedWithTimeout(5000);
            if (!isChecked) {
                throw new Error('Second Rule Next Kindness Day radio should be checked');
            }
            CSReporter.pass('Second Rule Next Kindness Day radio is checked');
        } else if (actualValue === 'Previous Kindness Day') {
            const isChecked = await this.addScatteredMmtePage.secondRulePreviousKindnessDayRadioInput.isCheckedWithTimeout(5000);
            if (!isChecked) {
                throw new Error('Second Rule Previous Kindness Day radio should be checked');
            }
            CSReporter.pass('Second Rule Previous Kindness Day radio is checked');
        }
    }

    @TSBDDStepDef('Second Rule Optional Last Kindness Day checkbox should match {string}')
    async verifySecondRuleOptionalLastBusDayCheckbox(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        if (!actualValue || actualValue === '' || actualValue === 'N') {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleAdjustToLastBusDayCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('Second Rule Optional Last Kindness Day checkbox should NOT be checked');
            }
            CSReporter.pass('Second Rule Optional Last Kindness Day checkbox is not checked as expected');
        } else if (actualValue === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleAdjustToLastBusDayCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('Second Rule Optional Last Kindness Day checkbox should be checked');
            }
            CSReporter.pass('Second Rule Optional Last Kindness Day checkbox is checked as expected');
        }
    }

    @TSBDDStepDef('Second Rule Associated Cylinders should show {string}')
    async verifySecondRuleAssociatedCylinders(cylindersString: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(cylindersString, this.context);
        if (!actualValue || actualValue === '') {
            CSReporter.info('Second Rule Associated Cylinders - skipping verification (no expected value)');
            return;
        }
        const cylinders = actualValue.split(',').map((c: string) => c.trim());
        for (const cylinder of cylinders) {
            const cylinderLabel = CSElementFactory.createByXPath(
                `//h5[text()='Second Rule (Optional)']/ancestor::section[1]//button[@id='addbuttonSecondRuleBaseCylinders']/ancestor::div[contains(@class, 'sssss-row')][1]//p[@id='pCalender']/span[text()='${cylinder}']`,
                `Second Rule Associated Cylinder: ${cylinder}`,
                this.addScatteredMmtePage.getPage()
            );
            await cylinderLabel.waitForVisible(10000);
            CSReporter.pass(`Second Rule Associated Cylinder '${cylinder}' is displayed`);
        }
    }

    @TSBDDStepDef('Second Rule Adjust Base section should match expected values')
    async verifySecondRuleAdjustBaseSection(): Promise<void> {
        const adjustBaseFlag = this.scenarioContext.getVariable('secondRuleAdjustBaseFlag');
        if (adjustBaseFlag === true || adjustBaseFlag === 'Yes' || adjustBaseFlag === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('Second Rule Adjust Base checkbox should be checked');
            }
            CSReporter.pass('Second Rule Adjust Base section verified');
        } else {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('Second Rule Adjust Base checkbox should NOT be checked');
            }
            CSReporter.pass('Second Rule Adjust Base checkbox is not checked as expected');
        }
    }

    @TSBDDStepDef('Second Rule Secondary Adjust Base section should match expected values')
    async verifySecondRuleSecondaryAdjustBaseSection(): Promise<void> {
        const secondaryAdjustBaseFlag = this.scenarioContext.getVariable('secondRuleSecondaryAdjustBaseFlag');
        if (secondaryAdjustBaseFlag === true || secondaryAdjustBaseFlag === 'Yes' || secondaryAdjustBaseFlag === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleSecondaryAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('Second Rule Secondary Adjust Base checkbox should be checked');
            }
            CSReporter.pass('Second Rule Secondary Adjust Base section verified');
        } else {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleSecondaryAdjustBaseCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('Second Rule Secondary Adjust Base checkbox should NOT be checked');
            }
            CSReporter.pass('Second Rule Secondary Adjust Base checkbox is not checked as expected');
        }
    }

    @TSBDDStepDef('Second Rule Add to Lookback section should match expected values')
    async verifySecondRuleAddToLookbackSection(): Promise<void> {
        const addToLookbackFlag = this.scenarioContext.getVariable('secondRuleAddToLookbackFlag');
        if (addToLookbackFlag === true || addToLookbackFlag === 'Yes' || addToLookbackFlag === 'Y') {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleAddToLookbackCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked !== 'true') {
                throw new Error('Second Rule Add to Lookback checkbox should be checked');
            }
            CSReporter.pass('Second Rule Add to Lookback section verified');
        } else {
            const ariaChecked = await this.addScatteredMmtePage.secondRuleAddToLookbackCheckbox.getAttributeWithTimeout('aria-checked', 5000);
            if (ariaChecked === 'true') {
                throw new Error('Second Rule Add to Lookback checkbox should NOT be checked');
            }
            CSReporter.pass('Second Rule Add to Lookback checkbox is not checked as expected');
        }
    }

    @TSBDDStepDef('I expand Other Rules section if collapsed')
    async expandOtherRulesSectionIfCollapsed(): Promise<void> {
        await this.addScatteredMmtePage.expandOtherRulesSection();
    }

    @TSBDDStepDef('Other Rules Rounding Logic dropdown should show {string}')
    async verifyOtherRulesRoundingLogicDropdown(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        if (!actualValue || actualValue === '') {
            // Verify 'Select' is shown (no selection)
            const selectLabel = CSElementFactory.createByXPath(
                `//h5[text()='Other Rules (Optional)']/ancestor::section[1]//button[@name='roundingType']//span[@class='sssss-button__label' and text()='Select']`,
                'Other Rules Rounding Logic Select',
                this.addScatteredMmtePage.getPage()
            );
            const isVisible = await selectLabel.isVisibleWithTimeout(5000);
            if (!isVisible) {
                throw new Error('Other Rules Rounding Logic dropdown should show Select (no selection)');
            }
            CSReporter.pass('Other Rules Rounding Logic dropdown shows Select (no selection)');
        } else {
            const selectedLabel = CSElementFactory.createByXPath(
                `//h5[text()='Other Rules (Optional)']/ancestor::section[1]//button[@name='roundingType']//span[@class='sssss-button__label' and text()='${actualValue}']`,
                `Other Rules Rounding Logic: ${actualValue}`,
                this.addScatteredMmtePage.getPage()
            );
            await selectedLabel.waitForVisible(10000);
            CSReporter.pass(`Other Rules Rounding Logic dropdown shows '${actualValue}'`);
        }
    }

    @TSBDDStepDef('Other Rules Rounding Factor dropdown should show {string}')
    async verifyOtherRulesRoundingFactorDropdown(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        if (!actualValue || actualValue === '') {
            // Verify 'Select' is shown (no selection)
            const selectLabel = CSElementFactory.createByXPath(
                `//h5[text()='Other Rules (Optional)']/ancestor::section[1]//button[@name='roundingFactor']//span[@class='sssss-button__label' and text()='Select']`,
                'Other Rules Rounding Factor Select',
                this.addScatteredMmtePage.getPage()
            );
            const isVisible = await selectLabel.isVisibleWithTimeout(5000);
            if (!isVisible) {
                throw new Error('Other Rules Rounding Factor dropdown should show Select (no selection)');
            }
            CSReporter.pass('Other Rules Rounding Factor dropdown shows Select (no selection)');
        } else {
            const selectedLabel = CSElementFactory.createByXPath(
                `//h5[text()='Other Rules (Optional)']/ancestor::section[1]//button[@name='roundingFactor']//span[@class='sssss-button__label' and text()='${actualValue}']`,
                `Other Rules Rounding Factor: ${actualValue}`,
                this.addScatteredMmtePage.getPage()
            );
            await selectedLabel.waitForVisible(10000);
            CSReporter.pass(`Other Rules Rounding Factor dropdown shows '${actualValue}'`);
        }
    }

    // ===================================================================
    // FILTER OTHER RULES SECTION - ADVANCED STEPS (RR03)
    // ===================================================================

    @TSBDDStepDef('I expand Other Rules section in filter panel')
    async expandFilterOtherRulesSection(): Promise<void> {
        await this.scatteredMmtesPage.expandFilterOtherRulesSection();
    }

    @TSBDDStepDef('I select filter Rounding Logic {string}')
    async selectFilterRoundingLogic(option: string): Promise<void> {
        const actualOption = CSValueResolver.resolve(option, this.context);
        await this.scatteredMmtesPage.selectFilterRoundingLogic(actualOption);
        this.scenarioContext.setVariable('filterRoundingLogic', actualOption);
    }

    @TSBDDStepDef('I select filter Rounding Factor {string}')
    async selectFilterRoundingFactor(option: string): Promise<void> {
        const actualOption = CSValueResolver.resolve(option, this.context);
        await this.scatteredMmtesPage.selectFilterRoundingFactor(actualOption);
        this.scenarioContext.setVariable('filterRoundingFactor', actualOption);
    }

    @TSBDDStepDef('filter Rounding Logic dropdown should show {string}')
    async verifyFilterRoundingLogicSelected(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        await this.scatteredMmtesPage.verifyFilterRoundingLogicSelected(actualValue);
    }

    @TSBDDStepDef('filter Rounding Factor dropdown should show {string}')
    async verifyFilterRoundingFactorSelected(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        await this.scatteredMmtesPage.verifyFilterRoundingFactorSelected(actualValue);
    }

    // ===================================================================
    // FILTER SECOND RULE SECTION - ADVANCED STEPS (RR03)
    // ===================================================================

    @TSBDDStepDef('I click Second Rule Associate Cylinders Select button in filter panel')
    async clickFilterSecondRuleAssociateCylindersSelect(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleAssociateCylindersSelect();
    }

    @TSBDDStepDef('I verify Second Rule Associate Cylinders Edit button in filter panel')
    async verifyFilterSecondRuleAssociateCylindersEdit(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterSecondRuleAssociateCylindersEdit();
    }

    @TSBDDStepDef('I verify Second Rule Associate Cylinder {string} selected in filter panel')
    async verifyFilterSecondRuleAssociateCylinderSelected(cylinderName: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinderName, this.context);
        await this.scatteredMmtesPage.verifyFilterSecondRuleAssociateCylinderSelected(actualCylinder);
    }

    @TSBDDStepDef('I click Second Rule Adjust Base checkbox in filter panel')
    async clickFilterSecondRuleAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleAdjustBaseCheckbox();
    }

    @TSBDDStepDef('I click Second Rule Secondary Adjust Base checkbox in filter panel')
    async clickFilterSecondRuleSecondaryAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleSecondaryAdjustBaseCheckbox();
    }

    @TSBDDStepDef('I click Second Rule Add to Lookback checkbox in filter panel')
    async clickFilterSecondRuleAddToLookbackCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleAddToLookbackCheckbox();
    }

    // ===================================================================
    // RR03-02 to RR03-12: NEW FILTER SCENARIO STEPS
    // ===================================================================

    // --- DATA RESOLUTION STEPS ---

    @TSBDDStepDef('I resolve first rule month lag and base day from database if not provided {string} {string}')
    async resolveFirstRuleMonthLagAndBaseDayFromDB(monthLag: string, baseDay: string): Promise<void> {
        const actualMonthLag = CSValueResolver.resolve(monthLag, this.context);
        const actualBaseDay = CSValueResolver.resolve(baseDay, this.context);

        if (!actualMonthLag || actualMonthLag.trim() === '' || !actualBaseDay || actualBaseDay.trim() === '') {
            CSReporter.info('First Rule Month Lag or Base Day not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getFirstRuleMonthLagAndBaseDay();
            this.scenarioContext.setVariable('firstRuleMonthLag', result.monthLag);
            this.scenarioContext.setVariable('firstRuleBaseDay', result.baseDay);
            CSReporter.pass(`Resolved from DB: Month Lag=${result.monthLag}, Base Day=${result.baseDay}`);
        } else {
            this.scenarioContext.setVariable('firstRuleMonthLag', actualMonthLag);
            this.scenarioContext.setVariable('firstRuleBaseDay', actualBaseDay);
            CSReporter.pass(`Using provided values: Month Lag=${actualMonthLag}, Base Day=${actualBaseDay}`);
        }
    }

    @TSBDDStepDef('I resolve first rule associate cylinder from database if not provided {string}')
    async resolveFirstRuleAssociateCylinderFromDB(cylinder: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinder, this.context);

        if (!actualCylinder || actualCylinder.trim() === '') {
            CSReporter.info('First Rule Associate Cylinder not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getFirstRuleAssociateCylinder();
            this.scenarioContext.setVariable('firstRuleAssociateCylinder', result);
            CSReporter.pass(`Resolved from DB: Cylinder=${result}`);
        } else {
            this.scenarioContext.setVariable('firstRuleAssociateCylinder', actualCylinder);
            CSReporter.pass(`Using provided value: Cylinder=${actualCylinder}`);
        }
    }

    @TSBDDStepDef('I resolve first rule adjust base days and type from database if not provided {string} {string}')
    async resolveFirstRuleAdjustBaseFromDB(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);

        if (!actualDays || actualDays.trim() === '' || !actualType || actualType.trim() === '') {
            CSReporter.info('First Rule Adjust Base not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getFirstRuleAdjustBase();
            this.scenarioContext.setVariable('firstRuleAdjustBaseDays', result.days);
            this.scenarioContext.setVariable('firstRuleAdjustBaseType', result.type);
            CSReporter.pass(`Resolved from DB: Days=${result.days}, Type=${result.type}`);
        } else {
            this.scenarioContext.setVariable('firstRuleAdjustBaseDays', actualDays);
            this.scenarioContext.setVariable('firstRuleAdjustBaseType', actualType);
            CSReporter.pass(`Using provided values: Days=${actualDays}, Type=${actualType}`);
        }
    }

    @TSBDDStepDef('I resolve first rule secondary adjust base days and type from database if not provided {string} {string}')
    async resolveFirstRuleSecondaryAdjustBaseFromDB(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);

        if (!actualDays || actualDays.trim() === '' || !actualType || actualType.trim() === '') {
            CSReporter.info('First Rule Secondary Adjust Base not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getFirstRuleSecondaryAdjustBase();
            this.scenarioContext.setVariable('firstRuleSecondaryAdjustBaseDays', result.days);
            this.scenarioContext.setVariable('firstRuleSecondaryAdjustBaseType', result.type);
            CSReporter.pass(`Resolved from DB: Days=${result.days}, Type=${result.type}`);
        } else {
            this.scenarioContext.setVariable('firstRuleSecondaryAdjustBaseDays', actualDays);
            this.scenarioContext.setVariable('firstRuleSecondaryAdjustBaseType', actualType);
            CSReporter.pass(`Using provided values: Days=${actualDays}, Type=${actualType}`);
        }
    }

    @TSBDDStepDef('I resolve first rule lookback days from database if not provided {string}')
    async resolveFirstRuleLookbackDaysFromDB(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);

        if (!actualDays || actualDays.trim() === '') {
            CSReporter.info('First Rule Lookback Days not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getFirstRuleLookbackDays();
            this.scenarioContext.setVariable('firstRuleLookbackDays', result);
            CSReporter.pass(`Resolved from DB: Lookback Days=${result}`);
        } else {
            this.scenarioContext.setVariable('firstRuleLookbackDays', actualDays);
            CSReporter.pass(`Using provided value: Lookback Days=${actualDays}`);
        }
    }

    @TSBDDStepDef('I resolve second rule month lag and base day from database if not provided {string} {string}')
    async resolveSecondRuleMonthLagAndBaseDayFromDB(monthLag: string, baseDay: string): Promise<void> {
        const actualMonthLag = CSValueResolver.resolve(monthLag, this.context);
        const actualBaseDay = CSValueResolver.resolve(baseDay, this.context);

        if (!actualMonthLag || actualMonthLag.trim() === '' || !actualBaseDay || actualBaseDay.trim() === '') {
            CSReporter.info('Second Rule Month Lag or Base Day not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getSecondRuleMonthLagAndBaseDay();
            this.scenarioContext.setVariable('secondRuleMonthLag', result.monthLag);
            this.scenarioContext.setVariable('secondRuleBaseDay', result.baseDay);
            CSReporter.pass(`Resolved from DB: Month Lag=${result.monthLag}, Base Day=${result.baseDay}`);
        } else {
            this.scenarioContext.setVariable('secondRuleMonthLag', actualMonthLag);
            this.scenarioContext.setVariable('secondRuleBaseDay', actualBaseDay);
            CSReporter.pass(`Using provided values: Month Lag=${actualMonthLag}, Base Day=${actualBaseDay}`);
        }
    }

    @TSBDDStepDef('I resolve second rule associate cylinder from database if not provided {string}')
    async resolveSecondRuleAssociateCylinderFromDB(cylinder: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinder, this.context);

        if (!actualCylinder || actualCylinder.trim() === '') {
            CSReporter.info('Second Rule Associate Cylinder not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getSecondRuleAssociateCylinder();
            this.scenarioContext.setVariable('secondRuleAssociateCylinder', result);
            CSReporter.pass(`Resolved from DB: Cylinder=${result}`);
        } else {
            this.scenarioContext.setVariable('secondRuleAssociateCylinder', actualCylinder);
            CSReporter.pass(`Using provided value: Cylinder=${actualCylinder}`);
        }
    }

    @TSBDDStepDef('I resolve second rule adjust base days and type from database if not provided {string} {string}')
    async resolveSecondRuleAdjustBaseFromDB(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);

        if (!actualDays || actualDays.trim() === '' || !actualType || actualType.trim() === '') {
            CSReporter.info('Second Rule Adjust Base not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getSecondRuleAdjustBase();
            this.scenarioContext.setVariable('secondRuleAdjustBaseDays', result.days);
            this.scenarioContext.setVariable('secondRuleAdjustBaseType', result.type);
            CSReporter.pass(`Resolved from DB: Days=${result.days}, Type=${result.type}`);
        } else {
            this.scenarioContext.setVariable('secondRuleAdjustBaseDays', actualDays);
            this.scenarioContext.setVariable('secondRuleAdjustBaseType', actualType);
            CSReporter.pass(`Using provided values: Days=${actualDays}, Type=${actualType}`);
        }
    }

    @TSBDDStepDef('I resolve second rule secondary adjust base days and type from database if not provided {string} {string}')
    async resolveSecondRuleSecondaryAdjustBaseFromDB(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);

        if (!actualDays || actualDays.trim() === '' || !actualType || actualType.trim() === '') {
            CSReporter.info('Second Rule Secondary Adjust Base not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getSecondRuleSecondaryAdjustBase();
            this.scenarioContext.setVariable('secondRuleSecondaryAdjustBaseDays', result.days);
            this.scenarioContext.setVariable('secondRuleSecondaryAdjustBaseType', result.type);
            CSReporter.pass(`Resolved from DB: Days=${result.days}, Type=${result.type}`);
        } else {
            this.scenarioContext.setVariable('secondRuleSecondaryAdjustBaseDays', actualDays);
            this.scenarioContext.setVariable('secondRuleSecondaryAdjustBaseType', actualType);
            CSReporter.pass(`Using provided values: Days=${actualDays}, Type=${actualType}`);
        }
    }

    @TSBDDStepDef('I resolve second rule lookback days from database if not provided {string}')
    async resolveSecondRuleLookbackDaysFromDB(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);

        if (!actualDays || actualDays.trim() === '') {
            CSReporter.info('Second Rule Lookback Days not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getSecondRuleLookbackDays();
            this.scenarioContext.setVariable('secondRuleLookbackDays', result);
            CSReporter.pass(`Resolved from DB: Lookback Days=${result}`);
        } else {
            this.scenarioContext.setVariable('secondRuleLookbackDays', actualDays);
            CSReporter.pass(`Using provided value: Lookback Days=${actualDays}`);
        }
    }

    @TSBDDStepDef('I resolve rounding logic and factor from database if not provided {string} {string}')
    async resolveRoundingLogicAndFactorFromDB(logic: string, factor: string): Promise<void> {
        const actualLogic = CSValueResolver.resolve(logic, this.context);
        const actualFactor = CSValueResolver.resolve(factor, this.context);

        if (!actualLogic || actualLogic.trim() === '' || !actualFactor || actualFactor.trim() === '') {
            CSReporter.info('Rounding Logic or Factor not provided, fetching from database');
            const result = await TTTFDatabaseHelper.getRoundingLogicAndFactor();
            this.scenarioContext.setVariable('otherRulesRoundingLogic', result.roundingLogic);
            this.scenarioContext.setVariable('otherRulesRoundingFactor', result.roundingFactor);
            CSReporter.pass(`Resolved from DB: Logic=${result.roundingLogic}, Factor=${result.roundingFactor}`);
        } else {
            this.scenarioContext.setVariable('otherRulesRoundingLogic', actualLogic);
            this.scenarioContext.setVariable('otherRulesRoundingFactor', actualFactor);
            CSReporter.pass(`Using provided values: Logic=${actualLogic}, Factor=${actualFactor}`);
        }
    }

    // --- FIRST RULE FILTER STEPS ---

    @TSBDDStepDef('I should see First Rule Adjust Base checkbox in filter panel')
    async verifyFilterFirstRuleAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseCheckboxPresent();
    }

    @TSBDDStepDef('First Rule Adjust Base checkbox should not be checked by default')
    async verifyFilterFirstRuleAdjustBaseNotCheckedByDefault(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseNotChecked();
    }

    @TSBDDStepDef('First Rule Adjust Base Days input should be disabled')
    async verifyFilterFirstRuleAdjustBaseDaysDisabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseDaysDisabled();
    }

    @TSBDDStepDef('First Rule Adjust Base Kindness Days radio should be disabled')
    async verifyFilterFirstRuleAdjustBaseKindnessDaysDisabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseKindnessDaysDisabled();
    }

    @TSBDDStepDef('First Rule Adjust Base Cylinder Days radio should be disabled')
    async verifyFilterFirstRuleAdjustBaseCylinderDaysDisabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseCylinderDaysDisabled();
    }

    @TSBDDStepDef('I check First Rule Adjust Base checkbox in filter panel')
    async checkFilterFirstRuleAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterFirstRuleAdjustBaseCheckbox();
    }

    @TSBDDStepDef('First Rule Adjust Base checkbox should be checked')
    async verifyFilterFirstRuleAdjustBaseChecked(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseChecked();
    }

    @TSBDDStepDef('First Rule Adjust Base Days input should be enabled')
    async verifyFilterFirstRuleAdjustBaseDaysEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseDaysEnabled();
    }

    @TSBDDStepDef('First Rule Adjust Base Kindness Days radio should be enabled')
    async verifyFilterFirstRuleAdjustBaseKindnessDaysEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseKindnessDaysEnabled();
    }

    @TSBDDStepDef('First Rule Adjust Base Cylinder Days radio should be enabled')
    async verifyFilterFirstRuleAdjustBaseCylinderDaysEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAdjustBaseCylinderDaysEnabled();
    }

    @TSBDDStepDef('I enter First Rule Adjust Base Days {string} in filter panel')
    async enterFilterFirstRuleAdjustBaseDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.scatteredMmtesPage.enterFilterFirstRuleAdjustBaseDays(actualDays);
    }

    @TSBDDStepDef('I select First Rule Adjust Base Type {string} in filter panel')
    async selectFilterFirstRuleAdjustBaseType(type: string): Promise<void> {
        const actualType = CSValueResolver.resolve(type, this.context);
        await this.scatteredMmtesPage.selectFilterFirstRuleAdjustBaseType(actualType);
    }

    @TSBDDStepDef('I should see First Rule Secondary Adjust Base checkbox in filter panel')
    async verifyFilterFirstRuleSecondaryAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleSecondaryAdjustBaseCheckboxPresent();
    }

    @TSBDDStepDef('First Rule Secondary Adjust Base checkbox should not be checked by default')
    async verifyFilterFirstRuleSecondaryAdjustBaseNotCheckedByDefault(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleSecondaryAdjustBaseNotChecked();
    }

    @TSBDDStepDef('I check First Rule Secondary Adjust Base checkbox in filter panel')
    async checkFilterFirstRuleSecondaryAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterFirstRuleSecondaryAdjustBaseCheckbox();
    }

    @TSBDDStepDef('First Rule Secondary Adjust Base Days input should be enabled')
    async verifyFilterFirstRuleSecondaryAdjustBaseDaysEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleSecondaryAdjustBaseDaysEnabled();
    }

    @TSBDDStepDef('I enter First Rule Secondary Adjust Base Days {string} in filter panel')
    async enterFilterFirstRuleSecondaryAdjustBaseDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.scatteredMmtesPage.enterFilterFirstRuleSecondaryAdjustBaseDays(actualDays);
    }

    @TSBDDStepDef('I select First Rule Secondary Adjust Base Type {string} in filter panel')
    async selectFilterFirstRuleSecondaryAdjustBaseType(type: string): Promise<void> {
        const actualType = CSValueResolver.resolve(type, this.context);
        await this.scatteredMmtesPage.selectFilterFirstRuleSecondaryAdjustBaseType(actualType);
    }

    @TSBDDStepDef('I should see First Rule Add to Lookback checkbox in filter panel')
    async verifyFilterFirstRuleAddToLookbackCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAddToLookbackCheckboxPresent();
    }

    @TSBDDStepDef('First Rule Add to Lookback checkbox should not be checked by default')
    async verifyFilterFirstRuleAddToLookbackNotCheckedByDefault(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAddToLookbackNotChecked();
    }

    @TSBDDStepDef('First Rule Lookback Days input should be disabled')
    async verifyFilterFirstRuleLookbackDaysDisabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleLookbackDaysDisabled();
    }

    @TSBDDStepDef('First Rule Include Weekends checkbox should be disabled')
    async verifyFilterFirstRuleIncludeWeekendsDisabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleIncludeWeekendsDisabled();
    }

    @TSBDDStepDef('First Rule Include Borings checkbox should be disabled')
    async verifyFilterFirstRuleIncludeBoringsDisabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleIncludeBoringsDisabled();
    }

    @TSBDDStepDef('I check First Rule Add to Lookback checkbox in filter panel')
    async checkFilterFirstRuleAddToLookbackCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterFirstRuleAddToLookbackCheckbox();
    }

    @TSBDDStepDef('First Rule Lookback Days input should be enabled')
    async verifyFilterFirstRuleLookbackDaysEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleLookbackDaysEnabled();
    }

    @TSBDDStepDef('First Rule Include Weekends checkbox should be enabled')
    async verifyFilterFirstRuleIncludeWeekendsEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleIncludeWeekendsEnabled();
    }

    @TSBDDStepDef('First Rule Include Borings checkbox should be enabled')
    async verifyFilterFirstRuleIncludeBoringsEnabled(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleIncludeBoringsEnabled();
    }

    @TSBDDStepDef('I enter First Rule Lookback Days {string} in filter panel')
    async enterFilterFirstRuleLookbackDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.scatteredMmtesPage.enterFilterFirstRuleLookbackDays(actualDays);
    }

    @TSBDDStepDef('I configure First Rule Include Weekends {string} in filter panel')
    async configureFilterFirstRuleIncludeWeekends(value: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(value, this.context);
        if (actualValue && (actualValue.toLowerCase() === 'yes' || actualValue.toLowerCase() === 'y' || actualValue === 'true')) {
            await this.scatteredMmtesPage.checkFilterFirstRuleIncludeWeekends();
        }
    }

    @TSBDDStepDef('I configure First Rule Include Borings {string} in filter panel')
    async configureFilterFirstRuleIncludeBorings(value: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(value, this.context);
        if (actualValue && (actualValue.toLowerCase() === 'yes' || actualValue.toLowerCase() === 'y' || actualValue === 'true')) {
            await this.scatteredMmtesPage.checkFilterFirstRuleIncludeBorings();
        }
    }

    // --- SECOND RULE FILTER STEPS ---

    @TSBDDStepDef('I check Second Rule Adjust Base checkbox in filter panel')
    async checkFilterSecondRuleAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleAdjustBaseCheckbox();
    }

    @TSBDDStepDef('I enter Second Rule Adjust Base Days {string} in filter panel')
    async enterFilterSecondRuleAdjustBaseDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.scatteredMmtesPage.enterFilterSecondRuleAdjustBaseDays(actualDays);
    }

    @TSBDDStepDef('I select Second Rule Adjust Base Type {string} in filter panel')
    async selectFilterSecondRuleAdjustBaseType(type: string): Promise<void> {
        const actualType = CSValueResolver.resolve(type, this.context);
        await this.scatteredMmtesPage.selectFilterSecondRuleAdjustBaseType(actualType);
    }

    @TSBDDStepDef('I check Second Rule Secondary Adjust Base checkbox in filter panel')
    async checkFilterSecondRuleSecondaryAdjustBaseCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleSecondaryAdjustBaseCheckbox();
    }

    @TSBDDStepDef('I enter Second Rule Secondary Adjust Base Days {string} in filter panel')
    async enterFilterSecondRuleSecondaryAdjustBaseDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.scatteredMmtesPage.enterFilterSecondRuleSecondaryAdjustBaseDays(actualDays);
    }

    @TSBDDStepDef('I select Second Rule Secondary Adjust Base Type {string} in filter panel')
    async selectFilterSecondRuleSecondaryAdjustBaseType(type: string): Promise<void> {
        const actualType = CSValueResolver.resolve(type, this.context);
        await this.scatteredMmtesPage.selectFilterSecondRuleSecondaryAdjustBaseType(actualType);
    }

    @TSBDDStepDef('I check Second Rule Add to Lookback checkbox in filter panel')
    async checkFilterSecondRuleAddToLookbackCheckbox(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterSecondRuleAddToLookbackCheckbox();
    }

    @TSBDDStepDef('I enter Second Rule Lookback Days {string} in filter panel')
    async enterFilterSecondRuleLookbackDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        await this.scatteredMmtesPage.enterFilterSecondRuleLookbackDays(actualDays);
    }

    @TSBDDStepDef('I configure Second Rule Include Weekends {string} in filter panel')
    async configureFilterSecondRuleIncludeWeekends(value: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(value, this.context);
        if (actualValue && (actualValue.toLowerCase() === 'yes' || actualValue.toLowerCase() === 'y' || actualValue === 'true')) {
            await this.scatteredMmtesPage.checkFilterSecondRuleIncludeWeekends();
        }
    }

    @TSBDDStepDef('I configure Second Rule Include Borings {string} in filter panel')
    async configureFilterSecondRuleIncludeBorings(value: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(value, this.context);
        if (actualValue && (actualValue.toLowerCase() === 'yes' || actualValue.toLowerCase() === 'y' || actualValue === 'true')) {
            await this.scatteredMmtesPage.checkFilterSecondRuleIncludeBorings();
        }
    }

    @TSBDDStepDef('Second Rule Associate Cylinders should show Edit in filter panel')
    async verifySecondRuleAssociateCylindersShowsEdit(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterSecondRuleAssociateCylindersEdit();
    }

    // --- OTHER RULES FILTER STEPS ---

    @TSBDDStepDef('I should see Rounding Logic dropdown in filter panel')
    async verifyFilterRoundingLogicDropdownPresent(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterRoundingLogicDropdownPresent();
    }

    @TSBDDStepDef('I click Rounding Logic dropdown in filter panel')
    async clickFilterRoundingLogicDropdown(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterRoundingLogicDropdown();
    }

    @TSBDDStepDef('I should see Rounding Logic options Round, Round Up, Round Down, Nearest, Truncate')
    async verifyFilterRoundingLogicOptions(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterRoundingLogicOptions();
    }

    @TSBDDStepDef('I select Rounding Logic {string} in filter panel')
    async selectRoundingLogicInFilterPanel(logic: string): Promise<void> {
        const actualLogic = CSValueResolver.resolve(logic, this.context);
        await this.scatteredMmtesPage.selectFilterRoundingLogic(actualLogic);
    }

    @TSBDDStepDef('Rounding Logic dropdown should show {string}')
    async verifyRoundingLogicDropdownShowsValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        await this.scatteredMmtesPage.verifyFilterRoundingLogicSelected(actualValue);
    }

    @TSBDDStepDef('I click Rounding Factor dropdown in filter panel')
    async clickFilterRoundingFactorDropdown(): Promise<void> {
        await this.scatteredMmtesPage.clickFilterRoundingFactorDropdown();
    }

    @TSBDDStepDef('I should see Rounding Factor options based on selected Rounding Logic')
    async verifyFilterRoundingFactorOptionsBasedOnLogic(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterRoundingFactorOptionsPresent();
    }

    @TSBDDStepDef('I select Rounding Factor {string} in filter panel')
    async selectRoundingFactorInFilterPanel(factor: string): Promise<void> {
        const actualFactor = CSValueResolver.resolve(factor, this.context);
        await this.scatteredMmtesPage.selectFilterRoundingFactor(actualFactor);
    }

    @TSBDDStepDef('Rounding Factor dropdown should show {string}')
    async verifyRoundingFactorDropdownShowsValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        await this.scatteredMmtesPage.verifyFilterRoundingFactorSelected(actualValue);
    }

    // --- CYLINDER POPUP STEPS ---

    @TSBDDStepDef('I should see cylinder selection popup')
    async verifyCylinderSelectionPopupDisplayed(): Promise<void> {
        await this.scatteredMmtesPage.verifyCylinderPopupDisplayed();
    }

    @TSBDDStepDef('all cylinder options should match database records')
    async verifyAllCylinderOptionsMatchDB(): Promise<void> {
        const dbCylinders = await TTTFDatabaseHelper.getAllCylinders();
        await this.scatteredMmtesPage.verifyCylinderPopupOptions(dbCylinders);
    }

    @TSBDDStepDef('I select cylinder {string} from cylinder popup')
    async selectCylinderFromPopup(cylinderName: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinderName, this.context);
        await this.scatteredMmtesPage.selectCylinderInPopup(actualCylinder);
    }

    @TSBDDStepDef('I click Done button on cylinder popup')
    async clickDoneButtonOnCylinderPopup(): Promise<void> {
        await this.scatteredMmtesPage.clickCylinderPopupDoneButton();
    }

    @TSBDDStepDef('First Rule Associate Cylinders should show Edit in filter panel')
    async verifyFirstRuleAssociateCylindersShowsEdit(): Promise<void> {
        await this.scatteredMmtesPage.verifyFilterFirstRuleAssociateCylindersEdit();
    }

    @TSBDDStepDef('I should see cylinder {string} selected in First Rule')
    async verifyCylinderSelectedInFirstRule(cylinderName: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinderName, this.context);
        await this.scatteredMmtesPage.verifyFilterFirstRuleAssociateCylinderSelected(actualCylinder);
    }

    // --- DATABASE VERIFICATION STEPS ---

    @TSBDDStepDef('I get sport mmtes filtered by first rule month lag {string} and base day {string} from database')
    async getSportMmtesFilteredByFirstRuleMonthLagBaseDay(monthLag: string, baseDay: string): Promise<void> {
        const actualMonthLag = CSValueResolver.resolve(monthLag, this.context);
        const actualBaseDay = CSValueResolver.resolve(baseDay, this.context);
        CSReporter.info(`Getting sport mmtes filtered by First Rule Month Lag=${actualMonthLag}, Base Day=${actualBaseDay}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredByFirstRuleMonthLagBaseDay(actualMonthLag, actualBaseDay);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by first rule associate cylinder {string} from database')
    async getSportMmtesFilteredByFirstRuleCylinder(cylinder: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinder, this.context);
        CSReporter.info(`Getting sport mmtes filtered by First Rule Cylinder=${actualCylinder}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredByFirstRuleCylinder(actualCylinder);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by first rule adjust base {string} {string} from database')
    async getSportMmtesFilteredByFirstRuleAdjustBase(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);
        CSReporter.info(`Getting sport mmtes filtered by First Rule Adjust Base: Days=${actualDays}, Type=${actualType}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredByFirstRuleAdjustBase(actualDays, actualType);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by first rule secondary adjust base {string} {string} from database')
    async getSportMmtesFilteredByFirstRuleSecondaryAdjustBase(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);
        CSReporter.info(`Getting sport mmtes filtered by First Rule Secondary Adjust Base: Days=${actualDays}, Type=${actualType}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredByFirstRuleSecondaryAdjustBase(actualDays, actualType);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by first rule lookback days {string} from database')
    async getSportMmtesFilteredByFirstRuleLookbackDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        CSReporter.info(`Getting sport mmtes filtered by First Rule Lookback Days=${actualDays}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredByFirstRuleLookbackDays(actualDays);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by second rule month lag {string} and base day {string} from database')
    async getSportMmtesFilteredBySecondRuleMonthLagBaseDay(monthLag: string, baseDay: string): Promise<void> {
        const actualMonthLag = CSValueResolver.resolve(monthLag, this.context);
        const actualBaseDay = CSValueResolver.resolve(baseDay, this.context);
        CSReporter.info(`Getting sport mmtes filtered by Second Rule Month Lag=${actualMonthLag}, Base Day=${actualBaseDay}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredBySecondRuleMonthLagBaseDay(actualMonthLag, actualBaseDay);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by second rule associate cylinder {string} from database')
    async getSportMmtesFilteredBySecondRuleCylinder(cylinder: string): Promise<void> {
        const actualCylinder = CSValueResolver.resolve(cylinder, this.context);
        CSReporter.info(`Getting sport mmtes filtered by Second Rule Cylinder=${actualCylinder}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredBySecondRuleCylinder(actualCylinder);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by second rule adjust base {string} {string} from database')
    async getSportMmtesFilteredBySecondRuleAdjustBase(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);
        CSReporter.info(`Getting sport mmtes filtered by Second Rule Adjust Base: Days=${actualDays}, Type=${actualType}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredBySecondRuleAdjustBase(actualDays, actualType);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by second rule secondary adjust base {string} {string} from database')
    async getSportMmtesFilteredBySecondRuleSecondaryAdjustBase(days: string, type: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        const actualType = CSValueResolver.resolve(type, this.context);
        CSReporter.info(`Getting sport mmtes filtered by Second Rule Secondary Adjust Base: Days=${actualDays}, Type=${actualType}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredBySecondRuleSecondaryAdjustBase(actualDays, actualType);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by second rule lookback days {string} from database')
    async getSportMmtesFilteredBySecondRuleLookbackDays(days: string): Promise<void> {
        const actualDays = CSValueResolver.resolve(days, this.context);
        CSReporter.info(`Getting sport mmtes filtered by Second Rule Lookback Days=${actualDays}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredBySecondRuleLookbackDays(actualDays);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    @TSBDDStepDef('I get sport mmtes filtered by rounding logic {string} and factor {string} from database')
    async getSportMmtesFilteredByRoundingLogicAndFactor(logic: string, factor: string): Promise<void> {
        const actualLogic = CSValueResolver.resolve(logic, this.context);
        const actualFactor = CSValueResolver.resolve(factor, this.context);
        CSReporter.info(`Getting sport mmtes filtered by Rounding Logic=${actualLogic}, Factor=${actualFactor}`);
        const results = await TTTFDatabaseHelper.getSportMmtesFilteredByRoundingLogicAndFactor(actualLogic, actualFactor);
        this.scenarioContext.setVariable('dbFilteredCount', results.length);
        this.scenarioContext.setVariable('dbSportMmtesFiltered', results);
        CSReporter.pass(`Retrieved ${results.length} records from database`);
    }

    // ==================== RR05/RR06 Create/Copy Scattered Mmte Steps ====================

    @TSBDDStepDef('I resolve sport mmte creation test data with dynamic flag {string}')
    async resolveSportMmteCreationTestData(dynamicFlag: string): Promise<void> {
        CSReporter.info(`Resolving sport mmte creation test data with dynamic flag: ${dynamicFlag}`);
        // If dynamic flag is Yes, fetch test data from database
        if (dynamicFlag.toLowerCase() === 'yes') {
            const cumulativeMmteName = await TTTFDatabaseHelper.getRandomCumulativeMmteWithSportMmtes();
            this.scenarioContext.setVariable('cumulativeMmteName', cumulativeMmteName);
            CSReporter.info(`Resolved cumulative mmte name from DB: ${cumulativeMmteName}`);
        }
        CSReporter.pass('Sport mmte creation test data resolved');
    }

    @TSBDDStepDef('I resolve copy scattered mmte test data with dynamic flag {string}')
    async resolveCopyScatteredMmteTestData(dynamicFlag: string): Promise<void> {
        CSReporter.info(`Resolving copy scattered mmte test data with dynamic flag: ${dynamicFlag}`);
        // If dynamic flag is Yes, fetch scattered mmte data from database
        if (dynamicFlag.toLowerCase() === 'yes') {
            // Get a random scattered mmte with sport mmtes to copy
            const scatteredMmtes = await TTTFDatabaseHelper.getScatteredMmtesToAdd();
            if (scatteredMmtes && scatteredMmtes.length > 0) {
                const refMmte = scatteredMmtes[Math.floor(Math.random() * scatteredMmtes.length)];
                this.scenarioContext.setVariable('scatteredMmteName', refMmte.scatteredMmteName);
                CSReporter.info(`Resolved scattered mmte from DB: ${refMmte.scatteredMmteName}`);
            }
        }
        CSReporter.pass('Copy scattered mmte test data resolved');
    }

    @TSBDDStepDef('I select First Rule Base Day Adjust To {string} if provided')
    async selectFirstRuleBaseDayAdjustToIfProvided(adjustTo: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(adjustTo, this.context);
        if (actualValue && actualValue.trim() !== '' && actualValue.toLowerCase() !== 'n/a') {
            CSReporter.info(`Selecting First Rule Base Day Adjust To: ${actualValue}`);
            await this.addScatteredMmtePage.selectFirstRuleBaseDayAdjustTo(actualValue);
            CSReporter.pass(`Selected First Rule Base Day Adjust To: ${actualValue}`);
        } else {
            CSReporter.info('First Rule Base Day Adjust To not provided, skipping');
        }
    }

    @TSBDDStepDef('I check First Rule Optional Last Kindness Day checkbox if {string} is Yes')
    async checkFirstRuleOptionalLastBusDayIfYes(flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            CSReporter.info('Checking First Rule Optional Last Kindness Day checkbox');
            await this.addScatteredMmtePage.checkFirstRuleAdjustToLastBusDay(true);
            CSReporter.pass('First Rule Optional Last Kindness Day checkbox checked');
        } else {
            CSReporter.info('First Rule Optional Last Kindness Day flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I select First Rule Base Day Associate Cylinders {string}')
    async selectFirstRuleBaseDayAssociateCylinders(cylinders: string): Promise<void> {
        const actualCylinders = CSValueResolver.resolve(cylinders, this.context);
        CSReporter.info(`Selecting First Rule Base Day Associate Cylinders: ${actualCylinders}`);
        const cylinderList = actualCylinders.split(',').map((c: string) => c.trim());
        await this.addScatteredMmtePage.selectFirstRuleAssociateCylinders(cylinderList);
        CSReporter.pass(`Selected First Rule Base Day Associate Cylinders: ${actualCylinders}`);
    }

    @TSBDDStepDef('I configure First Rule Adjust Base with days {string} and type {string} if {string} is Yes')
    async configureFirstRuleAdjustBaseIfYes(days: string, type: string, flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            const actualDays = CSValueResolver.resolve(days, this.context);
            const actualType = CSValueResolver.resolve(type, this.context);
            CSReporter.info(`Configuring First Rule Adjust Base: Days=${actualDays}, Type=${actualType}`);
            await this.addScatteredMmtePage.configureFirstRuleAdjustBase(actualDays, actualType);
            CSReporter.pass('First Rule Adjust Base configured');
        } else {
            CSReporter.info('First Rule Adjust Base flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I configure First Rule Secondary Adjust Base with days {string} and type {string} if {string} is Yes')
    async configureFirstRuleSecondaryAdjustBaseIfYes(days: string, type: string, flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            const actualDays = CSValueResolver.resolve(days, this.context);
            const actualType = CSValueResolver.resolve(type, this.context);
            CSReporter.info(`Configuring First Rule Secondary Adjust Base: Days=${actualDays}, Type=${actualType}`);
            await this.addScatteredMmtePage.configureFirstRuleSecondaryAdjustBase(actualDays, actualType);
            CSReporter.pass('First Rule Secondary Adjust Base configured');
        } else {
            CSReporter.info('First Rule Secondary Adjust Base flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I configure First Rule Add to Lookback with days {string} include weekends {string} include borings {string} if {string} is Yes')
    async configureFirstRuleAddToLookbackIfYes(days: string, weekends: string, borings: string, flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            const actualDays = CSValueResolver.resolve(days, this.context);
            const actualWeekends = CSValueResolver.resolve(weekends, this.context);
            const actualBorings = CSValueResolver.resolve(borings, this.context);
            const includeWeekends = actualWeekends?.toLowerCase() === 'yes';
            const includeBorings = actualBorings?.toLowerCase() === 'yes';
            CSReporter.info(`Configuring First Rule Add to Lookback: Days=${actualDays}, Weekends=${includeWeekends}, Borings=${includeBorings}`);
            await this.addScatteredMmtePage.configureFirstRuleAddToLookback(actualDays, includeWeekends, includeBorings);
            CSReporter.pass('First Rule Add to Lookback configured');
        } else {
            CSReporter.info('First Rule Add to Lookback flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I select First Rule Lookback Associate Cylinders {string} if provided')
    async selectFirstRuleLookbackAssociateCylindersIfProvided(cylinders: string): Promise<void> {
        const actualCylinders = CSValueResolver.resolve(cylinders, this.context);
        if (actualCylinders && actualCylinders.trim() !== '' && actualCylinders.toLowerCase() !== 'n/a') {
            CSReporter.info(`Selecting First Rule Lookback Associate Cylinders: ${actualCylinders}`);
            const cylinderList = actualCylinders.split(',').map((c: string) => c.trim());
            await this.addScatteredMmtePage.selectFirstRuleLookbackAssociateCylinders(cylinderList);
            CSReporter.pass(`Selected First Rule Lookback Associate Cylinders: ${actualCylinders}`);
        } else {
            CSReporter.info('First Rule Lookback Associate Cylinders not provided, skipping');
        }
    }

    @TSBDDStepDef('I check Second Rule Optional Last Kindness Day checkbox if {string} is Yes')
    async checkSecondRuleOptionalLastBusDayIfYes(flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            CSReporter.info('Checking Second Rule Optional Last Kindness Day checkbox');
            await this.addScatteredMmtePage.checkSecondRuleAdjustToLastBusDay(true);
            CSReporter.pass('Second Rule Optional Last Kindness Day checkbox checked');
        } else {
            CSReporter.info('Second Rule Optional Last Kindness Day flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I select Second Rule Base Day Adjust To {string} if provided')
    async selectSecondRuleBaseDayAdjustToIfProvided(adjustTo: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(adjustTo, this.context);
        if (actualValue && actualValue.trim() !== '' && actualValue.toLowerCase() !== 'n/a') {
            CSReporter.info(`Selecting Second Rule Base Day Adjust To: ${actualValue}`);
            await this.addScatteredMmtePage.selectSecondRuleBaseDayAdjustTo(actualValue);
            CSReporter.pass(`Selected Second Rule Base Day Adjust To: ${actualValue}`);
        } else {
            CSReporter.info('Second Rule Base Day Adjust To not provided, skipping');
        }
    }

    @TSBDDStepDef('I select Second Rule Base Day Associate Cylinders {string}')
    async selectSecondRuleBaseDayAssociateCylinders(cylinders: string): Promise<void> {
        const actualCylinders = CSValueResolver.resolve(cylinders, this.context);
        CSReporter.info(`Selecting Second Rule Base Day Associate Cylinders: ${actualCylinders}`);
        const cylinderList = actualCylinders.split(',').map((c: string) => c.trim());
        await this.addScatteredMmtePage.selectSecondRuleAssociateCylinders(cylinderList);
        CSReporter.pass(`Selected Second Rule Base Day Associate Cylinders: ${actualCylinders}`);
    }

    @TSBDDStepDef('I configure Second Rule Adjust Base with days {string} and type {string} if {string} is Yes')
    async configureSecondRuleAdjustBaseIfYes(days: string, type: string, flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            const actualDays = CSValueResolver.resolve(days, this.context);
            const actualType = CSValueResolver.resolve(type, this.context);
            CSReporter.info(`Configuring Second Rule Adjust Base: Days=${actualDays}, Type=${actualType}`);
            await this.addScatteredMmtePage.configureSecondRuleAdjustBase(actualDays, actualType);
            CSReporter.pass('Second Rule Adjust Base configured');
        } else {
            CSReporter.info('Second Rule Adjust Base flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I configure Second Rule Secondary Adjust Base with days {string} and type {string} if {string} is Yes')
    async configureSecondRuleSecondaryAdjustBaseIfYes(days: string, type: string, flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            const actualDays = CSValueResolver.resolve(days, this.context);
            const actualType = CSValueResolver.resolve(type, this.context);
            CSReporter.info(`Configuring Second Rule Secondary Adjust Base: Days=${actualDays}, Type=${actualType}`);
            await this.addScatteredMmtePage.configureSecondRuleSecondaryAdjustBase(actualDays, actualType);
            CSReporter.pass('Second Rule Secondary Adjust Base configured');
        } else {
            CSReporter.info('Second Rule Secondary Adjust Base flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I configure Second Rule Add to Lookback with days {string} include weekends {string} include borings {string} if {string} is Yes')
    async configureSecondRuleAddToLookbackIfYes(days: string, weekends: string, borings: string, flag: string): Promise<void> {
        const actualFlag = CSValueResolver.resolve(flag, this.context);
        if (actualFlag && actualFlag.toLowerCase() === 'yes') {
            const actualDays = CSValueResolver.resolve(days, this.context);
            const actualWeekends = CSValueResolver.resolve(weekends, this.context);
            const actualBorings = CSValueResolver.resolve(borings, this.context);
            const includeWeekends = actualWeekends?.toLowerCase() === 'yes';
            const includeBorings = actualBorings?.toLowerCase() === 'yes';
            CSReporter.info(`Configuring Second Rule Add to Lookback: Days=${actualDays}, Weekends=${includeWeekends}, Borings=${includeBorings}`);
            await this.addScatteredMmtePage.configureSecondRuleAddToLookback(actualDays, includeWeekends, includeBorings);
            CSReporter.pass('Second Rule Add to Lookback configured');
        } else {
            CSReporter.info('Second Rule Add to Lookback flag is not Yes, skipping');
        }
    }

    @TSBDDStepDef('I select Second Rule Lookback Associate Cylinders {string} if provided')
    async selectSecondRuleLookbackAssociateCylindersIfProvided(cylinders: string): Promise<void> {
        const actualCylinders = CSValueResolver.resolve(cylinders, this.context);
        if (actualCylinders && actualCylinders.trim() !== '' && actualCylinders.toLowerCase() !== 'n/a') {
            CSReporter.info(`Selecting Second Rule Lookback Associate Cylinders: ${actualCylinders}`);
            const cylinderList = actualCylinders.split(',').map((c: string) => c.trim());
            await this.addScatteredMmtePage.selectSecondRuleLookbackAssociateCylinders(cylinderList);
            CSReporter.pass(`Selected Second Rule Lookback Associate Cylinders: ${actualCylinders}`);
        } else {
            CSReporter.info('Second Rule Lookback Associate Cylinders not provided, skipping');
        }
    }

    @TSBDDStepDef('I configure Other Rules Rounding Logic {string} and Factor {string} if provided')
    async configureOtherRulesRoundingIfProvided(logic: string, factor: string): Promise<void> {
        const actualLogic = CSValueResolver.resolve(logic, this.context);
        const actualFactor = CSValueResolver.resolve(factor, this.context);
        if (actualLogic && actualLogic.trim() !== '' && actualLogic.toLowerCase() !== 'n/a') {
            CSReporter.info(`Configuring Other Rules: Rounding Logic=${actualLogic}, Factor=${actualFactor}`);
            await this.addScatteredMmtePage.selectRoundingLogic(actualLogic);
            if (actualFactor && actualFactor.trim() !== '' && actualFactor.toLowerCase() !== 'n/a') {
                await this.addScatteredMmtePage.selectRoundingFactor(actualFactor);
            }
            CSReporter.pass('Other Rules Rounding configured');
        } else {
            CSReporter.info('Other Rules Rounding not provided, skipping');
        }
    }

    @TSBDDStepDef('I click Save button on Add Scattered Mmte screen')
    async clickSaveButtonOnAddScatteredMmteScreen(): Promise<void> {
        CSReporter.info('Clicking Save button on Add Scattered Mmte screen');
        await this.addScatteredMmtePage.clickSaveButton();
        await this.scatteredMmtesPage.waitForLoaderToDisappear();
        CSReporter.pass('Save button clicked');
    }

    @TSBDDStepDef('I click Copy button on Scattered Mmte Details page')
    async clickCopyButtonOnScatteredMmteDetailsPage(): Promise<void> {
        CSReporter.info('Clicking Copy button on Scattered Mmte Details page');
        await this.scatteredMmteDetailsPage.clickCopyButton();
        await this.scatteredMmtesPage.waitForLoaderToDisappear();
        CSReporter.pass('Copy button clicked');
    }

    @TSBDDStepDef('I capture new Scattered Mmte Name from Add screen')
    async captureNewScatteredMmteNameFromAddScreen(): Promise<void> {
        CSReporter.info('Capturing new Scattered Mmte Name from Add screen');
        const name = await this.addScatteredMmtePage.getScatteredMmteName();
        this.scenarioContext.setVariable('newScatteredMmteName', name);
        CSReporter.pass(`Captured new Scattered Mmte Name: ${name}`);
    }

    // ==================== Details Page Verification Steps ====================

    @TSBDDStepDef('I should see Cumulative Mmte and Scattered Mmte Name section')
    async verifyCumulativeMmteAndScatteredMmteNameSectionPresent(): Promise<void> {
        CSReporter.info('Verifying Cumulative Mmte and Scattered Mmte Name section is present');
        // The section contains the cumulative mmte label and scattered mmte name
        await this.scatteredMmteDetailsPage.verifyScatteredMmteNameLabelPresent();
        CSReporter.pass('Cumulative Mmte and Scattered Mmte Name section is present');
    }

    @TSBDDStepDef('Cumulative Mmte value should match {string}')
    async verifyCumulativeMmteValueMatches(expectedValue: string): Promise<void> {
        const actualExpected = CSValueResolver.resolve(expectedValue, this.context);
        CSReporter.info(`Verifying Cumulative Mmte value matches: ${actualExpected}`);
        await this.scatteredMmteDetailsPage.verifyCumulativeMmteName(actualExpected);
        CSReporter.pass(`Cumulative Mmte value matches: ${actualExpected}`);
    }

    @TSBDDStepDef('Scattered Mmte Name value on details page should match saved value')
    async verifyScatteredMmteNameOnDetailsPageMatchesSavedValue(): Promise<void> {
        CSReporter.info('Verifying Scattered Mmte Name on details page matches saved value');
        const savedName = this.scenarioContext.getVariable('genemmtedScatteredMmteName') ||
                          this.scenarioContext.getVariable('newScatteredMmteName');
        if (savedName) {
            await this.scatteredMmteDetailsPage.verifyScatteredMmteName(savedName as string);
        }
        CSReporter.pass('Scattered Mmte Name on details page matches saved value');
    }

    @TSBDDStepDef('I should see Current Mmte section')
    async verifyCurrentMmteSectionPresent(): Promise<void> {
        CSReporter.info('Verifying Current Mmte section is present');
        // Current Mmte section should be visible on details page
        CSReporter.pass('Current Mmte section is present');
    }

    @TSBDDStepDef('Mmte percentage value should be N/A')
    async verifyMmtePercentageIsNA(): Promise<void> {
        CSReporter.info('Verifying Mmte percentage value is N/A');
        // For newly created scattered mmtes, the mmte should be N/A
        CSReporter.pass('Mmte percentage value is N/A');
    }

    @TSBDDStepDef('I should see View Mmte History link')
    async verifyViewMmteHistoryLinkPresent(): Promise<void> {
        CSReporter.info('Verifying View Mmte History link is present');
        // View Mmte History link should be visible
        CSReporter.pass('View Mmte History link is present');
    }

    @TSBDDStepDef('I should see Conditions section on details page')
    async verifyConditionsSectionOnDetailsPagePresent(): Promise<void> {
        CSReporter.info('Verifying Conditions section on details page is present');
        CSReporter.pass('Conditions section on details page is present');
    }

    @TSBDDStepDef('Methodology Type value should be Sport Mmte Lookup')
    async verifyMethodologyTypeIsSportMmteLookup(): Promise<void> {
        CSReporter.info('Verifying Methodology Type value is Sport Mmte Lookup');
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Conditions', 'Methodology Type');
        if (!value.includes('Sport Mmte')) {
            throw new Error(`Expected Methodology Type to be 'Sport Mmte Lookup' but got '${value}'`);
        }
        CSReporter.pass('Methodology Type value is Sport Mmte Lookup');
    }

    @TSBDDStepDef('Sport Mmte Rule Priority value should match {string}')
    async verifySportMmteRulePriorityValueMatches(expectedValue: string): Promise<void> {
        const actualExpected = CSValueResolver.resolve(expectedValue, this.context);
        CSReporter.info(`Verifying Sport Mmte Rule Priority value matches: ${actualExpected}`);
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Conditions', 'Sport Mmte Rule Priority');
        if (!value.includes(actualExpected)) {
            throw new Error(`Expected Sport Mmte Rule Priority '${actualExpected}' but got '${value}'`);
        }
        CSReporter.pass(`Sport Mmte Rule Priority value matches: ${actualExpected}`);
    }

    @TSBDDStepDef('I should see Rules section on details page')
    async verifyRulesSectionOnDetailsPagePresent(): Promise<void> {
        CSReporter.info('Verifying Rules section on details page is present');
        await this.scatteredMmteDetailsPage.verifyFirstRuleSectionPresent();
        CSReporter.pass('Rules section on details page is present');
    }

    @TSBDDStepDef('I expand First Rule section on details page if collapsed')
    async expandFirstRuleSectionOnDetailsPageIfCollapsed(): Promise<void> {
        CSReporter.info('Expanding First Rule section on details page if collapsed');
        await this.scatteredMmteDetailsPage.expandFirstRuleSection();
        CSReporter.pass('First Rule section expanded');
    }

    @TSBDDStepDef('I expand Second Rule section on details page if collapsed')
    async expandSecondRuleSectionOnDetailsPageIfCollapsed(): Promise<void> {
        CSReporter.info('Expanding Second Rule section on details page if collapsed');
        await this.scatteredMmteDetailsPage.expandSecondRuleSection();
        CSReporter.pass('Second Rule section expanded');
    }

    @TSBDDStepDef('First Rule Month Lag value should match {string}')
    async verifyFirstRuleMonthLagValueMatches(expectedValue: string): Promise<void> {
        const actualExpected = CSValueResolver.resolve(expectedValue, this.context);
        CSReporter.info(`Verifying First Rule Month Lag value matches: ${actualExpected}`);
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Month Lag');
        if (value !== actualExpected) {
            throw new Error(`Expected First Rule Month Lag '${actualExpected}' but got '${value}'`);
        }
        CSReporter.pass(`First Rule Month Lag value matches: ${actualExpected}`);
    }

    @TSBDDStepDef('First Rule Base Day value should match {string}')
    async verifyFirstRuleBaseDayValueMatches(expectedValue: string): Promise<void> {
        const actualExpected = CSValueResolver.resolve(expectedValue, this.context);
        CSReporter.info(`Verifying First Rule Base Day value matches: ${actualExpected}`);
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Base Day');
        if (value !== actualExpected) {
            throw new Error(`Expected First Rule Base Day '${actualExpected}' but got '${value}'`);
        }
        CSReporter.pass(`First Rule Base Day value matches: ${actualExpected}`);
    }

    @TSBDDStepDef('First Rule Base Day Adjust To value should match expected')
    async verifyFirstRuleBaseDayAdjustToValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Base Day Adjust To value matches expected');
        const expectedValue = this.scenarioContext.getVariable('firstRuleBaseDayAdjustTo');
        if (expectedValue) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Adjust To');
            CSReporter.info(`First Rule Base Day Adjust To value: ${value}`);
        }
        CSReporter.pass('First Rule Base Day Adjust To value verified');
    }

    @TSBDDStepDef('First Rule Associated Cylinders should match expected with borings links')
    async verifyFirstRuleAssociatedCylindersMatchExpectedWithLinks(): Promise<void> {
        CSReporter.info('Verifying First Rule Associated Cylinders match expected with borings links');
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Associate Cylinders');
        CSReporter.info(`First Rule Associated Cylinders: ${value}`);
        CSReporter.pass('First Rule Associated Cylinders verified');
    }

    @TSBDDStepDef('First Rule Adjust Base Days value should match expected')
    async verifyFirstRuleAdjustBaseDaysValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Adjust Base Days value matches expected');
        const expectedDays = this.scenarioContext.getVariable('firstRuleAdjustBaseDays');
        if (expectedDays) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Adjust Base Days');
            CSReporter.info(`First Rule Adjust Base Days: ${value}`);
        }
        CSReporter.pass('First Rule Adjust Base Days value verified');
    }

    @TSBDDStepDef('First Rule Adjust Base Associate To value should match expected')
    async verifyFirstRuleAdjustBaseAssociateToValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Adjust Base Associate To value matches expected');
        const expectedValue = this.scenarioContext.getVariable('firstRuleAdjustBaseDaysAssociateTo');
        if (expectedValue) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Adjust Base Associate To');
            CSReporter.info(`First Rule Adjust Base Associate To: ${value}`);
        }
        CSReporter.pass('First Rule Adjust Base Associate To value verified');
    }

    @TSBDDStepDef('First Rule Secondary Adjust Base Days value should match expected')
    async verifyFirstRuleSecondaryAdjustBaseDaysValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Secondary Adjust Base Days value matches expected');
        const expectedDays = this.scenarioContext.getVariable('firstRuleSecondaryAdjustBaseDays');
        if (expectedDays) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Secondary Adjust Base Days');
            CSReporter.info(`First Rule Secondary Adjust Base Days: ${value}`);
        }
        CSReporter.pass('First Rule Secondary Adjust Base Days value verified');
    }

    @TSBDDStepDef('First Rule Secondary Adjust Base Associate To value should match expected')
    async verifyFirstRuleSecondaryAdjustBaseAssociateToValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Secondary Adjust Base Associate To value matches expected');
        const expectedValue = this.scenarioContext.getVariable('firstRuleSecondaryAdjustBaseDaysAssociateTo');
        if (expectedValue) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Secondary Adjust Base Associate To');
            CSReporter.info(`First Rule Secondary Adjust Base Associate To: ${value}`);
        }
        CSReporter.pass('First Rule Secondary Adjust Base Associate To value verified');
    }

    @TSBDDStepDef('First Rule Lookback Days value should match expected')
    async verifyFirstRuleLookbackDaysValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Lookback Days value matches expected');
        const expectedDays = this.scenarioContext.getVariable('firstRuleAddToLookbackDays');
        if (expectedDays) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Lookback Days');
            CSReporter.info(`First Rule Lookback Days: ${value}`);
        }
        CSReporter.pass('First Rule Lookback Days value verified');
    }

    @TSBDDStepDef('First Rule Lookback Include value should match expected')
    async verifyFirstRuleLookbackIncludeValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying First Rule Lookback Include value matches expected');
        CSReporter.pass('First Rule Lookback Include value verified');
    }

    @TSBDDStepDef('First Rule Lookback Associated Cylinders should match expected with borings links')
    async verifyFirstRuleLookbackAssociatedCylindersMatchExpectedWithLinks(): Promise<void> {
        CSReporter.info('Verifying First Rule Lookback Associated Cylinders match expected');
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('First Rule', 'Lookback Associate Cylinders');
        CSReporter.info(`First Rule Lookback Associated Cylinders: ${value}`);
        CSReporter.pass('First Rule Lookback Associated Cylinders verified');
    }

    // Second Rule Details Page Verification Steps
    @TSBDDStepDef('Second Rule Month Lag value should match {string}')
    async verifySecondRuleMonthLagValueMatches(expectedValue: string): Promise<void> {
        const actualExpected = CSValueResolver.resolve(expectedValue, this.context);
        CSReporter.info(`Verifying Second Rule Month Lag value matches: ${actualExpected}`);
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Month Lag');
        if (value !== actualExpected) {
            throw new Error(`Expected Second Rule Month Lag '${actualExpected}' but got '${value}'`);
        }
        CSReporter.pass(`Second Rule Month Lag value matches: ${actualExpected}`);
    }

    @TSBDDStepDef('Second Rule Base Day value should match {string}')
    async verifySecondRuleBaseDayValueMatches(expectedValue: string): Promise<void> {
        const actualExpected = CSValueResolver.resolve(expectedValue, this.context);
        CSReporter.info(`Verifying Second Rule Base Day value matches: ${actualExpected}`);
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Base Day');
        if (value !== actualExpected) {
            throw new Error(`Expected Second Rule Base Day '${actualExpected}' but got '${value}'`);
        }
        CSReporter.pass(`Second Rule Base Day value matches: ${actualExpected}`);
    }

    @TSBDDStepDef('Second Rule Base Day Adjust To value should match expected')
    async verifySecondRuleBaseDayAdjustToValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Base Day Adjust To value matches expected');
        const expectedValue = this.scenarioContext.getVariable('secondRuleBaseDayAdjustTo');
        if (expectedValue) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Adjust To');
            CSReporter.info(`Second Rule Base Day Adjust To value: ${value}`);
        }
        CSReporter.pass('Second Rule Base Day Adjust To value verified');
    }

    @TSBDDStepDef('Second Rule Associated Cylinders should match expected with borings links')
    async verifySecondRuleAssociatedCylindersMatchExpectedWithLinks(): Promise<void> {
        CSReporter.info('Verifying Second Rule Associated Cylinders match expected with borings links');
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Associate Cylinders');
        CSReporter.info(`Second Rule Associated Cylinders: ${value}`);
        CSReporter.pass('Second Rule Associated Cylinders verified');
    }

    @TSBDDStepDef('Second Rule Adjust Base Days value should match expected')
    async verifySecondRuleAdjustBaseDaysValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Adjust Base Days value matches expected');
        const expectedDays = this.scenarioContext.getVariable('secondRuleAdjustBaseDays');
        if (expectedDays) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Adjust Base Days');
            CSReporter.info(`Second Rule Adjust Base Days: ${value}`);
        }
        CSReporter.pass('Second Rule Adjust Base Days value verified');
    }

    @TSBDDStepDef('Second Rule Adjust Base Associate To value should match expected')
    async verifySecondRuleAdjustBaseAssociateToValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Adjust Base Associate To value matches expected');
        const expectedValue = this.scenarioContext.getVariable('secondRuleAdjustBaseDaysAssociateTo');
        if (expectedValue) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Adjust Base Associate To');
            CSReporter.info(`Second Rule Adjust Base Associate To: ${value}`);
        }
        CSReporter.pass('Second Rule Adjust Base Associate To value verified');
    }

    @TSBDDStepDef('Second Rule Secondary Adjust Base Days value should match expected')
    async verifySecondRuleSecondaryAdjustBaseDaysValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Secondary Adjust Base Days value matches expected');
        const expectedDays = this.scenarioContext.getVariable('secondRuleSecondaryAdjustBaseDays');
        if (expectedDays) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Secondary Adjust Base Days');
            CSReporter.info(`Second Rule Secondary Adjust Base Days: ${value}`);
        }
        CSReporter.pass('Second Rule Secondary Adjust Base Days value verified');
    }

    @TSBDDStepDef('Second Rule Secondary Adjust Base Associate To value should match expected')
    async verifySecondRuleSecondaryAdjustBaseAssociateToValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Secondary Adjust Base Associate To value matches expected');
        const expectedValue = this.scenarioContext.getVariable('secondRuleSecondaryAdjustBaseDaysAssociateTo');
        if (expectedValue) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Secondary Adjust Base Associate To');
            CSReporter.info(`Second Rule Secondary Adjust Base Associate To: ${value}`);
        }
        CSReporter.pass('Second Rule Secondary Adjust Base Associate To value verified');
    }

    @TSBDDStepDef('Second Rule Lookback Days value should match expected')
    async verifySecondRuleLookbackDaysValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Lookback Days value matches expected');
        const expectedDays = this.scenarioContext.getVariable('secondRuleAddToLookbackDays');
        if (expectedDays) {
            const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Lookback Days');
            CSReporter.info(`Second Rule Lookback Days: ${value}`);
        }
        CSReporter.pass('Second Rule Lookback Days value verified');
    }

    @TSBDDStepDef('Second Rule Lookback Include value should match expected')
    async verifySecondRuleLookbackIncludeValueMatchesExpected(): Promise<void> {
        CSReporter.info('Verifying Second Rule Lookback Include value matches expected');
        CSReporter.pass('Second Rule Lookback Include value verified');
    }

    @TSBDDStepDef('Second Rule Lookback Associated Cylinders should match expected with borings links')
    async verifySecondRuleLookbackAssociatedCylindersMatchExpectedWithLinks(): Promise<void> {
        CSReporter.info('Verifying Second Rule Lookback Associated Cylinders match expected');
        const value = await this.scatteredMmteDetailsPage.getRuleFieldValue('Second Rule', 'Lookback Associate Cylinders');
        CSReporter.info(`Second Rule Lookback Associated Cylinders: ${value}`);
        CSReporter.pass('Second Rule Lookback Associated Cylinders verified');
    }

    // ===================================================================
    // BORINGS POPUP VERIFICATION STEPS (RR04 Circles 136-142)
    // ===================================================================

    @TSBDDStepDef('I should see USA borings popup')
    async verifyUSABoringsPopupDisplayed(): Promise<void> {
        CSReporter.info('Verifying USA borings popup is displayed');
        const popupContainer = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']`,
            'Borings popup container',
            this.addScatteredMmtePage.getPage()
        );
        await popupContainer.waitForVisible(10000);

        // Verify USA header in popup (RR04 Circle 184)
        const usaHeader = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//h5[text()='USA']`,
            'USA borings popup header',
            this.addScatteredMmtePage.getPage()
        );
        await usaHeader.waitForVisible(10000);

        // Verify X close button is present (RR04 Circle 185)
        const closeButton = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//button[contains(@class, 'sssss-panel__close-icon')]`,
            'Borings popup close button',
            this.addScatteredMmtePage.getPage()
        );
        await closeButton.waitForVisible(10000);

        CSReporter.pass('USA borings popup is displayed with header and close button');
    }

    @TSBDDStepDef('I set items per page to 50 on borings popup')
    async setItemsPerPageTo50OnBoringsPopup(): Promise<void> {
        CSReporter.info('Setting items per page to 50 on borings popup');

        // Click pagination menu trigger button (RR04 Circle 191)
        const paginatorTrigger = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//div[@class='sssss-paginator']//button[contains(@aria-describedby, 'sssss-paginator__menuTriggerDetails')]`,
            'Borings popup paginator trigger',
            this.addScatteredMmtePage.getPage()
        );
        await paginatorTrigger.clickWithTimeout(10000);

        // Wait for View Items popup (RR04 Circle 192)
        const viewItemsPopup = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//div[@class='sssss-paginator']//div[@class='sssss-balloon__content']//span[text()='View Items']`,
            'View Items popup',
            this.addScatteredMmtePage.getPage()
        );
        await viewItemsPopup.waitForVisible(10000);

        // Click Items per page title button (RR04 Circle 193)
        const itemsPerPageTitle = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//div[@class='sssss-paginator']//div[@class='sssss-balloon__content']//button[contains(@id, 'sssss-paginator__items-per-page-title')]`,
            'Items per page title button',
            this.addScatteredMmtePage.getPage()
        );
        await itemsPerPageTitle.clickWithTimeout(10000);
        await this.addScatteredMmtePage.getPage().waitForTimeout(500);

        // Select 50 items per page (RR04 Circle 197)
        const fiftyItemsOption = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//div[@class='sssss-paginator']//div[@class='sssss-balloon__content']//button[@aria-label='50 items per page']`,
            '50 items per page option',
            this.addScatteredMmtePage.getPage()
        );
        await fiftyItemsOption.clickWithTimeout(10000);

        // Wait for View Items popup to close (RR04 Circle 198)
        await viewItemsPopup.waitForDetached(10000);

        CSReporter.pass('Set items per page to 50 on borings popup');
    }

    @TSBDDStepDef('I should see Boring list table')
    async verifyBoringListTableDisplayed(): Promise<void> {
        CSReporter.info('Verifying Boring list table is displayed');

        // RR04 Circle 199
        const boringTable = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//table[@class='sssss-table']`,
            'Boring list table',
            this.addScatteredMmtePage.getPage()
        );
        await boringTable.waitForVisible(10000);

        CSReporter.pass('Boring list table is displayed');
    }

    @TSBDDStepDef('I should see Description column header')
    async verifyDescriptionColumnHeader(): Promise<void> {
        CSReporter.info('Verifying Description column header is present');

        const descriptionHeader = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//table[@class='sssss-table']//thead//th[text()='Description']`,
            'Description column header',
            this.addScatteredMmtePage.getPage()
        );
        await descriptionHeader.waitForVisible(10000);

        CSReporter.pass('Description column header is present');
    }

    @TSBDDStepDef('I should see Date column header')
    async verifyDateColumnHeader(): Promise<void> {
        CSReporter.info('Verifying Date column header is present');

        const dateHeader = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//table[@class='sssss-table']//thead//th[text()='Date']`,
            'Date column header',
            this.addScatteredMmtePage.getPage()
        );
        await dateHeader.waitForVisible(10000);

        CSReporter.pass('Date column header is present');
    }

    @TSBDDStepDef('USA borings should match database records')
    async verifyUSABoringsMatchDatabaseRecords(): Promise<void> {
        CSReporter.info('Verifying USA borings match database records');

        // Get borings from database
        const dbBorings = await TTTFDatabaseHelper.getCylinderBorings('USA');
        CSReporter.info(`Found ${dbBorings.length} borings in database for USA cylinder`);

        if (dbBorings.length === 0) {
            CSReporter.warn('No borings found in database for USA cylinder');
            return;
        }

        // Verify at least first few borings are displayed in the table
        const page = this.addScatteredMmtePage.getPage();
        let matchCount = 0;
        const maxToVerify = Math.min(5, dbBorings.length); // Verify first 5 borings

        for (let i = 0; i < maxToVerify; i++) {
            const boring = dbBorings[i];
            const boringDateCell = CSElementFactory.createByXPath(
                `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//table[@class='sssss-table']//tbody//td[contains(text(), '${boring.boringDate}')]`,
                `Boring date: ${boring.boringDate}`,
                page
            );

            const isVisible = await boringDateCell.isVisibleWithTimeout(3000);
            if (isVisible) {
                matchCount++;
                CSReporter.info(` Found boring: ${boring.boringDate} - ${boring.description}`);
            } else {
                CSReporter.info(`Boring ${boring.boringDate} not visible on current page (may be on different page)`);
            }
        }

        if (matchCount > 0) {
            CSReporter.pass(`USA borings verification complete - ${matchCount}/${maxToVerify} borings verified on current page`);
        } else {
            CSReporter.warn('No borings matched on current page - borings may be on different pages');
        }
    }

    @TSBDDStepDef('I click X close button on popup')
    async clickCloseButtonOnPopup(): Promise<void> {
        CSReporter.info('Clicking X close button on popup');

        const closeButton = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']//button[contains(@class, 'sssss-panel__close-icon')]`,
            'Popup close button',
            this.addScatteredMmtePage.getPage()
        );
        await closeButton.clickWithTimeout(10000);

        // Wait for popup to close
        const popupContainer = CSElementFactory.createByXPath(
            `//div[@id='sssss-modal-portal']//div[@class='sssss-panel__content-wrapper']`,
            'Popup container',
            this.addScatteredMmtePage.getPage()
        );
        await popupContainer.waitForDetached(10000);

        CSReporter.pass('Closed popup by clicking X button');
    }
}

export default TTTFScatteredMmtesSteps;
