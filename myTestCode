// Check Node.js and system environment
console.log('=== Environment Check ===\n');

console.log('Node.js Information:');
console.log('  Version:', process.version);
console.log('  Architecture:', process.arch);
console.log('  Platform:', process.platform);
console.log('  Executable:', process.execPath);

console.log('\nEnvironment Variables:');
console.log('  USERNAME:', process.env.USERNAME || process.env.USER);
console.log('  USERDOMAIN:', process.env.USERDOMAIN);
console.log('  COMPUTERNAME:', process.env.COMPUTERNAME);
console.log('  OS:', process.env.OS);
console.log('  PROCESSOR_ARCHITECTURE:', process.env.PROCESSOR_ARCHITECTURE);

console.log('\nWSL Detection:');
if (process.platform === 'linux') {
  const fs = require('fs');
  try {
    const version = fs.readFileSync('/proc/version', 'utf8');
    console.log('  Running in WSL:', version.includes('Microsoft') || version.includes('WSL'));
    console.log('  /proc/version:', version.trim());
  } catch (e) {
    console.log('  Not WSL or cannot read /proc/version');
  }
} else {
  console.log('  Platform is not Linux');
}

console.log('\nODBC Driver Check:');
console.log('  Note: ODBC drivers are Windows-specific');
console.log('  If running in WSL, ODBC drivers from Windows are NOT accessible');
console.log('  msnodesqlv8 requires native Windows ODBC drivers');

if (process.platform === 'linux') {
  console.log('\n⚠️  CRITICAL: You are running on Linux (probably WSL)');
  console.log('  Problem: msnodesqlv8 cannot access Windows ODBC drivers from WSL');
  console.log('  Solution 1: Run Node.js from Windows (not WSL)');
  console.log('  Solution 2: Use SQL Authentication instead of Windows Auth');
  console.log('  Solution 3: Install unixODBC and SQL Server ODBC driver for Linux');
}

console.log('\n=== Recommendation ===');
if (process.platform === 'linux') {
  console.log('Run this test from Windows PowerShell or CMD, not WSL!');
  console.log('Command: node.exe check-environment.js');
} else if (process.arch === 'ia32') {
  console.log('You are running 32-bit Node.js');
  console.log('Make sure to use 32-bit ODBC Driver 17 for SQL Server');
} else {
  console.log('Environment looks good for Windows Authentication');
  console.log('Node.js is 64-bit, should work with 64-bit ODBC drivers');
}
