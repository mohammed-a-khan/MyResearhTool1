/**
     * Helper to check if a value is a valid provided date (not a placeholder or column name)
     * Valid dates should contain / or - (e.g., MM/DD/YYYY or YYYY-MM-DD)
     */
    private isValidProvidedDate(value: string): boolean {
        if (!value || value.trim() === '') return false;
        if (value.includes('<') || value.includes('>')) return false;
        if (value.includes('{') || value.includes('}')) return false;
        // Reject literal column names that might leak through
        const lowerValue = value.toLowerCase().trim();
        if (lowerValue === 'startdate' || lowerValue === 'enddate' ||
            lowerValue === 'start_date' || lowerValue === 'end_date' ||
            lowerValue === 'undefined' || lowerValue === 'null') return false;
        // Valid date should contain / or - separator
        return value.includes('/') || value.includes('-');
    }

    @CSBDDStepDef('I resolve start date as 3 business days ago if not provided {string}')
    async resolveStartDate3BusinessDaysAgo(providedValue: string): Promise<void> {
        CSReporter.info(`Resolving start date as 3 business days ago if not provided: ${providedValue}`);

        if (this.isValidProvidedDate(providedValue)) {
            this.scenarioContext.setVariable('startDate', providedValue);
            CSReporter.pass(`Using provided start date: ${providedValue}`);
            return;
        }

        const startDate = TTTFDatabaseHelper.calculateBusinessDaysAgo(3);
        this.scenarioContext.setVariable('startDate', startDate);
        CSReporter.pass(`Resolved start date as 3 business days ago: ${startDate}`);
    }

    @CSBDDStepDef('I resolve start date as 5 business days ago if not provided {string}')
    async resolveStartDate5BusinessDaysAgo(providedValue: string): Promise<void> {
        CSReporter.info(`Resolving start date as 5 business days ago if not provided: ${providedValue}`);

        if (this.isValidProvidedDate(providedValue)) {
            this.scenarioContext.setVariable('startDate', providedValue);
            CSReporter.pass(`Using provided start date: ${providedValue}`);
            return;
        }

        const startDate = TTTFDatabaseHelper.calculateBusinessDaysAgo(5);
        this.scenarioContext.setVariable('startDate', startDate);
        CSReporter.pass(`Resolved start date as 5 business days ago: ${startDate}`);
    }

    @CSBDDStepDef('I resolve end date as 1 business day ago if not provided {string}')
    async resolveEndDate1BusinessDayAgo(providedValue: string): Promise<void> {
        CSReporter.info(`Resolving end date as 1 business day ago if not provided: ${providedValue}`);

        if (this.isValidProvidedDate(providedValue)) {
            this.scenarioContext.setVariable('endDate', providedValue);
            CSReporter.pass(`Using provided end date: ${providedValue}`);
            return;
        }

        const endDate = TTTFDatabaseHelper.calculateBusinessDaysAgo(1);
        this.scenarioContext.setVariable('endDate', endDate);
        CSReporter.pass(`Resolved end date as 1 business day ago: ${endDate}`);
    }
