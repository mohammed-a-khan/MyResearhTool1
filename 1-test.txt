export interface DynamicSportMmteTestData {
    externalMmteId: string;
    externalMmteName: string;
    sportMmtePriority: string;
    // First Rule
    firstRuleWwwwwVvvvv: string;
    firstRuleBaseDay: string;
    firstRuleNnnnnBaseDays: string | null;
    firstRuleNnnnnBaseType: string;
    firstRuleBaseDayNnnnn: string;
    firstRuleNonBusDayNnnnn: string | null;  // For Last Kindness Day checkbox
    firstRuleSecondaryNnnnnBaseDay: string | null;
    firstRuleSecondaryNnnnnBaseType: string;
    firstRuleHookwithDays: string | null;
    firstRuleHookwithWeekend: string | null;
    firstRuleHookwithBoring: string | null;
    firstRuleBaseCalIds: string;
    firstRuleBaseCals: string;
    firstRuleHookwithCalIds: string | null;  // Hookwith cylinders
    firstRuleHookwithCals: string | null;     // Hookwith cylinder names
    // Second Rule
    secondRuleWwwwwVvvvv: string | null;
    secondRuleBaseDay: string | null;
    secondRuleNnnnnBaseDays: string | null;
    secondRuleNnnnnBaseType: string;
    secondRuleBaseDayNnnnn: string;
    secondRuleNonBusDayNnnnn: string | null;  // For Last Kindness Day checkbox
    secondRuleSecondaryNnnnnBaseDay: string | null;
    secondRuleSecondaryNnnnnBaseType: string;
    secondRuleHookwithDays: string | null;
    secondRuleHookwithWeekend: string | null;
    secondRuleHookwithBoring: string | null;
    secondRuleBaseCalIds: string | null;
    secondRuleBaseCals: string | null;
    secondRuleHookwithCalIds: string | null;  // Hookwith cylinders
    secondRuleHookwithCals: string | null;     // Hookwith cylinder names
    // Other Rules
    roundingType: string | null;
    roundingFactor: string | null;
    // Date Info
    mmteDt: string;
    cycleDate: string;
}



// Map database column names to test data interface (handle both upper and lower case)
        const testData: DynamicSportMmteTestData = {
            externalMmteId: row.EXTERNAL_MMTE_ID || row.external_mmte_id,
            externalMmteName: row.EXTERNAL_MMTE_NAME || row.external_mmte_name,
            sportMmtePriority: this.mapSportMmtePriorityFromDb(row.SPORT_MMTE_PRIORITY || row.sport_mmte_priority),
            firstRuleWwwwwVvvvv: String(row.FIRST_RULE_WWWWW_VVVVV ?? row.first_rule_wwwww_vvvvv ?? '0'),
            firstRuleBaseDay: String(row.FIRST_RULE_BASE_DAY ?? row.first_rule_base_day ?? '1'),
            firstRuleNnnnnBaseDays: row.FIRST_RULE_NNNNN_BASE_DAYS || row.first_rule_nnnnn_base_days,
            firstRuleNnnnnBaseType: this.mapNnnnnBaseTypeFromDb(row.FIRST_RULE_NNNNN_BASE_TYPE || row.first_rule_nnnnn_base_type),
            firstRuleBaseDayNnnnn: this.mapBaseDayNnnnnFromDb(row.FIRST_RULE_BASE_DAY_NNNNN || row.first_rule_base_day_nnnnn),
            firstRuleNonBusDayNnnnn: row.FIRST_RULE_NON_BUS_DAY_NNNNN || row.first_rule_non_bus_day_nnnnn,
            firstRuleSecondaryNnnnnBaseDay: row.FIRST_RULE_SECONDARY_NNNNN_BASE_DAY || row.first_rule_secondary_nnnnn_base_day,
            firstRuleSecondaryNnnnnBaseType: this.mapNnnnnBaseTypeFromDb(row.FIRST_RULE_SECONDARY_NNNNN_BASE_TYPE || row.first_rule_secondary_nnnnn_base_type),
            firstRuleHookwithDays: row.FIRST_RULE_HOOKWITH_DAYS || row.first_rule_hookwith_days,
            firstRuleHookwithWeekend: row.FIRST_RULE_HOOKWITH_WEEKEND || row.first_rule_hookwith_weekend,
            firstRuleHookwithBoring: row.FIRST_RULE_HOOKWITH_BORING || row.first_rule_hookwith_boring,
            firstRuleBaseCalIds: row.FIRST_RULE_BASE_CAL_IDS || row.first_rule_base_cal_ids,
            firstRuleBaseCals: row.FIRST_RULE_BASE_CALS || row.first_rule_base_cals,
            firstRuleHookwithCalIds: row.FIRST_RULE_HOOKWITH_CAL_IDS || row.first_rule_hookwith_cal_ids,
            firstRuleHookwithCals: row.FIRST_RULE_HOOKWITH_CALS || row.first_rule_hookwith_cals,
            secondRuleWwwwwVvvvv: row.SECOND_RULE_WWWWW_VVVVV || row.second_rule_wwwww_vvvvv,
            secondRuleBaseDay: row.SECOND_RULE_BASE_DAY || row.second_rule_base_day,
            secondRuleNnnnnBaseDays: row.SECOND_RULE_NNNNN_BASE_DAYS || row.second_rule_nnnnn_base_days,
            secondRuleNnnnnBaseType: this.mapNnnnnBaseTypeFromDb(row.SECOND_RULE_NNNNN_BASE_TYPE || row.second_rule_nnnnn_base_type),
            secondRuleBaseDayNnnnn: this.mapBaseDayNnnnnFromDb(row.SECOND_RULE_BASE_DAY_NNNNN || row.second_rule_base_day_nnnnn),
            secondRuleNonBusDayNnnnn: row.SECOND_RULE_NON_BUS_DAY_NNNNN || row.second_rule_non_bus_day_nnnnn,
            secondRuleSecondaryNnnnnBaseDay: row.SECOND_RULE_SECONDARY_NNNNN_BASE_DAY || row.second_rule_secondary_nnnnn_base_day,
            secondRuleSecondaryNnnnnBaseType: this.mapNnnnnBaseTypeFromDb(row.SECOND_RULE_SECONDARY_NNNNN_BASE_TYPE || row.second_rule_secondary_nnnnn_base_type),
            secondRuleHookwithDays: row.SECOND_RULE_HOOKWITH_DAYS || row.second_rule_hookwith_days,
            secondRuleHookwithWeekend: row.SECOND_RULE_HOOKWITH_WEEKEND || row.second_rule_hookwith_weekend,
            secondRuleHookwithBoring: row.SECOND_RULE_HOOKWITH_BORING || row.second_rule_hookwith_boring,
            secondRuleBaseCalIds: row.SECOND_RULE_BASE_CAL_IDS || row.second_rule_base_cal_ids,
            secondRuleBaseCals: row.SECOND_RULE_BASE_CALS || row.second_rule_base_cals,
            secondRuleHookwithCalIds: row.SECOND_RULE_HOOKWITH_CAL_IDS || row.second_rule_hookwith_cal_ids,
            secondRuleHookwithCals: row.SECOND_RULE_HOOKWITH_CALS || row.second_rule_hookwith_cals,
            roundingType: this.mapRoundingTypeFromDb(row.ROUNDING_TYPE || row.rounding_type),
            roundingFactor: this.mapRoundingFactorFromDb(row.ROUNDING_TYPE || row.rounding_type, row.ROUNDING_FACTOR || row.rounding_factor),
            mmteDt: row.MMTE_DT || row.mmte_dt,
            cycleDate: row.CYCLE_DATE || row.cycle_date
        };




    /**
     * Map database rounding type value to UI display value
     * Per RR05 Req Lines 100-104
     */
    private static mapRoundingTypeFromDb(dbValue: string | null | undefined): string {
        if (!dbValue) return '';
        const mapping: { [key: string]: string } = {
            'ROUND': 'Round',
            'UP': 'Round Up',
            'DOWN': 'Round Down',
            'NEAREST': 'Nearest',
            'TRUNCATE': 'Truncate'
        };
        return mapping[dbValue] || dbValue;
    }

    /**
     * Map database rounding factor value to UI display value
     * Per RR05 Req Lines 105-112 - depends on rounding type
     */
    private static mapRoundingFactorFromDb(roundingType: string | null | undefined, dbValue: string | number | null | undefined): string {
        if (!dbValue && dbValue !== 0) return '';
        const numValue = typeof dbValue === 'string' ? parseFloat(dbValue) : dbValue;

        // Round and Truncate use fractional values
        if (roundingType === 'ROUND' || roundingType === 'TRUNCATE') {
            const fractionalMapping: { [key: number]: string } = {
                0.001: '1/1000th',
                0.01: '1/100th',
                0.1: '1/10th',
                0.125: 'Nearest 1/8th',
                0.0625: 'Nearest 1/16th',
                0.03125: 'Nearest 1/32nd'
            };
            return fractionalMapping[numValue] || String(dbValue);
        }

        // Round Up, Round Down, Nearest use decimal places
        if (roundingType === 'UP' || roundingType === 'DOWN' || roundingType === 'NEAREST') {
            const decimalMapping: { [key: number]: string } = {
                1: '1 Decimal Place',
                2: '2 Decimal Places',
                3: '3 Decimal Places',
                4: '4 Decimal Places',
                5: '5 Decimal Places',
                6: '6 Decimal Places',
                7: '7 Decimal Places',
                8: '8 Decimal Places'
            };
            return decimalMapping[numValue] || String(dbValue);
        }

        return String(dbValue);
    }




    ---------------------------------------------------------------------------

    @TSBDDStepDef('Sport Mmte Rule Priority dropdown should show {string}')
    async verifySportMmteRulePriorityDropdownShowsValue(expectedValue: string): Promise<void> {
        const actualValue = CSValueResolver.resolve(expectedValue, this.context);
        Tsreporter.info(`Verifying Sport Mmte Rule Priority dropdown shows: ${actualValue}`);
        const displayedValue = await this.addSctteredMmtePage.sportMmteRulePriorityDropdown.textContentWithTimeout(10000);
        if (displayedValue && displayedValue.includes(actualValue)) {
            Tsreporter.pass(`Sport Mmte Rule Priority dropdown shows expected value: ${actualValue}`);
        } else {
            throw new Error(`Sport Mmte Rule Priority dropdown expected '${actualValue}' but found '${displayedValue}'`);
        }
    }




    @TSBDDStepDef('I select {string} from Sport Mmte Rule Priority dropdown')
    async selectFromSportMmteRulePriorityDropdown(priority: string): Promise<void> {
        const actualPriority = CSValueResolver.resolve(priority, this.context);
        Tsreporter.info(`Selecting '${actualPriority}' from Sport Mmte Rule Priority dropdown`);
        await this.addSctteredMmtePage.selectSportMmteRulePriority(actualPriority);
        Tsreporter.pass(`Selected '${actualPriority}' from Sport Mmte Rule Priority dropdown`);
    }





    @TSBDDStepDef('I resolve sport mmte creation test data with dynamic fvvvvv {string}')
    async resolveSportMmteCreationTestData(dynamicFvvvvv: string): Promise<void> {
        Tsreporter.info(`Resolving sport mmte creation test data with dynamic fvvvvv: ${dynamicFvvvvv}`);

        // If dynamic fvvvvv is Yes/True/Y, fetch all test data from database
        const isDynamic = ['yes', 'true', 'y'].includes(dynamicFvvvvv.toLowerCase().trim());

        if (isDynamic) {
            Tsreporter.info('Dynamic test data fvvvvv is Yes - fetching test data from database');

            // Execute the massive query to get all dynamic test data
            const testData = await TTTFDatabaseHelper.getDynamicSportMmteTestData();

            // Map all fields to scenario context variables per RR05 Requirement Lines 10-112
            // External Mmte Info
            this.scenarioContext.setVariable('externalMmteName', testData.externalMmteName);
            this.scenarioContext.setVariable('externalMmteId', testData.externalMmteId);

            // Sport Mmte Rule Priority (already mapped in helper)
            this.scenarioContext.setVariable('sportMmteRulePriority', testData.sportMmtePriority);

            // First Rule Fields
            this.scenarioContext.setVariable('firstRuleWwwwwVvvvv', testData.firstRuleWwwwwVvvvv);
            this.scenarioContext.setVariable('firstRuleBaseDay', testData.firstRuleBaseDay);
            this.scenarioContext.setVariable('firstRuleBaseDayNnnnnTo', testData.firstRuleBaseDayNnnnn);

            // First Rule - Last Kindness Day Fvvvvv (only applicable if nnnnnTo is Next Kindness Day)
            const firstRuleLastBusDayFvvvvv = (testData.firstRuleBaseDayNnnnn === 'Next Kindness Day' &&
                testData.firstRuleNonBusDayNnnnn === 'Y') ? 'Yes' : 'No';
            this.scenarioContext.setVariable('firstRuleBaseDayNnnnnToLastBusDayFvvvvv', firstRuleLastBusDayFvvvvv);

            // First Rule - Associate Cylinders
            this.scenarioContext.setVariable('firstRuleAssociateCylinders', testData.firstRuleBaseCals || '');

            // First Rule - Nnnnn Base (derive fvvvvv from days not null)
            const firstRuleNnnnnBaseFvvvvv = testData.firstRuleNnnnnBaseDays ? 'Yes' : 'No';
            this.scenarioContext.setVariable('firstRuleNnnnnBaseFvvvvv', firstRuleNnnnnBaseFvvvvv);
            this.scenarioContext.setVariable('firstRuleNnnnnBaseDays', testData.firstRuleNnnnnBaseDays || '');
            this.scenarioContext.setVariable('firstRuleNnnnnBaseDaysAssociateTo', testData.firstRuleNnnnnBaseType || '');

            // First Rule - Secondary Nnnnn Base (derive fvvvvv from days not null)
            const firstRuleSecondaryNnnnnBaseFvvvvv = testData.firstRuleSecondaryNnnnnBaseDay ? 'Yes' : 'No';
            this.scenarioContext.setVariable('firstRuleSecondaryNnnnnBaseFvvvvv', firstRuleSecondaryNnnnnBaseFvvvvv);
            this.scenarioContext.setVariable('firstRuleSecondaryNnnnnBaseDays', testData.firstRuleSecondaryNnnnnBaseDay || '');
            this.scenarioContext.setVariable('firstRuleSecondaryNnnnnBaseDaysAssociateTo', testData.firstRuleSecondaryNnnnnBaseType || '');

            // First Rule - Add to Hookwith (derive fvvvvv from days not null)
            const firstRuleAddToHookwithFvvvvv = testData.firstRuleHookwithDays ? 'Yes' : 'No';
            this.scenarioContext.setVariable('firstRuleAddToHookwithDaysFvvvvv', firstRuleAddToHookwithFvvvvv);
            this.scenarioContext.setVariable('firstRuleAddToHookwithDays', testData.firstRuleHookwithDays || '');

            // Map Y/N to Yes/No for checkbox fvvvvvs
            const firstRuleHookwithWeekend = testData.firstRuleHookwithWeekend === 'Y' ? 'Yes' : 'No';
            const firstRuleHookwithBoring = testData.firstRuleHookwithBoring === 'Y' ? 'Yes' : 'No';
            this.scenarioContext.setVariable('firstRuleAddToHookwithDaysIncludeWeekend', firstRuleHookwithWeekend);
            this.scenarioContext.setVariable('firstRuleAddToHookwithDaysIncludeBoring', firstRuleHookwithBoring);

            // First Rule - Hookwith Associate Cylinders
            this.scenarioContext.setVariable('firstRuleAddToHookwithDaysAssociateCylinders', testData.firstRuleHookwithCals || '');

            // Second Rule Fields
            this.scenarioContext.setVariable('secondRuleWwwwwVvvvv', testData.secondRuleWwwwwVvvvv || '');
            this.scenarioContext.setVariable('secondRuleBaseDay', testData.secondRuleBaseDay || '');
            this.scenarioContext.setVariable('secondRuleBaseDayNnnnnTo', testData.secondRuleBaseDayNnnnn);

            // Second Rule - Last Kindness Day Fvvvvv (only applicable if nnnnnTo is Next Kindness Day)
            const secondRuleLastBusDayFvvvvv = (testData.secondRuleBaseDayNnnnn === 'Next Kindness Day' &&
                testData.secondRuleNonBusDayNnnnn === 'Y') ? 'Yes' : 'No';
            this.scenarioContext.setVariable('secondRuleBaseDayNnnnnToLastBusDayFvvvvv', secondRuleLastBusDayFvvvvv);

            // Second Rule - Associate Cylinders (renamed to secondRuleBaseDayAssociateCylinders for feature file)
            this.scenarioContext.setVariable('secondRuleBaseDayAssociateCylinders', testData.secondRuleBaseCals || '');

            // Second Rule - Nnnnn Base (derive fvvvvv from days not null)
            const secondRuleNnnnnBaseFvvvvv = testData.secondRuleNnnnnBaseDays ? 'Yes' : 'No';
            this.scenarioContext.setVariable('secondRuleNnnnnBaseFvvvvv', secondRuleNnnnnBaseFvvvvv);
            this.scenarioContext.setVariable('secondRuleNnnnnBaseDays', testData.secondRuleNnnnnBaseDays || '');
            this.scenarioContext.setVariable('secondRuleNnnnnBaseDaysAssociateTo', testData.secondRuleNnnnnBaseType || '');

            // Second Rule - Secondary Nnnnn Base (derive fvvvvv from days not null)
            const secondRuleSecondaryNnnnnBaseFvvvvv = testData.secondRuleSecondaryNnnnnBaseDay ? 'Yes' : 'No';
            this.scenarioContext.setVariable('secondRuleSecondaryNnnnnBaseFvvvvv', secondRuleSecondaryNnnnnBaseFvvvvv);
            this.scenarioContext.setVariable('secondRuleSecondaryNnnnnBaseDays', testData.secondRuleSecondaryNnnnnBaseDay || '');
            this.scenarioContext.setVariable('secondRuleSecondaryNnnnnBaseDaysAssociateTo', testData.secondRuleSecondaryNnnnnBaseType || '');

            // Second Rule - Add to Hookwith (derive fvvvvv from days not null)
            const secondRuleAddToHookwithFvvvvv = testData.secondRuleHookwithDays ? 'Yes' : 'No';
            this.scenarioContext.setVariable('secondRuleAddToHookwithDaysFvvvvv', secondRuleAddToHookwithFvvvvv);
            this.scenarioContext.setVariable('secondRuleAddToHookwithDays', testData.secondRuleHookwithDays || '');

            // Map Y/N to Yes/No for checkbox fvvvvvs
            const secondRuleHookwithWeekend = testData.secondRuleHookwithWeekend === 'Y' ? 'Yes' : 'No';
            const secondRuleHookwithBoring = testData.secondRuleHookwithBoring === 'Y' ? 'Yes' : 'No';
            this.scenarioContext.setVariable('secondRuleAddToHookwithDaysIncludeWeekends', secondRuleHookwithWeekend);
            this.scenarioContext.setVariable('secondRuleAddToHookwithDaysIncludeBorings', secondRuleHookwithBoring);

            // Second Rule - Hookwith Associate Cylinders
            this.scenarioContext.setVariable('secondRuleAddToHookwithDaysAssociateCylinders', testData.secondRuleHookwithCals || '');

            // Other Rules - Rounding
            this.scenarioContext.setVariable('otherRulesRoundingLogic', testData.roundingType || '');
            this.scenarioContext.setVariable('otherRulesRoundingFactor', testData.roundingFactor || '');

            // Date Info
            this.scenarioContext.setVariable('mmteDate', testData.mmteDt);
            this.scenarioContext.setVariable('cycleDate', testData.cycleDate);

            Tsreporter.info(`Resolved dynamic test data from DB: External Mmte = ${testData.externalMmteName}, Priority = ${testData.sportMmtePriority}`);
            Tsreporter.info(`First Rule: WwwwwVvvvv=${testData.firstRuleWwwwwVvvvv}, BaseDay=${testData.firstRuleBaseDay}`);
            Tsreporter.info(`Second Rule: WwwwwVvvvv=${testData.secondRuleWwwwwVvvvv}, BaseDay=${testData.secondRuleBaseDay}`);
        } else {
            Tsreporter.info('Dynamic test data fvvvvv is No - using data from JSON file');
        }

        Tsreporter.pass('Sport mmte creation test data resolved');
    }
